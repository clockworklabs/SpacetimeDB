<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Unreal Tutorial/Part-4" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">4 - Moving and Colliding | SpacetimeDB docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.spacetimedb.com/unreal/part-4"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="4 - Moving and Colliding | SpacetimeDB docs"><meta data-rh="true" name="description" content="Need help with the tutorial? Join our Discord server!"><meta data-rh="true" property="og:description" content="Need help with the tutorial? Join our Discord server!"><link data-rh="true" rel="icon" href="/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.spacetimedb.com/unreal/part-4"><link data-rh="true" rel="alternate" href="https://docs.spacetimedb.com/unreal/part-4" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.spacetimedb.com/unreal/part-4" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QBC7Z9KXS2-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"4 - Moving and Colliding","item":"https://docs.spacetimedb.com/unreal/part-4"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="SpacetimeDB docs" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.0cb9f7a7.css">
<script src="/assets/js/runtime~main.d71df0f5.js" defer="defer"></script>
<script src="/assets/js/main.31d95d83.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="https://spacetimedb.com/images/brand.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_6jFv" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="https://spacetimedb.com/images/brand.png" alt="SpacetimeDB Logo" class="themedComponent_rvet themedComponent--light_mbAJ"><img src="https://spacetimedb.com/images/brand.png" alt="SpacetimeDB Logo" class="themedComponent_rvet themedComponent--dark_Ncy6"></div></a><div class="navbarSearchContainer_AesG"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://spacetimedb.com/install" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Install</a><a href="https://spacetimedb.com/pricing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Pricing</a><a href="https://spacetimedb.com/maincloud" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Maincloud</a><a href="https://spacetimedb.com/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://spacetimedb.com/community" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_hV_y"><div class="docsWrapper_f07g"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_MJiz" type="button"></button><div class="docRoot_Gd2s"><aside class="theme-doc-sidebar-container docSidebarContainer_fSpF"><div class="sidebarViewport_YElg"><div class="sidebar_kjg4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_AG0n"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/"><span title="Intro" class="categoryLinkLabel_EDYQ">Intro</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/deploying/maincloud"><span title="Deploying" class="categoryLinkLabel_EDYQ">Deploying</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/unity"><span title="Unity tutorial" class="categoryLinkLabel_EDYQ">Unity tutorial</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/unreal"><span title="Unreal Tutorial" class="categoryLinkLabel_EDYQ">Unreal Tutorial</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unreal"><span title="Overview" class="linkLabel_dpMB">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unreal/part-1"><span title="1 - Setup" class="linkLabel_dpMB">1 - Setup</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unreal/part-2"><span title="2 - Connecting to SpacetimeDB" class="linkLabel_dpMB">2 - Connecting to SpacetimeDB</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unreal/part-3"><span title="3 - Gameplay" class="linkLabel_dpMB">3 - Gameplay</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/unreal/part-4"><span title="4 - Moving and Colliding" class="linkLabel_dpMB">4 - Moving and Colliding</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cli-reference"><span title="CLI Reference" class="categoryLinkLabel_EDYQ">CLI Reference</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/modules"><span title="Server Module Languages" class="categoryLinkLabel_EDYQ">Server Module Languages</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sdks"><span title="Client SDK Languages" class="categoryLinkLabel_EDYQ">Client SDK Languages</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sql"><span title="SQL" class="categoryLinkLabel_EDYQ">SQL</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/subscriptions"><span title="Subscriptions" class="categoryLinkLabel_EDYQ">Subscriptions</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rls"><span title="Row Level Security" class="linkLabel_dpMB">Row Level Security</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/how-to/incremental-migrations"><span title="How-To" class="categoryLinkLabel_EDYQ">How-To</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/spacetimeauth"><span title="SpacetimeAuth" class="categoryLinkLabel_EDYQ">SpacetimeAuth</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/http/authorization"><span title="HTTP API" class="categoryLinkLabel_EDYQ">HTTP API</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/webassembly-abi"><span title="Internals" class="categoryLinkLabel_EDYQ">Internals</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/appendix"><span title="Appendix" class="linkLabel_dpMB">Appendix</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_dkUT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_w2oE"><div class="docItemContainer_f71m"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_xsLZ" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_oyay"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Unreal Tutorial</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">4 - Moving and Colliding</span></li></ul></nav><div class="tocCollapsible_dqme theme-doc-toc-mobile tocMobile_Z34P"><button type="button" class="clean-btn tocCollapsibleButton_QMSE">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Unreal Tutorial - Part 4 - Moving and Colliding</h1></header>
<p>Need help with the tutorial? <a href="https://discord.gg/spacetimedb" target="_blank" rel="noopener noreferrer">Join our Discord server</a>!</p>
<p>This progressive tutorial is continued from <a href="/unreal/part-3">part 3</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="moving-the-player">Moving the player<a href="#moving-the-player" class="hash-link" aria-label="Direct link to Moving the player" title="Direct link to Moving the player" translate="no">​</a></h3>
<p>At this point, we&#x27;re very close to having a working game. All we have to do is modify our server to allow the player to move around, and to simulate the physics and collisions of the game.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>Let&#x27;s start by building out a simple math library to help us do collision calculations. Create a new <code>math.rs</code> file in the <code>server-rust/src</code> directory and add the following contents. Let&#x27;s also move the <code>DbVector2</code> type from <code>lib.rs</code> into this file.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">SpacetimeType</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// This allows us to store 2D points in tables.</span></span>
<span class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD;font-style:italic">SpacetimeType</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Clone</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Copy</span><span style="color:#F8F8F2">)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    pub</span><span style="color:#F8F8F2"> x</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#FF79C6">    pub</span><span style="color:#F8F8F2"> y</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ops</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">Add</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">&amp;</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    type</span><span style="color:#8BE9FD;font-style:italic"> Output</span><span style="color:#FF79C6"> =</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    fn</span><span style="color:#50FA7B"> add</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">, other</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            x</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> other</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x,</span></span>
<span class="line"><span style="color:#F8F8F2">            y</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> other</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y,</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ops</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">Add</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    type</span><span style="color:#8BE9FD;font-style:italic"> Output</span><span style="color:#FF79C6"> =</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    fn</span><span style="color:#50FA7B"> add</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">, other</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            x</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> other</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x,</span></span>
<span class="line"><span style="color:#F8F8F2">            y</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> other</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y,</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ops</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">AddAssign</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    fn</span><span style="color:#50FA7B"> add_assign</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;mut</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#F8F8F2">, rhs</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> rhs</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x;</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> rhs</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">iter</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">Sum</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    fn</span><span style="color:#50FA7B"> sum</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">I</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Iterator</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">Item</span><span style="color:#FF79C6"> =</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">&gt;&gt;(iter</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> I</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> r </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0.0</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">0.0</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">        for</span><span style="color:#F8F8F2"> val </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> iter {</span></span>
<span class="line"><span style="color:#F8F8F2">            r </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> val;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">        r</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ops</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">Sub</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">&amp;</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    type</span><span style="color:#8BE9FD;font-style:italic"> Output</span><span style="color:#FF79C6"> =</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    fn</span><span style="color:#50FA7B"> sub</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">, other</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            x</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> other</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x,</span></span>
<span class="line"><span style="color:#F8F8F2">            y</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> other</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y,</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ops</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">Sub</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    type</span><span style="color:#8BE9FD;font-style:italic"> Output</span><span style="color:#FF79C6"> =</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    fn</span><span style="color:#50FA7B"> sub</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">, other</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            x</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> other</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x,</span></span>
<span class="line"><span style="color:#F8F8F2">            y</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> other</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y,</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ops</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">SubAssign</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    fn</span><span style="color:#50FA7B"> sub_assign</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;mut</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#F8F8F2">, rhs</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">-=</span><span style="color:#F8F8F2"> rhs</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x;</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">-=</span><span style="color:#F8F8F2"> rhs</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ops</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">Mul</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">f32</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    type</span><span style="color:#8BE9FD;font-style:italic"> Output</span><span style="color:#FF79C6"> =</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    fn</span><span style="color:#50FA7B"> mul</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">, other</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            x</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> other,</span></span>
<span class="line"><span style="color:#F8F8F2">            y</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> other,</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ops</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">Div</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">f32</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    type</span><span style="color:#8BE9FD;font-style:italic"> Output</span><span style="color:#FF79C6"> =</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    fn</span><span style="color:#50FA7B"> div</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">, other</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> other </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> 0.0</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">            DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">                x</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> other,</span></span>
<span class="line"><span style="color:#F8F8F2">                y</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> other,</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">            DbVector2</span><span style="color:#F8F8F2"> { x</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0.0</span><span style="color:#F8F8F2">, y</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0.0</span><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">impl</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> new</span><span style="color:#F8F8F2">(x</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2">, y</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        Self</span><span style="color:#F8F8F2"> { x, y }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> sqr_magnitude</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">+</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> magnitude</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        (</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">+</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">sqrt</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> normalized</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#FF79C6"> /</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">magnitude</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>At the very top of <code>lib.rs</code> add the following lines to import the moved <code>DbVector2</code> from the <code>math</code> module.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> mod</span><span style="color:#F8F8F2"> math;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> math</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#6272A4">// ...</span></span></code></pre><p>Next, add the following reducer to your <code>lib.rs</code> file.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> update_player_input</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, direction</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Player not found&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">filter</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">player</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">player_id) {</span></span>
<span class="line"><span style="color:#F8F8F2">        circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">direction </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> direction</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">normalized</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">        circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">speed </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> direction</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">magnitude</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clamp</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0.0</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">1.0</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">update</span><span style="color:#F8F8F2">(circle);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>This is a simple reducer that takes the movement input from the client and applies them to all circles that that player controls. Note that it is not possible for a player to move another player&#x27;s circles using this reducer, because the <code>ctx.sender</code> value is not set by the client. Instead <code>ctx.sender</code> is set by SpacetimeDB after it has authenticated that sender. You can rest assured that the caller has been authenticated as that player by the time this reducer is called.</p></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>Let&#x27;s start by building out a simple math library to help us do collision calculations. Create a new <code>Math.cs</code> file in the <code>csharp-server</code> directory and add the following contents. Let&#x27;s also remove the <code>DbVector2</code> type from <code>Lib.cs</code>.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">SpacetimeDB</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Type</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> partial</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> x;</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> y;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#50FA7B"> DbVector2</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> x</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> y</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        this</span><span style="color:#F8F8F2">.x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> x;</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        this</span><span style="color:#F8F8F2">.y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> y;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> SqrMagnitude </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> x </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> x </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> y </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> y;</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> Magnitude </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> MathF.</span><span style="color:#50FA7B">Sqrt</span><span style="color:#F8F8F2">(SqrMagnitude);</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> Normalized </span><span style="color:#FF79C6">=&gt;</span><span style="color:#BD93F9;font-style:italic"> this</span><span style="color:#FF79C6"> /</span><span style="color:#F8F8F2"> Magnitude;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#FF79C6"> operator</span><span style="color:#50FA7B"> +</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#FFB86C;font-style:italic"> a</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#FFB86C;font-style:italic"> b</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(a.x </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> b.x, a.y </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> b.y);</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#FF79C6"> operator</span><span style="color:#50FA7B"> -</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#FFB86C;font-style:italic"> a</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#FFB86C;font-style:italic"> b</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(a.x </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> b.x, a.y </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> b.y);</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#FF79C6"> operator</span><span style="color:#50FA7B"> *</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#FFB86C;font-style:italic"> a</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> b</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(a.x </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> b, a.y </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> b);</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#FF79C6"> operator</span><span style="color:#50FA7B"> /</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#FFB86C;font-style:italic"> a</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> b</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(a.x </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> b, a.y </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> b);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>Next, add the following reducer to the <code>Module</code> class of your <code>Lib.cs</code> file.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> UpdatePlayerInput</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#FFB86C;font-style:italic"> direction</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.player.identity.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(ctx.Sender) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Player not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">    foreach</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> c </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx.Db.circle.player_id.</span><span style="color:#50FA7B">Filter</span><span style="color:#F8F8F2">(player.player_id))</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> c;</span></span>
<span class="line"><span style="color:#F8F8F2">        circle.direction </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> direction.Normalized;</span></span>
<span class="line"><span style="color:#F8F8F2">        circle.speed </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Math.</span><span style="color:#50FA7B">Clamp</span><span style="color:#F8F8F2">(direction.Magnitude, </span><span style="color:#BD93F9">0f</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">1f</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.circle.entity_id.</span><span style="color:#50FA7B">Update</span><span style="color:#F8F8F2">(circle);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>This is a simple reducer that takes the movement input from the client and applies them to all circles that that player controls. Note that it is not possible for a player to move another player&#x27;s circles using this reducer, because the <code>ctx.Sender</code> value is not set by the client. Instead <code>ctx.Sender</code> is set by SpacetimeDB after it has authenticated that sender. You can rest assured that the caller has been authenticated as that player by the time this reducer is called.</p></div></div></div>
<p>Finally, let&#x27;s schedule a reducer to run every 50 milliseconds to move the player&#x27;s circles around based on the most recently set player input.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">table(name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> move_all_players_timer, scheduled(move_all_players))]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> MoveAllPlayersTimer</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    #[primary_key]</span></span>
<span class="line"><span style="color:#F8F8F2">    #[auto_inc]</span></span>
<span class="line"><span style="color:#F8F8F2">    scheduled_id</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u64</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    scheduled_at</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">ScheduleAt</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> START_PLAYER_SPEED</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 10</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> mass_to_max_move_speed</span><span style="color:#F8F8F2">(mass</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9">    2.0</span><span style="color:#FF79C6"> *</span><span style="color:#BD93F9"> START_PLAYER_SPEED</span><span style="color:#FF79C6"> as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> /</span><span style="color:#F8F8F2"> (</span><span style="color:#BD93F9">1.0</span><span style="color:#FF79C6"> +</span><span style="color:#F8F8F2"> (mass </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> /</span><span style="color:#BD93F9"> START_PLAYER_MASS</span><span style="color:#FF79C6"> as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">sqrt</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> move_all_players</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, _timer</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> MoveAllPlayersTimer</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">id</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Config not found&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">world_size;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Handle player input</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> circle_entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#FF79C6"> !</span><span style="color:#F8F8F2">circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">is_some</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#6272A4">            // This can happen if a circle is eaten by another circle</span></span>
<span class="line"><span style="color:#FF79C6">            continue</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> circle_entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">unwrap</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> circle_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> mass_to_radius</span><span style="color:#F8F8F2">(circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> direction </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">direction </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">speed;</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> new_pos </span><span style="color:#FF79C6">=</span></span>
<span class="line"><span style="color:#F8F8F2">            circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">position </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> direction </span><span style="color:#FF79C6">*</span><span style="color:#50FA7B"> mass_to_max_move_speed</span><span style="color:#F8F8F2">(circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> min </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> circle_radius;</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> max </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> -</span><span style="color:#F8F8F2"> circle_radius;</span></span>
<span class="line"><span style="color:#F8F8F2">        circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">position</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> new_pos</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clamp</span><span style="color:#F8F8F2">(min, max);</span></span>
<span class="line"><span style="color:#F8F8F2">        circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">position</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> new_pos</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clamp</span><span style="color:#F8F8F2">(min, max);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">update</span><span style="color:#F8F8F2">(circle_entity);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Table</span><span style="color:#F8F8F2">(Name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">move_all_players_timer</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, Scheduled </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> nameof</span><span style="color:#F8F8F2">(MoveAllPlayers), ScheduledAt </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> nameof</span><span style="color:#F8F8F2">(scheduled_at))]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> partial</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> MoveAllPlayersTimer</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    [</span><span style="color:#8BE9FD;font-style:italic">PrimaryKey</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">AutoInc</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> ulong</span><span style="color:#F8F8F2"> scheduled_id;</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#8BE9FD;font-style:italic"> ScheduleAt</span><span style="color:#F8F8F2"> scheduled_at;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> START_PLAYER_SPEED </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 10</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> float</span><span style="color:#50FA7B"> MassToMaxMoveSpeed</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> mass</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#BD93F9"> 2f</span><span style="color:#FF79C6"> *</span><span style="color:#F8F8F2"> START_PLAYER_SPEED </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> (</span><span style="color:#BD93F9">1f</span><span style="color:#FF79C6"> +</span><span style="color:#F8F8F2"> MathF.</span><span style="color:#50FA7B">Sqrt</span><span style="color:#F8F8F2">((</span><span style="color:#FF79C6">float</span><span style="color:#F8F8F2">)mass </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> START_PLAYER_MASS));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> MoveAllPlayers</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">MoveAllPlayersTimer</span><span style="color:#FFB86C;font-style:italic"> timer</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (ctx.Db.config.id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Config not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)).world_size;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> circle_directions </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.circle.</span><span style="color:#50FA7B">Iter</span><span style="color:#F8F8F2">().</span><span style="color:#50FA7B">Select</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">c</span><span style="color:#FF79C6"> =&gt;</span><span style="color:#F8F8F2"> (c.entity_id, c.direction </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> c.speed)).</span><span style="color:#50FA7B">ToDictionary</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Handle player input</span></span>
<span class="line"><span style="color:#FF79C6">    foreach</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx.Db.circle.</span><span style="color:#50FA7B">Iter</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> check_entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.entity.entity_id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(circle.entity_id);</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (check_entity </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> null</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#6272A4">            // This can happen if the circle has been eaten by another circle.</span></span>
<span class="line"><span style="color:#FF79C6">            continue</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> circle_entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> check_entity.Value;</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> circle_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(circle_entity.mass);</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> direction </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> circle_directions[circle.entity_id];</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> new_pos </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> circle_entity.position </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> direction </span><span style="color:#FF79C6">*</span><span style="color:#50FA7B"> MassToMaxMoveSpeed</span><span style="color:#F8F8F2">(circle_entity.mass);</span></span>
<span class="line"><span style="color:#F8F8F2">        circle_entity.position.x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Math.</span><span style="color:#50FA7B">Clamp</span><span style="color:#F8F8F2">(new_pos.x, circle_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> circle_radius);</span></span>
<span class="line"><span style="color:#F8F8F2">        circle_entity.position.y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Math.</span><span style="color:#50FA7B">Clamp</span><span style="color:#F8F8F2">(new_pos.y, circle_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> circle_radius);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.entity.entity_id.</span><span style="color:#50FA7B">Update</span><span style="color:#F8F8F2">(circle_entity);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div></div></div>
<p>This reducer is very similar to a standard game &quot;tick&quot; or &quot;frame&quot; that you might find in an ordinary game server or similar to something like the <code>Tick</code> loop in a game engine like Unreal. We&#x27;ve scheduled it every 50 milliseconds and we can use it to step forward our simulation by moving all the circles a little bit further in the direction they&#x27;re moving.</p>
<p>In this reducer, we&#x27;re just looping through all the circles in the game and updating their position based on their direction, speed, and mass. Just basic physics.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>Add the following to your <code>init</code> reducer to schedule the <code>move_all_players</code> reducer to run every 50 milliseconds.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">    .</span><span style="color:#50FA7B">move_all_players_timer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    .</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">MoveAllPlayersTimer</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        scheduled_id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        scheduled_at</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> ScheduleAt</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Interval</span><span style="color:#F8F8F2">(Duration</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">from_millis</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into</span><span style="color:#F8F8F2">()),</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>Add the following to your <code>Init</code> reducer to schedule the <code>MoveAllPlayers</code> reducer to run every 50 milliseconds.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">ctx.Db.move_all_players_timer.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> MoveAllPlayersTimer</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    scheduled_at </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> ScheduleAt</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Interval</span><span style="color:#F8F8F2">(TimeSpan.</span><span style="color:#50FA7B">FromMilliseconds</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">});</span></span></code></pre></div></div></div>
<p>Republish your module with:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> publish</span><span style="color:#BD93F9"> --server</span><span style="color:#F1FA8C"> local</span><span style="color:#F1FA8C"> blackholio</span><span style="color:#BD93F9"> --delete-data</span></span></code></pre>
<p>Regenerate your server bindings with:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> generate</span><span style="color:#BD93F9"> --lang</span><span style="color:#F1FA8C"> unrealcpp</span><span style="color:#BD93F9"> --uproject-dir</span><span style="color:#F1FA8C"> ../client_unreal</span><span style="color:#BD93F9"> --project-path</span><span style="color:#F1FA8C"> ./</span><span style="color:#BD93F9"> --module-name</span><span style="color:#F1FA8C"> client_unreal</span></span></code></pre>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="moving-on-the-client">Moving on the Client<a href="#moving-on-the-client" class="hash-link" aria-label="Direct link to Moving on the Client" title="Direct link to Moving on the Client" translate="no">​</a></h3>
<p>The final step is to update <code>BlackholioPlayerController</code> on the client to call the <code>update_player_input</code> reducer.<br>
<!-- -->Open <code>BlackholioPlayerController.cpp</code> and replace the stubbed function added earlier with the following:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#8BE9FD;font-style:italic">FVector2D</span><span style="color:#F8F8F2"> ABlackholioPlayerController</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">ComputeDesiredDirection</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">const</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    int32 SizeX </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">, SizeY </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#50FA7B">    GetViewportSize</span><span style="color:#F8F8F2">(SizeX, SizeY);</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (SizeX </span><span style="color:#FF79C6">&lt;=</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6"> ||</span><span style="color:#F8F8F2"> SizeY </span><span style="color:#FF79C6">&lt;=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> FVector2D</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FVector2D </span><span style="color:#50FA7B">ViewportCenter</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">static_cast&lt;float&gt;</span><span style="color:#F8F8F2">(SizeX) </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.5</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">static_cast&lt;float&gt;</span><span style="color:#F8F8F2">(SizeY) </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.5</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    FVector2D MousePos </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ViewportCenter;</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">LockInputPosition.</span><span style="color:#50FA7B">IsSet</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        float</span><span style="color:#F8F8F2"> MouseX </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, MouseY </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#50FA7B">GetMousePosition</span><span style="color:#F8F8F2">(MouseX, MouseY))</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#FF79C6">            return</span><span style="color:#F8F8F2"> FVector2D</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">        MousePos </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> FVector2D</span><span style="color:#F8F8F2">(MouseX, MouseY);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    else</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        MousePos </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> LockInputPosition.</span><span style="color:#50FA7B">GetValue</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (MousePos.X </span><span style="color:#FF79C6">&lt;</span><span style="color:#BD93F9"> 0.</span><span style="color:#FF79C6">f</span><span style="color:#FF79C6"> ||</span><span style="color:#F8F8F2"> MousePos.X </span><span style="color:#FF79C6">&gt;=</span><span style="color:#F8F8F2"> SizeX </span><span style="color:#FF79C6">||</span><span style="color:#F8F8F2"> MousePos.Y </span><span style="color:#FF79C6">&lt;</span><span style="color:#BD93F9"> 0.</span><span style="color:#FF79C6">f</span><span style="color:#FF79C6"> ||</span><span style="color:#F8F8F2"> MousePos.Y </span><span style="color:#FF79C6">&gt;=</span><span style="color:#F8F8F2"> SizeY)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> FVector2D</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> Denominator </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> FMath</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Max</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">1.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">static_cast&lt;float&gt;</span><span style="color:#F8F8F2">(SizeY) </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 3.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FVector2D DesiredDir </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (MousePos </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> ViewportCenter) </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> Denominator;</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> DesiredDir;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>Finally, update the <code>Tick()</code> function to use this logic and trigger the reducer:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> ABlackholioPlayerController</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Tick</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> DeltaSeconds</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Super</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Tick</span><span style="color:#F8F8F2">(DeltaSeconds);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#50FA7B">WasInputKeyJustPressed</span><span style="color:#F8F8F2">(EKeys</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">Q))</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (LockInputPosition.</span><span style="color:#50FA7B">IsSet</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            LockInputPosition.</span><span style="color:#50FA7B">Reset</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        else</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#FF79C6">            float</span><span style="color:#F8F8F2"> X, Y;</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#F8F8F2"> (</span><span style="color:#50FA7B">GetMousePosition</span><span style="color:#F8F8F2">(X, Y))</span></span>
<span class="line"><span style="color:#F8F8F2">            {</span></span>
<span class="line"><span style="color:#F8F8F2">                LockInputPosition </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> FVector2D</span><span style="color:#F8F8F2">(X, Y);</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> Now </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> GetWorld</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">?</span><span style="color:#50FA7B"> GetWorld</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">GetTimeSeconds</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> ((Now </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> LastMovementSendTimestamp) </span><span style="color:#FF79C6">&gt;=</span><span style="color:#F8F8F2"> SendUpdatesFrequency)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        LastMovementSendTimestamp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Now;</span></span>
<span class="line"><span style="color:#F8F8F2">        FVector2D LatestDesiredDirection </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> ComputeDesiredDirection</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#6272A4">        // Send whatever the controller last told us.</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> ((LatestDesiredDirection.X </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6"> &amp;&amp;</span><span style="color:#F8F8F2"> LatestDesiredDirection.Y </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#FF79C6">            const</span><span style="color:#F8F8F2"> FVector2D ConvertDirection </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> FVector2D</span><span style="color:#F8F8F2">(LatestDesiredDirection.X, LatestDesiredDirection.Y</span><span style="color:#FF79C6">*-</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">            AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">Instance</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Reducers</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">UpdatePlayerInput</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">ToDbVector</span><span style="color:#F8F8F2">(ConvertDirection));</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<div class="theme-admonition theme-admonition-warning admonition_scYj alert alert--warning"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_O7JJ"><p>Be sure to rebuild your project after making changes to the code.</p></div></div>
<p>Let&#x27;s try it out! Press play and roam freely around the arena! Now we&#x27;re cooking with gas.</p>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="collisions-and-eating-food">Collisions and Eating Food<a href="#collisions-and-eating-food" class="hash-link" aria-label="Direct link to Collisions and Eating Food" title="Direct link to Collisions and Eating Food" translate="no">​</a></h3>
<p>Well this is pretty fun, but wouldn&#x27;t it be better if we could eat food and grow our circle? Surely, that&#x27;s going to be a pain, right?</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>Wrong. With SpacetimeDB it&#x27;s extremely easy. All we have to do is add an <code>is_overlapping</code> helper function which does some basic math based on mass radii, and modify our <code>move_all_player</code> reducer to loop through every entity in the arena for every circle, checking each for overlaps. This may not be the most efficient way to do collision checking (building a quad tree or doing <a href="https://conkerjo.wordpress.com/2009/06/13/spatial-hashing-implementation-for-fast-2d-collisions/" target="_blank" rel="noopener noreferrer">spatial hashing</a> might be better), but SpacetimeDB is very fast so for this number of entities it&#x27;ll be a breeze for SpacetimeDB.</p><p>Sometimes simple is best! Add the following code to your <code>lib.rs</code> file and make sure to replace the existing <code>move_all_players</code> reducer.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> MINIMUM_SAFE_MASS_RATIO</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 0.85</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> is_overlapping</span><span style="color:#F8F8F2">(a</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#F8F8F2">, b</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> bool</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> dx </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> a</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">position</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> b</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">position</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x;</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> dy </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> a</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">position</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> b</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">position</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y;</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> distance_sq </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> dx </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> dx </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> dy </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> dy;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> radius_a </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> mass_to_radius</span><span style="color:#F8F8F2">(a</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass);</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> radius_b </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> mass_to_radius</span><span style="color:#F8F8F2">(b</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // If the distance between the two circle centers is less than the</span></span>
<span class="line"><span style="color:#6272A4">    // maximum radius, then the center of the smaller circle is inside</span></span>
<span class="line"><span style="color:#6272A4">    // the larger circle. This gives some leeway for the circles to overlap</span></span>
<span class="line"><span style="color:#6272A4">    // before being eaten.</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> max_radius </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">max</span><span style="color:#F8F8F2">(radius_a, radius_b);</span></span>
<span class="line"><span style="color:#F8F8F2">    distance_sq </span><span style="color:#FF79C6">&lt;=</span><span style="color:#F8F8F2"> max_radius </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> max_radius</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> move_all_players</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, _timer</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> MoveAllPlayersTimer</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">id</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Config not found&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">world_size;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Handle player input</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> circle_entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#FF79C6"> !</span><span style="color:#F8F8F2">circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">is_some</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#6272A4">            // This can happen if a circle is eaten by another circle</span></span>
<span class="line"><span style="color:#FF79C6">            continue</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> circle_entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">unwrap</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> circle_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> mass_to_radius</span><span style="color:#F8F8F2">(circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> direction </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">direction </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">speed;</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> new_pos </span><span style="color:#FF79C6">=</span></span>
<span class="line"><span style="color:#F8F8F2">            circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">position </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> direction </span><span style="color:#FF79C6">*</span><span style="color:#50FA7B"> mass_to_max_move_speed</span><span style="color:#F8F8F2">(circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> min </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> circle_radius;</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> max </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> -</span><span style="color:#F8F8F2"> circle_radius;</span></span>
<span class="line"><span style="color:#F8F8F2">        circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">position</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> new_pos</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">x</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clamp</span><span style="color:#F8F8F2">(min, max);</span></span>
<span class="line"><span style="color:#F8F8F2">        circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">position</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> new_pos</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">y</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clamp</span><span style="color:#F8F8F2">(min, max);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        // Check collisions</span></span>
<span class="line"><span style="color:#FF79C6">        for</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#F8F8F2"> entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id </span><span style="color:#FF79C6">==</span><span style="color:#F8F8F2"> circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id {</span></span>
<span class="line"><span style="color:#FF79C6">                continue</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#50FA7B"> is_overlapping</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">circle_entity, </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">entity) {</span></span>
<span class="line"><span style="color:#6272A4">                // Check to see if we&#x27;re overlapping with food</span></span>
<span class="line"><span style="color:#FF79C6">                if</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">food</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">is_some</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#F8F8F2">                    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">                    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">food</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">                    circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass;</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">                // Check to see if we&#x27;re overlapping with another circle owned by another player</span></span>
<span class="line"><span style="color:#FF79C6">                let</span><span style="color:#F8F8F2"> other_circle </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#FF79C6">                if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Some</span><span style="color:#F8F8F2">(other_circle) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> other_circle {</span></span>
<span class="line"><span style="color:#FF79C6">                    if</span><span style="color:#F8F8F2"> other_circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">player_id </span><span style="color:#FF79C6">!=</span><span style="color:#F8F8F2"> circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">player_id {</span></span>
<span class="line"><span style="color:#FF79C6">                        let</span><span style="color:#F8F8F2"> mass_ratio </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> /</span><span style="color:#F8F8F2"> circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">                        if</span><span style="color:#F8F8F2"> mass_ratio </span><span style="color:#FF79C6">&lt;</span><span style="color:#BD93F9"> MINIMUM_SAFE_MASS_RATIO</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">                            ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">                            ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">                            circle_entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">mass;</span></span>
<span class="line"><span style="color:#F8F8F2">                        }</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">update</span><span style="color:#F8F8F2">(circle_entity);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>Wrong. With SpacetimeDB it&#x27;s extremely easy. All we have to do is add an <code>IsOverlapping</code> helper function which does some basic math based on mass radii, and modify our <code>MoveAllPlayers</code> reducer to loop through every entity in the arena for every circle, checking each for overlaps. This may not be the most efficient way to do collision checking (building a quad tree or doing <a href="https://conkerjo.wordpress.com/2009/06/13/spatial-hashing-implementation-for-fast-2d-collisions/" target="_blank" rel="noopener noreferrer">spatial hashing</a> might be better), but SpacetimeDB is very fast so for this number of entities it&#x27;ll be a breeze for SpacetimeDB.</p><p>Sometimes simple is best! Add the following code to the <code>Module</code> class of your <code>Lib.cs</code> file and make sure to replace the existing <code>MoveAllPlayers</code> reducer.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">const</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> MINIMUM_SAFE_MASS_RATIO </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.85f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> bool</span><span style="color:#50FA7B"> IsOverlapping</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#FFB86C;font-style:italic"> a</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#FFB86C;font-style:italic"> b</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> dx </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> a.position.x </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> b.position.x;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> dy </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> a.position.y </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> b.position.y;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> distance_sq </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> dx </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> dx </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> dy </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> dy;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> radius_a </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(a.mass);</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> radius_b </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(b.mass);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // If the distance between the two circle centers is less than the</span></span>
<span class="line"><span style="color:#6272A4">    // maximum radius, then the center of the smaller circle is inside</span></span>
<span class="line"><span style="color:#6272A4">    // the larger circle. This gives some leeway for the circles to overlap</span></span>
<span class="line"><span style="color:#6272A4">    // before being eaten.</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> max_radius </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> radius_a </span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> radius_b </span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2"> radius_a</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> radius_b;</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> distance_sq </span><span style="color:#FF79C6">&lt;=</span><span style="color:#F8F8F2"> max_radius </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> max_radius;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> MoveAllPlayers</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">MoveAllPlayersTimer</span><span style="color:#FFB86C;font-style:italic"> timer</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (ctx.Db.config.id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Config not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)).world_size;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Handle player input</span></span>
<span class="line"><span style="color:#FF79C6">    foreach</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx.Db.circle.</span><span style="color:#50FA7B">Iter</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> check_entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.entity.entity_id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(circle.entity_id);</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (check_entity </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> null</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#6272A4">            // This can happen if the circle has been eaten by another circle.</span></span>
<span class="line"><span style="color:#FF79C6">            continue</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> circle_entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> check_entity.Value;</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> circle_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(circle_entity.mass);</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> direction </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> circle.direction </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> circle.speed;</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> new_pos </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> circle_entity.position </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> direction </span><span style="color:#FF79C6">*</span><span style="color:#50FA7B"> MassToMaxMoveSpeed</span><span style="color:#F8F8F2">(circle_entity.mass);</span></span>
<span class="line"><span style="color:#F8F8F2">        circle_entity.position.x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Math.</span><span style="color:#50FA7B">Clamp</span><span style="color:#F8F8F2">(new_pos.x, circle_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> circle_radius);</span></span>
<span class="line"><span style="color:#F8F8F2">        circle_entity.position.y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Math.</span><span style="color:#50FA7B">Clamp</span><span style="color:#F8F8F2">(new_pos.y, circle_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> circle_radius);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        // Check collisions</span></span>
<span class="line"><span style="color:#FF79C6">        foreach</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx.Db.entity.</span><span style="color:#50FA7B">Iter</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#F8F8F2"> (entity.entity_id </span><span style="color:#FF79C6">==</span><span style="color:#F8F8F2"> circle_entity.entity_id)</span></span>
<span class="line"><span style="color:#F8F8F2">            {</span></span>
<span class="line"><span style="color:#FF79C6">                continue</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#F8F8F2"> (</span><span style="color:#50FA7B">IsOverlapping</span><span style="color:#F8F8F2">(circle_entity, entity))</span></span>
<span class="line"><span style="color:#F8F8F2">            {</span></span>
<span class="line"><span style="color:#6272A4">                // Check to see if we&#x27;re overlapping with food</span></span>
<span class="line"><span style="color:#FF79C6">                if</span><span style="color:#F8F8F2"> (ctx.Db.food.entity_id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(entity.entity_id).HasValue) {</span></span>
<span class="line"><span style="color:#F8F8F2">                    ctx.Db.entity.entity_id.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(entity.entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">                    ctx.Db.food.entity_id.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(entity.entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">                    circle_entity.mass </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> entity.mass;</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">                // Check to see if we&#x27;re overlapping with another circle owned by another player</span></span>
<span class="line"><span style="color:#FF79C6">                var</span><span style="color:#F8F8F2"> other_circle </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.circle.entity_id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(entity.entity_id);</span></span>
<span class="line"><span style="color:#FF79C6">                if</span><span style="color:#F8F8F2"> (other_circle.HasValue </span><span style="color:#FF79C6">&amp;&amp;</span></span>
<span class="line"><span style="color:#F8F8F2">                    other_circle.Value.player_id </span><span style="color:#FF79C6">!=</span><span style="color:#F8F8F2"> circle.player_id)</span></span>
<span class="line"><span style="color:#F8F8F2">                {</span></span>
<span class="line"><span style="color:#FF79C6">                    var</span><span style="color:#F8F8F2"> mass_ratio </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">float</span><span style="color:#F8F8F2">)entity.mass </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> circle_entity.mass;</span></span>
<span class="line"><span style="color:#FF79C6">                    if</span><span style="color:#F8F8F2"> (mass_ratio </span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2"> MINIMUM_SAFE_MASS_RATIO)</span></span>
<span class="line"><span style="color:#F8F8F2">                    {</span></span>
<span class="line"><span style="color:#F8F8F2">                        ctx.Db.entity.entity_id.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(entity.entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">                        ctx.Db.circle.entity_id.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(entity.entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">                        circle_entity.mass </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> entity.mass;</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.entity.entity_id.</span><span style="color:#50FA7B">Update</span><span style="color:#F8F8F2">(circle_entity);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div></div></div>
<p>For every circle, we look at all other entities. If they are overlapping then for food, we add the mass of the food to the circle and delete the food, otherwise if it&#x27;s a circle we delete the smaller circle and add the mass to the bigger circle.</p>
<p>That&#x27;s it. We don&#x27;t even have to do anything on the client.</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> publish</span><span style="color:#BD93F9"> --server</span><span style="color:#F1FA8C"> local</span><span style="color:#F1FA8C"> blackholio</span></span></code></pre>
<p>Just update your module by publishing and you&#x27;re on your way eating food! Try to see how big you can get!</p>
<p>We didn&#x27;t even have to update the client, because our client&#x27;s <code>OnDelete</code> callbacks already handled deleting entities from the scene when they&#x27;re deleted on the server. SpacetimeDB just synchronizes the state with your client automatically.</p>
<p>Notice that the food automatically respawns as you vaccuum them up. This is because our scheduled reducer is automatically replacing the food 2 times per second, to ensure that there is always 600 food on the map.</p>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="connecting-to-maincloud">Connecting to Maincloud<a href="#connecting-to-maincloud" class="hash-link" aria-label="Direct link to Connecting to Maincloud" title="Direct link to Connecting to Maincloud" translate="no">​</a></h2>
<ul>
<li>Publish to Maincloud <code>spacetime publish -s maincloud &lt;your database name&gt; --delete-data</code>
<ul>
<li><code>&lt;your database name&gt;</code> This name should be unique and cannot contain any special characters other than internal hyphens (<code>-</code>).</li>
</ul>
</li>
<li>Update the URL in the Unreal project to: <code>https://maincloud.spacetimedb.com</code></li>
<li>Update the module name in the Unreal project to <code>&lt;your database name&gt;</code>.</li>
<li>Your <code>BP_GameManager</code> should look something like this:</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Maincloud Setup" src="/assets/images/part-4-01-maincloud-ccbcfb0ad0be20010ea9af2d5362c35f.png" width="474" height="368" class="img_f3N0"></p>
<p>To delete your Maincloud database, you can run: <code>spacetime delete -s maincloud &lt;your database name&gt;</code></p>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">​</a></h2>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>So far you&#x27;ve learned how to configure a new Unreal project to work with SpacetimeDB, how to develop, build, and publish a SpacetimeDB server module. Within the module, you&#x27;ve learned how to create tables, update tables, and write reducers. You&#x27;ve learned about special reducers like <code>client_connected</code> and <code>init</code> and how to created scheduled reducers. You learned how we can used scheduled reducers to implement a physics simulation right within your module.</p></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>So far you&#x27;ve learned how to configure a new Unreal project to work with SpacetimeDB, how to develop, build, and publish a SpacetimeDB server module. Within the module, you&#x27;ve learned how to create tables, update tables, and write reducers. You&#x27;ve learned about special reducers like <code>ClientConnected</code> and <code>Init</code> and how to created scheduled reducers. You learned how we can used scheduled reducers to implement a physics simulation right within your module.</p></div></div></div>
<p>You&#x27;ve also learned how view module logs and connect your client to your database server, call reducers from the client and synchronize the data with client. Finally you learned how to use that synchronized data to draw game objects on the screen, so that we can interact with them and play a game!</p>
<p>And all of that completely from scratch!</p>
<p>Our game is still pretty limited in some important ways. The biggest limitation is that the client assumes your username is &quot;TestPlayer&quot; and doesn&#x27;t give you a menu or a window to set your username before joining the game. Notably, we do not have a unique constraint on the <code>name</code> column, so that does not prevent us from connecting multiple clients to the same server.</p>
<p>In fact, if you build what we have and run multiple clients you already have a (very simple) MMO! You can connect hundreds of players to this arena with SpacetimeDB.</p>
<p>There&#x27;s still plenty more we can do to build this into a proper game though. For example, you might want to also add</p>
<ul>
<li>Username chooser</li>
<li>Chat</li>
<li>Leaderboards</li>
<li>Nice animations</li>
<li>Nice shaders</li>
<li>Space theme!</li>
</ul>
<p>Fortunately, we&#x27;ve done that for you! If you&#x27;d like to check out the completed tutorial game, with these additional features, you can download it on GitHub:</p>
<p><a href="https://github.com/clockworklabs/SpacetimeDB/tree/master/demo/Blackholio" target="_blank" rel="noopener noreferrer">https://github.com/clockworklabs/SpacetimeDB/tree/master/demo/Blackholio</a></p>
<p>If you have any suggestions or comments on the tutorial, either <a href="https://github.com/clockworklabs/SpacetimeDB/issues/new" target="_blank" rel="noopener noreferrer">open an issue</a>, or join our Discord (<a href="https://discord.gg/SpacetimeDB" target="_blank" rel="noopener noreferrer">https://discord.gg/SpacetimeDB</a>) and chat with us!</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/unreal/part-3"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">3 - Gameplay</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cli-reference"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CLI Reference</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Ea_L thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#moving-the-player" class="table-of-contents__link toc-highlight">Moving the player</a></li><li><a href="#moving-on-the-client" class="table-of-contents__link toc-highlight">Moving on the Client</a></li><li><a href="#collisions-and-eating-food" class="table-of-contents__link toc-highlight">Collisions and Eating Food</a></li><li><a href="#connecting-to-maincloud" class="table-of-contents__link toc-highlight">Connecting to Maincloud</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"></div></footer></div>
</body>
</html>