<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Unreal Tutorial/Part-3" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">3 - Gameplay | SpacetimeDB docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.spacetimedb.com/unreal/part-3"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="3 - Gameplay | SpacetimeDB docs"><meta data-rh="true" name="description" content="Need help with the tutorial? Join our Discord server!"><meta data-rh="true" property="og:description" content="Need help with the tutorial? Join our Discord server!"><link data-rh="true" rel="icon" href="/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.spacetimedb.com/unreal/part-3"><link data-rh="true" rel="alternate" href="https://docs.spacetimedb.com/unreal/part-3" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.spacetimedb.com/unreal/part-3" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QBC7Z9KXS2-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"3 - Gameplay","item":"https://docs.spacetimedb.com/unreal/part-3"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="SpacetimeDB docs" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.0cb9f7a7.css">
<script src="/assets/js/runtime~main.d71df0f5.js" defer="defer"></script>
<script src="/assets/js/main.31d95d83.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="https://spacetimedb.com/images/brand.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_6jFv" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="https://spacetimedb.com/images/brand.png" alt="SpacetimeDB Logo" class="themedComponent_rvet themedComponent--light_mbAJ"><img src="https://spacetimedb.com/images/brand.png" alt="SpacetimeDB Logo" class="themedComponent_rvet themedComponent--dark_Ncy6"></div></a><div class="navbarSearchContainer_AesG"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://spacetimedb.com/install" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Install</a><a href="https://spacetimedb.com/pricing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Pricing</a><a href="https://spacetimedb.com/maincloud" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Maincloud</a><a href="https://spacetimedb.com/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://spacetimedb.com/community" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_hV_y"><div class="docsWrapper_f07g"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_MJiz" type="button"></button><div class="docRoot_Gd2s"><aside class="theme-doc-sidebar-container docSidebarContainer_fSpF"><div class="sidebarViewport_YElg"><div class="sidebar_kjg4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_AG0n"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/"><span title="Intro" class="categoryLinkLabel_EDYQ">Intro</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/deploying/maincloud"><span title="Deploying" class="categoryLinkLabel_EDYQ">Deploying</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/unity"><span title="Unity tutorial" class="categoryLinkLabel_EDYQ">Unity tutorial</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/unreal"><span title="Unreal Tutorial" class="categoryLinkLabel_EDYQ">Unreal Tutorial</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unreal"><span title="Overview" class="linkLabel_dpMB">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unreal/part-1"><span title="1 - Setup" class="linkLabel_dpMB">1 - Setup</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unreal/part-2"><span title="2 - Connecting to SpacetimeDB" class="linkLabel_dpMB">2 - Connecting to SpacetimeDB</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/unreal/part-3"><span title="3 - Gameplay" class="linkLabel_dpMB">3 - Gameplay</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unreal/part-4"><span title="4 - Moving and Colliding" class="linkLabel_dpMB">4 - Moving and Colliding</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cli-reference"><span title="CLI Reference" class="categoryLinkLabel_EDYQ">CLI Reference</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/modules"><span title="Server Module Languages" class="categoryLinkLabel_EDYQ">Server Module Languages</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sdks"><span title="Client SDK Languages" class="categoryLinkLabel_EDYQ">Client SDK Languages</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sql"><span title="SQL" class="categoryLinkLabel_EDYQ">SQL</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/subscriptions"><span title="Subscriptions" class="categoryLinkLabel_EDYQ">Subscriptions</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rls"><span title="Row Level Security" class="linkLabel_dpMB">Row Level Security</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/how-to/incremental-migrations"><span title="How-To" class="categoryLinkLabel_EDYQ">How-To</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/spacetimeauth"><span title="SpacetimeAuth" class="categoryLinkLabel_EDYQ">SpacetimeAuth</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/http/authorization"><span title="HTTP API" class="categoryLinkLabel_EDYQ">HTTP API</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/webassembly-abi"><span title="Internals" class="categoryLinkLabel_EDYQ">Internals</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/appendix"><span title="Appendix" class="linkLabel_dpMB">Appendix</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_dkUT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_w2oE"><div class="docItemContainer_f71m"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_xsLZ" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_oyay"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Unreal Tutorial</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">3 - Gameplay</span></li></ul></nav><div class="tocCollapsible_dqme theme-doc-toc-mobile tocMobile_Z34P"><button type="button" class="clean-btn tocCollapsibleButton_QMSE">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Unreal Tutorial - Part 3 - Gameplay</h1></header>
<p>Need help with the tutorial? <a href="https://discord.gg/spacetimedb" target="_blank" rel="noopener noreferrer">Join our Discord server</a>!</p>
<p>This progressive tutorial is continued from <a href="/unreal/part-2">part 2</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="spawning-food">Spawning Food<a href="#spawning-food" class="hash-link" aria-label="Direct link to Spawning Food" title="Direct link to Spawning Food" translate="no">​</a></h3>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>Let&#x27;s start by spawning food into the map. The first thing we need to do is create a new, special reducer called the <code>init</code> reducer. SpacetimeDB calls the <code>init</code> reducer automatically when first publish your module, and also after any time you run with <code>publish --delete-data</code>. It gives you an opportunity to initialize the state of your database before any clients connect.</p><p>Add this new reducer above our <code>connect</code> reducer.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#6272A4">// Note the `init` parameter passed to the reducer macro.</span></span>
<span class="line"><span style="color:#6272A4">// That indicates to SpacetimeDB that it should be called</span></span>
<span class="line"><span style="color:#6272A4">// once upon database creation.</span></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer(init)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> init</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2">    log</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">info!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Initializing...&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Config</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        world_size</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1000</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>This reducer also demonstrates how to insert new rows into a table. Here we are adding a single <code>Config</code> row to the <code>config</code> table with the <code>try_insert</code> function. <code>try_insert</code> returns an error if inserting the row into the table would violate any constraints, like unique constraints, on the table. You can also use <code>insert</code> which panics on constraint violations if you know for sure that you will not violate any constraints.</p><p>Now that we&#x27;ve ensured that our database always has a valid <code>world_size</code> let&#x27;s spawn some food into the map. Add the following code to the end of the file.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> FOOD_MASS_MIN</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> FOOD_MASS_MAX</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 4</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> TARGET_FOOD_COUNT</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> usize</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 600</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> mass_to_radius</span><span style="color:#F8F8F2">(mass</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    (mass </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">sqrt</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> spawn_food</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">count</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">        // Are there no logged in players? Skip food spawn.</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#8BE9FD;font-style:italic"> Ok</span><span style="color:#F8F8F2">(());</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">id</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Config not found&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">world_size;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> rng </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">rng</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> food_count </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">food</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">count</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">    while</span><span style="color:#F8F8F2"> food_count </span><span style="color:#FF79C6">&lt;</span><span style="color:#BD93F9"> TARGET_FOOD_COUNT</span><span style="color:#FF79C6"> as</span><span style="color:#8BE9FD;font-style:italic"> u64</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> food_mass </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">gen_range</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">FOOD_MASS_MIN</span><span style="color:#FF79C6">..</span><span style="color:#BD93F9">FOOD_MASS_MAX</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> food_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> mass_to_radius</span><span style="color:#F8F8F2">(food_mass);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">gen_range</span><span style="color:#F8F8F2">(food_radius</span><span style="color:#FF79C6">..</span><span style="color:#F8F8F2">world_size </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> -</span><span style="color:#F8F8F2"> food_radius);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">gen_range</span><span style="color:#F8F8F2">(food_radius</span><span style="color:#FF79C6">..</span><span style="color:#F8F8F2">world_size </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> -</span><span style="color:#F8F8F2"> food_radius);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            entity_id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">            position</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> { x, y },</span></span>
<span class="line"><span style="color:#F8F8F2">            mass</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> food_mass,</span></span>
<span class="line"><span style="color:#F8F8F2">        })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">food</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Food</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            entity_id</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        food_count </span><span style="color:#FF79C6">+=</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        log</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">info!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Spawned food! {}&quot;</span><span style="color:#F8F8F2">, entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>In this reducer, we are using the <code>world_size</code> we configured along with the <code>ReducerContext</code>&#x27;s random number generator <code>.rng()</code> function to place 600 food uniformly randomly throughout the map. We&#x27;ve also chosen the <code>mass</code> of the food to be a random number between 2 and 4 inclusive.</p></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>Let&#x27;s start by spawning food into the map. The first thing we need to do is create a new, special reducer called the <code>Init</code> reducer. SpacetimeDB calls the <code>Init</code> reducer automatically when you first publish your module, and also after any time you run with <code>publish --delete-data</code>. It gives you an opportunity to initialize the state of your database before any clients connect.</p><p>Add this new reducer above our <code>Connect</code> reducer.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#6272A4">// Note the `init` parameter passed to the reducer macro.</span></span>
<span class="line"><span style="color:#6272A4">// That indicates to SpacetimeDB that it should be called</span></span>
<span class="line"><span style="color:#6272A4">// once upon database creation.</span></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">(ReducerKind.Init)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Init</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Log.</span><span style="color:#50FA7B">Info</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">$&quot;</span><span style="color:#F1FA8C">Initializing...</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.config.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Config</span><span style="color:#F8F8F2"> { world_size </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1000</span><span style="color:#F8F8F2"> });</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>This reducer also demonstrates how to insert new rows into a table. Here we are adding a single <code>Config</code> row to the <code>config</code> table with the <code>Insert</code> function.</p><p>Now that we&#x27;ve ensured that our database always has a valid <code>world_size</code> let&#x27;s spawn some food into the map. Add the following code to the end of the <code>Module</code> class.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">const</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> FOOD_MASS_MIN </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> FOOD_MASS_MAX </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 4</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> TARGET_FOOD_COUNT </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 600</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> float</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> mass</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> MathF.</span><span style="color:#50FA7B">Sqrt</span><span style="color:#F8F8F2">(mass);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> SpawnFood</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (ctx.Db.player.Count </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">//Are there no players yet?</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (ctx.Db.config.id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Config not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)).world_size;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> rng </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Rng;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> food_count </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.food.Count;</span></span>
<span class="line"><span style="color:#FF79C6">    while</span><span style="color:#F8F8F2"> (food_count </span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2"> TARGET_FOOD_COUNT)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> food_mass </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">Range</span><span style="color:#F8F8F2">(FOOD_MASS_MIN, FOOD_MASS_MAX);</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> food_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(food_mass);</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">Range</span><span style="color:#F8F8F2">(food_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> food_radius);</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">Range</span><span style="color:#F8F8F2">(food_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> food_radius);</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.entity.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Entity</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            position </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(x, y),</span></span>
<span class="line"><span style="color:#F8F8F2">            mass </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> food_mass,</span></span>
<span class="line"><span style="color:#F8F8F2">        });</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.food.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Food</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            entity_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> entity.entity_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        });</span></span>
<span class="line"><span style="color:#F8F8F2">        food_count</span><span style="color:#FF79C6">++</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        Log.</span><span style="color:#50FA7B">Info</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">$&quot;</span><span style="color:#F1FA8C">Spawned food! </span><span style="color:#FF79C6">{</span><span style="color:#F8F8F2">entity</span><span style="color:#F1FA8C">.</span><span style="color:#F8F8F2">entity_id</span><span style="color:#FF79C6">}</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> float</span><span style="color:#50FA7B"> Range</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">this</span><span style="color:#8BE9FD;font-style:italic"> Random</span><span style="color:#FFB86C;font-style:italic"> rng</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> min</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> max</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">NextSingle</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> (max </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> min) </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> min;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> uint</span><span style="color:#50FA7B"> Range</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">this</span><span style="color:#8BE9FD;font-style:italic"> Random</span><span style="color:#FFB86C;font-style:italic"> rng</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> min</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> max</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">uint</span><span style="color:#F8F8F2">)rng.</span><span style="color:#50FA7B">NextInt64</span><span style="color:#F8F8F2">(min, max);</span></span></code></pre><p>In this reducer, we are using the <code>world_size</code> we configured along with the <code>ReducerContext</code>&#x27;s random number generator <code>.rng()</code> function to place 600 food uniformly randomly throughout the map. We&#x27;ve also chosen the <code>mass</code> of the food to be a random number between 2 and 4 inclusive.</p><p>We also added two helper functions so we can get a random range as either a <code>uint</code> or a <code>float</code>.</p></div></div></div>
<p>Although, we&#x27;ve written the reducer to spawn food, no food will actually be spawned until we call the function while players are logged in. This raises the question, who should call this function and when?</p>
<p>We would like for this function to be called periodically to &quot;top up&quot; the amount of food on the map so that it never falls very far below our target amount of food. SpacetimeDB has built in functionality for exactly this. With SpacetimeDB you can schedule your module to call itself in the future or repeatedly with reducers.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>In order to schedule a reducer to be called we have to create a new table which specifies when and how a reducer should be called. Add this new table to the top of the file, below your imports.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">table(name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> spawn_food_timer, scheduled(spawn_food))]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> SpawnFoodTimer</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    #[primary_key]</span></span>
<span class="line"><span style="color:#F8F8F2">    #[auto_inc]</span></span>
<span class="line"><span style="color:#F8F8F2">    scheduled_id</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u64</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    scheduled_at</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">ScheduleAt</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>Note the <code>scheduled(spawn_food)</code> parameter in the table macro. This tells SpacetimeDB that the rows in this table specify a schedule for when the <code>spawn_food</code> reducer should be called. Each scheduled table requires a <code>scheduled_id</code> and a <code>scheduled_at</code> field so that SpacetimeDB can call your reducer, however you can also add your own fields to these rows as well.</p></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>In order to schedule a reducer to be called we have to create a new table which specifies when an how a reducer should be called. Add this new table to the top of the <code>Module</code> class.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Table</span><span style="color:#F8F8F2">(Name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">spawn_food_timer</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, Scheduled </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> nameof</span><span style="color:#F8F8F2">(SpawnFood), ScheduledAt </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> nameof</span><span style="color:#F8F8F2">(scheduled_at))]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> partial</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> SpawnFoodTimer</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    [</span><span style="color:#8BE9FD;font-style:italic">PrimaryKey</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">AutoInc</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> ulong</span><span style="color:#F8F8F2"> scheduled_id;</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#8BE9FD;font-style:italic"> ScheduleAt</span><span style="color:#F8F8F2"> scheduled_at;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>Note the <code>Scheduled = nameof(SpawnFood)</code> parameter in the table macro. This tells SpacetimeDB that the rows in this table specify a schedule for when the <code>SpawnFood</code> reducer should be called. Each scheduled table requires a <code>scheduled_id</code> and a <code>scheduled_at</code> field so that SpacetimeDB can call your reducer, however you can also add your own fields to these rows as well.</p></div></div></div>
<p>You can create, delete, or change a schedule by inserting, deleting, or updating rows in this table.</p>
<p>You will see an error telling you that the <code>spawn_food</code> reducer needs to take two arguments, but currently only takes one. This is because the schedule row must be passed in to all scheduled reducers. Modify your <code>spawn_food</code> reducer to take the scheduled row as an argument.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> spawn_food</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, _timer</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> SpawnFoodTimer</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#6272A4">    // ...</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> SpawnFood</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">SpawnFoodTimer</span><span style="color:#FFB86C;font-style:italic"> _timer</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#6272A4">    // ...</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div></div></div>
<p>In our case we aren&#x27;t interested in the data on the row, so we name the argument <code>_timer</code>.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>Let&#x27;s modify our <code>init</code> reducer to schedule our <code>spawn_food</code> reducer to be called every 500 milliseconds.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer(init)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> init</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2">    log</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">info!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Initializing...&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Config</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        world_size</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1000</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">spawn_food_timer</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">SpawnFoodTimer</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        scheduled_id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        scheduled_at</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> ScheduleAt</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Interval</span><span style="color:#F8F8F2">(Duration</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">from_millis</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">500</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into</span><span style="color:#F8F8F2">()),</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p>You can use <code>ScheduleAt::Interval</code> to schedule a reducer call at an interval like we&#x27;re doing here. SpacetimeDB will continue to call the reducer at this interval until you remove the row. You can also use <code>ScheduleAt::Time()</code> to specify a specific at which to call a reducer once. SpacetimeDB will remove that row automatically after the reducer has been called.</p></div></div></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>Let&#x27;s modify our <code>Init</code> reducer to schedule our <code>SpawnFood</code> reducer to be called every 500 milliseconds.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">(ReducerKind.Init)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Init</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Log.</span><span style="color:#50FA7B">Info</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">$&quot;</span><span style="color:#F1FA8C">Initializing...</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.config.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Config</span><span style="color:#F8F8F2"> { world_size </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1000</span><span style="color:#F8F8F2"> });</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.spawn_food_timer.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> SpawnFoodTimer</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        scheduled_at </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> ScheduleAt</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Interval</span><span style="color:#F8F8F2">(TimeSpan.</span><span style="color:#50FA7B">FromMilliseconds</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">500</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    });</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p>You can use <code>ScheduleAt.Interval</code> to schedule a reducer call at an interval like we&#x27;re doing here. SpacetimeDB will continue to call the reducer at this interval until you remove the row. You can also use <code>ScheduleAt.Time()</code> to specify a specific at which to call a reducer once. SpacetimeDB will remove that row automatically after the reducer has been called.</p></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="logging-players-in">Logging Players In<a href="#logging-players-in" class="hash-link" aria-label="Direct link to Logging Players In" title="Direct link to Logging Players In" translate="no">​</a></h3>
<p>Let&#x27;s continue building out our server module by modifying it to log in a player when they connect to the database, or to create a new player if they&#x27;ve never connected before.</p>
<p>Let&#x27;s add a second table to our <code>Player</code> struct. Modify the <code>Player</code> struct by adding this above the struct:</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">table(name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> logged_out_player)]</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Table</span><span style="color:#F8F8F2">(Name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">logged_out_player</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)]</span></span></code></pre></div></div></div>
<p>Your struct should now look like this:</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">table(name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> player, public)]</span></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">table(name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> logged_out_player)]</span></span>
<span class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD;font-style:italic">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Clone</span><span style="color:#F8F8F2">)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> Player</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    #[primary_key]</span></span>
<span class="line"><span style="color:#F8F8F2">    identity</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Identity</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    #[unique]</span></span>
<span class="line"><span style="color:#F8F8F2">    #[auto_inc]</span></span>
<span class="line"><span style="color:#F8F8F2">    player_id</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    name</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Table</span><span style="color:#F8F8F2">(Name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">player</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, Public </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">)]</span></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Table</span><span style="color:#F8F8F2">(Name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">logged_out_player</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> partial</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> Player</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    [</span><span style="color:#8BE9FD;font-style:italic">PrimaryKey</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#8BE9FD;font-style:italic"> Identity</span><span style="color:#F8F8F2"> identity;</span></span>
<span class="line"><span style="color:#F8F8F2">    [</span><span style="color:#8BE9FD;font-style:italic">Unique</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">AutoInc</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> player_id;</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> string</span><span style="color:#F8F8F2"> name;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div></div></div>
<p>This line creates an additional tabled called <code>logged_out_player</code> whose rows share the same <code>Player</code> type as in the <code>player</code> table.</p>
<div class="theme-admonition theme-admonition-danger admonition_scYj alert alert--danger"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_O7JJ"><p>Note that this new table is not marked <code>public</code>. This means that it can only be accessed by the database owner (which is almost always the database creator). In order to prevent any unintended data access, all SpacetimeDB tables are private by default.</p><p>If your client isn&#x27;t syncing rows from the server, check that your table is not accidentally marked private.</p></div></div>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>Next, modify your <code>connect</code> reducer and add a new <code>disconnect</code> reducer below it:</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer(client_connected)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> connect</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Some</span><span style="color:#F8F8F2">(player) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">logged_out_player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender) {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(player</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clone</span><span style="color:#F8F8F2">());</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">            .</span><span style="color:#50FA7B">logged_out_player</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">            .</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">            .</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">player</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">identity);</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Player</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            identity</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender,</span></span>
<span class="line"><span style="color:#F8F8F2">            player_id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">            name</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> String</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(),</span></span>
<span class="line"><span style="color:#F8F8F2">        })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer(client_disconnected)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> disconnect</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Player not found&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> player</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">player_id;</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">logged_out_player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>Next, modify your <code>Connect</code> reducer and add a new <code>Disconnect</code> reducer below it:</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">(ReducerKind.ClientConnected)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Connect</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.logged_out_player.identity.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(ctx.Sender);</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (player </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> null</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.player.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(player.Value);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.logged_out_player.identity.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(player.Value.identity);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    else</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.player.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Player</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            identity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Sender,</span></span>
<span class="line"><span style="color:#F8F8F2">            name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;&quot;</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        });</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">(ReducerKind.ClientDisconnected)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Disconnect</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.player.identity.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(ctx.Sender) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Player not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.logged_out_player.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.player.identity.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(player.identity);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div></div></div>
<p>Now when a client connects, if the player corresponding to the client is in the <code>logged_out_player</code> table, we will move them into the <code>player</code> table, thus indicating that they are logged in and connected. For any new unrecognized client connects we will create a <code>Player</code> and insert it into the <code>player</code> table.</p>
<p>When a player disconnects, we will transfer their player row from the <code>player</code> table to the <code>logged_out_player</code> table to indicate they&#x27;re offline.</p>
<blockquote>
<p>Note that we could have added a <code>logged_in</code> boolean to the <code>Player</code> type to indicated whether the player is logged in. There&#x27;s nothing incorrect about that approach, however for several reasons we recommend this two table approach:</p>
<ul>
<li>We can iterate over all logged in players without any <code>if</code> statements or branching</li>
<li>The <code>Player</code> type now uses less program memory improving cache efficiency</li>
<li>We can easily check whether a player is logged in, based on whether their row exists in the <code>player</code> table</li>
</ul>
<p>This approach is more generally referred to as <a href="https://www.dataorienteddesign.com/dodmain/node4.html" target="_blank" rel="noopener noreferrer">existence based processing</a> and it is a common technique in data-oriented design.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="spawning-player-circles">Spawning Player Circles<a href="#spawning-player-circles" class="hash-link" aria-label="Direct link to Spawning Player Circles" title="Direct link to Spawning Player Circles" translate="no">​</a></h3>
<p>Now that we&#x27;ve got our food spawning and our players set up, let&#x27;s create a match and spawn player circle entities into it. The first thing we should do before spawning a player into a match is give them a name.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>Add the following to the bottom of your file.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> START_PLAYER_MASS</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 15</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> enter_game</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, name</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2">    log</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">info!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Creating player with name {}&quot;</span><span style="color:#F8F8F2">, name);</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> player</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Player</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> player</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">player_id;</span></span>
<span class="line"><span style="color:#F8F8F2">    player</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name;</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">update</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#50FA7B">    spawn_player_initial_circle</span><span style="color:#F8F8F2">(ctx, player_id)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> spawn_player_initial_circle</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, player_id</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> rng </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">rng</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">id</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Config not found&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">world_size;</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player_start_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> mass_to_radius</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">START_PLAYER_MASS</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">gen_range</span><span style="color:#F8F8F2">(player_start_radius</span><span style="color:#FF79C6">..</span><span style="color:#F8F8F2">(world_size </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> -</span><span style="color:#F8F8F2"> player_start_radius));</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">gen_range</span><span style="color:#F8F8F2">(player_start_radius</span><span style="color:#FF79C6">..</span><span style="color:#F8F8F2">(world_size </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> -</span><span style="color:#F8F8F2"> player_start_radius));</span></span>
<span class="line"><span style="color:#50FA7B">    spawn_circle_at</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx,</span></span>
<span class="line"><span style="color:#F8F8F2">        player_id,</span></span>
<span class="line"><span style="color:#BD93F9">        START_PLAYER_MASS</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        DbVector2</span><span style="color:#F8F8F2"> { x, y },</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">timestamp,</span></span>
<span class="line"><span style="color:#F8F8F2">    )</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> spawn_circle_at</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    player_id</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    mass</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    position</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    timestamp</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Timestamp</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        entity_id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        position,</span></span>
<span class="line"><span style="color:#F8F8F2">        mass,</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Circle</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        entity_id</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        player_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        direction</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> { x</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0.0</span><span style="color:#F8F8F2">, y</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1.0</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">        speed</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0.0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        last_split_time</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> timestamp,</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(entity)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>The <code>enter_game</code> reducer takes one argument, the player&#x27;s <code>name</code>. We can use this name to display as a label for the player in the match, by storing the name on the player&#x27;s row. We are also spawning some circles for the player to control now that they are entering the game. To do this, we choose a random position within the bounds of the arena and create a new entity and corresponding circle row.</p></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>Add the following to the end of the <code>Module</code> class.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">const</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> START_PLAYER_MASS </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 15</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> EnterGame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">string</span><span style="color:#FFB86C;font-style:italic"> name</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Log.</span><span style="color:#50FA7B">Info</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">$&quot;</span><span style="color:#F1FA8C">Creating player with name </span><span style="color:#FF79C6">{</span><span style="color:#F8F8F2">name</span><span style="color:#FF79C6">}</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.player.identity.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(ctx.Sender) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Player not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    player.name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name;</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.player.identity.</span><span style="color:#50FA7B">Update</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#50FA7B">    SpawnPlayerInitialCircle</span><span style="color:#F8F8F2">(ctx, player.player_id);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> Entity</span><span style="color:#50FA7B"> SpawnPlayerInitialCircle</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> player_id</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> rng </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Rng;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (ctx.Db.config.id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Config not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)).world_size;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> player_start_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(START_PLAYER_MASS);</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">Range</span><span style="color:#F8F8F2">(player_start_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> player_start_radius);</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">Range</span><span style="color:#F8F8F2">(player_start_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> player_start_radius);</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#50FA7B"> SpawnCircleAt</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx,</span></span>
<span class="line"><span style="color:#F8F8F2">        player_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        START_PLAYER_MASS,</span></span>
<span class="line"><span style="color:#FF79C6">        new</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(x, y),</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Timestamp</span></span>
<span class="line"><span style="color:#F8F8F2">    );</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> Entity</span><span style="color:#50FA7B"> SpawnCircleAt</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> player_id</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> mass</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#FFB86C;font-style:italic"> position</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">SpacetimeDB</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Timestamp</span><span style="color:#FFB86C;font-style:italic"> timestamp</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.entity.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Entity</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        position </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> position,</span></span>
<span class="line"><span style="color:#F8F8F2">        mass </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> mass,</span></span>
<span class="line"><span style="color:#F8F8F2">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.circle.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Circle</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        entity_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> entity.entity_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        player_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> player_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        direction </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">        speed </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0f</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        last_split_time </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> timestamp,</span></span>
<span class="line"><span style="color:#F8F8F2">    });</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> entity;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>The <code>EnterGame</code> reducer takes one argument, the player&#x27;s <code>name</code>. We can use this name to display as a label for the player in the match, by storing the name on the player&#x27;s row. We are also spawning some circles for the player to control now that they are entering the game. To do this, we choose a random position within the bounds of the arena and create a new entity and corresponding circle row.</p></div></div></div>
<p>Let&#x27;s also modify our <code>disconnect</code> reducer to remove the circles from the arena when the player disconnects from the database server.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer(client_disconnected)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> disconnect</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Player not found&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> player</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">player_id;</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">logged_out_player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Remove any circles from the arena</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">filter</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">player_id) {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">(ReducerKind.ClientDisconnected)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Disconnect</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.player.identity.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(ctx.Sender) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Player not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#6272A4">    // Remove any circles from the arena</span></span>
<span class="line"><span style="color:#FF79C6">    foreach</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx.Db.circle.player_id.</span><span style="color:#50FA7B">Filter</span><span style="color:#F8F8F2">(player.player_id))</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.entity.entity_id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(circle.entity_id) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Could not find circle</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.entity.entity_id.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(entity.entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.circle.entity_id.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(entity.entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.logged_out_player.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.player.identity.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(player.identity);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div></div></div>
<p>Finally, publish the new module to SpacetimeDB with this command:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> publish</span><span style="color:#BD93F9"> --server</span><span style="color:#F1FA8C"> local</span><span style="color:#F1FA8C"> blackholio</span><span style="color:#BD93F9"> --delete-data</span></span></code></pre>
<p>Deleting the data is optional in this case, but in case you&#x27;ve been messing around with the module we can just start fresh.</p>
<div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p>When using <code>--delete-data</code>, SpacetimeDB will prompt you to confirm the deletion. Enter <strong>y</strong> and press <strong>Enter</strong> to proceed.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="creating-the-arena">Creating the Arena<a href="#creating-the-arena" class="hash-link" aria-label="Direct link to Creating the Arena" title="Direct link to Creating the Arena" translate="no">​</a></h3>
<p>With the server logic in place to spawn food and players, extend the Unreal client to display the current state.</p>
<p>Add the <code>SetupArena</code> and <code>CreateBorderCube</code> methods and properties to your <code>GameManager.h</code> class. Place them below the <code>Handle{}</code> functions in the private block:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#6272A4">    /* Border */</span></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> SetupArena</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">uint64</span><span style="color:#FFB86C;font-style:italic"> WorldSizeMeters</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> CreateBorderCube</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FVector2f</span><span style="color:#FFB86C;font-style:italic"> Position</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FVector2f</span><span style="color:#FFB86C;font-style:italic"> Size</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(VisibleAnywhere, Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Arena</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    UInstancedStaticMeshComponent</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> BorderISM;</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(EditDefaultsOnly, Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Arena</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, meta</span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2">(ClampMin</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">1.0</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#FF79C6">    float</span><span style="color:#F8F8F2"> BorderThickness </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 50.0</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(EditDefaultsOnly, Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Arena</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, meta</span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2">(ClampMin</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">1.0</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#FF79C6">    float</span><span style="color:#F8F8F2"> BorderHeight </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 100.0</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(EditDefaultsOnly, Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Arena</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    UMaterialInterface</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> BorderMaterial </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> nullptr</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(EditDefaultsOnly, Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Arena</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    UStaticMesh</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> CubeMesh </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> nullptr</span><span style="color:#F8F8F2">;</span><span style="color:#6272A4">        // defaults as /Engine/BasicShapes/Cube.Cube</span></span>
<span class="line"><span style="color:#6272A4">    /* Border */</span></span></code></pre>
<p>Next, we&#x27;ll need to make a few updates in <code>GameManager.cpp</code>.</p>
<p>First, update the includes:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">GameManager.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Components/InstancedStaticMeshComponent.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Connection/Credentials.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Tables/ConfigTable.g.h</span><span style="color:#E9F284">&quot;</span></span></code></pre>
<p>The <code>AGameManager()</code> constructor in <code>GameManager.cpp</code> includes an <code>InstancedStaticMeshComponent</code> to set up the cube. Update the constructor as follows:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">AGameManager</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    PrimaryActorTick.bCanEverTick </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    PrimaryActorTick.bStartWithTickEnabled </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    BorderISM </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> CreateDefaultSubobject</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">UInstancedStaticMeshComponent</span><span style="color:#F8F8F2">&gt;(</span><span style="color:#50FA7B">TEXT</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BorderISM</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">));</span></span>
<span class="line"><span style="color:#50FA7B">    SetRootComponent</span><span style="color:#F8F8F2">(BorderISM);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (CubeMesh </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nullptr</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    static</span><span style="color:#F8F8F2"> ConstructorHelpers</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">FObjectFinder</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">UStaticMesh</span><span style="color:#FF79C6">&gt;</span><span style="color:#50FA7B"> CubeAsset</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">TEXT</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">/Engine/BasicShapes/Cube.Cube</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">));</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (CubeAsset.</span><span style="color:#50FA7B">Succeeded</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        CubeMesh </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> CubeAsset.Object;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>Add the implementations of <code>SetupArena</code> and <code>CreateBorderCube</code> to the end of <code>GameManager.cpp</code>:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">SetupArena</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">uint64</span><span style="color:#FFB86C;font-style:italic"> WorldSizeMeters</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">BorderISM </span><span style="color:#FF79C6">||</span><span style="color:#FF79C6"> !</span><span style="color:#F8F8F2">CubeMesh) </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    BorderISM</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">ClearInstances</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">    BorderISM</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">SetStaticMesh</span><span style="color:#F8F8F2">(CubeMesh);</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (BorderMaterial)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        BorderISM</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">SetMaterial</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">, BorderMaterial);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Convert from meters (uint64) → centimeters (double for precision)</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#FF79C6"> double</span><span style="color:#F8F8F2"> worldSizeCmDouble </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> static_cast&lt;double&gt;</span><span style="color:#F8F8F2">(WorldSizeMeters) </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 100.0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Clamp to avoid float overflow in transforms</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#FF79C6"> double</span><span style="color:#F8F8F2"> clampedWorldSizeCmDouble </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> FMath</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Clamp</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">        worldSizeCmDouble,</span></span>
<span class="line"><span style="color:#BD93F9">        0.0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        FLT_MAX </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.25</span><span style="color:#6272A4"> // safe margin</span></span>
<span class="line"><span style="color:#F8F8F2">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Convert to float for actual Unreal math</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> worldSizeCm </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> static_cast&lt;float&gt;</span><span style="color:#F8F8F2">(clampedWorldSizeCmDouble);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> borderThicknessCm </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> BorderThickness;</span><span style="color:#6272A4"> // already cm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Create four borders</span></span>
<span class="line"><span style="color:#50FA7B">    CreateBorderCube</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#50FA7B">        FVector2f</span><span style="color:#F8F8F2">(worldSizeCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.5</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, worldSizeCm </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThicknessCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.5</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">),</span><span style="color:#6272A4"> // North</span></span>
<span class="line"><span style="color:#50FA7B">        FVector2f</span><span style="color:#F8F8F2">(worldSizeCm </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThicknessCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, borderThicknessCm)</span></span>
<span class="line"><span style="color:#F8F8F2">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    CreateBorderCube</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#50FA7B">        FVector2f</span><span style="color:#F8F8F2">(worldSizeCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.5</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2">borderThicknessCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.5</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">),</span><span style="color:#6272A4"> // South</span></span>
<span class="line"><span style="color:#50FA7B">        FVector2f</span><span style="color:#F8F8F2">(worldSizeCm </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThicknessCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, borderThicknessCm)</span></span>
<span class="line"><span style="color:#F8F8F2">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    CreateBorderCube</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#50FA7B">        FVector2f</span><span style="color:#F8F8F2">(worldSizeCm </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThicknessCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.5</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, worldSizeCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.5</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">),</span><span style="color:#6272A4"> // East</span></span>
<span class="line"><span style="color:#50FA7B">        FVector2f</span><span style="color:#F8F8F2">(borderThicknessCm, worldSizeCm </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThicknessCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    CreateBorderCube</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#50FA7B">        FVector2f</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2">borderThicknessCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.5</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, worldSizeCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.5</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">),</span><span style="color:#6272A4"> // West</span></span>
<span class="line"><span style="color:#50FA7B">        FVector2f</span><span style="color:#F8F8F2">(borderThicknessCm, worldSizeCm </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThicknessCm </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    );</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">CreateBorderCube</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FVector2f</span><span style="color:#FFB86C;font-style:italic"> Position</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FVector2f</span><span style="color:#FFB86C;font-style:italic"> Size</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">const</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#6272A4">    // Scale from the 100cm default cube to desired size (in cm)</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FVector </span><span style="color:#50FA7B">Scale</span><span style="color:#F8F8F2">(Size.X </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 100.0</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, BorderHeight </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 100.0</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, Size.Y </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 100.0</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Place so the bottom sits on Z=0 (cube is centered)</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FVector </span><span style="color:#50FA7B">Location</span><span style="color:#F8F8F2">(Position.X, BorderHeight </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 0.5</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, Position.Y);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FTransform </span><span style="color:#50FA7B">Transform</span><span style="color:#F8F8F2">(FRotator</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroRotator, Location, Scale);</span></span>
<span class="line"><span style="color:#F8F8F2">    BorderISM</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">AddInstance</span><span style="color:#F8F8F2">(Transform);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>In <code>HandleSubscriptionApplied</code>, call the <code>SetupArena</code> method. Update <code>HandleSubscriptionApplied</code> as follows:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">HandleSubscriptionApplied</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">FSubscriptionEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#50FA7B">    UE_LOG</span><span style="color:#F8F8F2">(LogTemp, Log, </span><span style="color:#50FA7B">TEXT</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Subscription applied!</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Once we have the initial subscription sync&#x27;d to the client cache</span></span>
<span class="line"><span style="color:#6272A4">    // Get the world size from the config table and set up the arena</span></span>
<span class="line"><span style="color:#F8F8F2">    uint64 WorldSize </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Config</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Id</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">).WorldSize;</span></span>
<span class="line"><span style="color:#50FA7B">    SetupArena</span><span style="color:#F8F8F2">(WorldSize);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>The <code>OnApplied</code> callback is called after the server synchronizes the initial state of your tables with the client. After the sync, look up the world size from the <code>config</code> table and use it to set up the arena.</p>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="create-entity-blueprints">Create Entity Blueprints<a href="#create-entity-blueprints" class="hash-link" aria-label="Direct link to Create Entity Blueprints" title="Direct link to Create Entity Blueprints" translate="no">​</a></h3>
<p>With the arena set up, use the row data that SpacetimeDB syncs with the client to create and display <strong>Blueprints</strong> on the screen.</p>
<p>Start by making a C++ class for each entity you want in the scene. If the Unreal project is not running, start it now. From the top menu, choose <strong>Tools -&gt; New C++ Class...</strong> to create the following classes (you’ll modify these later):</p>
<div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p>After creating the first class, wait for <strong>Live Coding</strong> to finish before creating the next classes.</p></div></div>
<ol>
<li><strong>Parent:</strong> <strong>Actor</strong> · <strong>Class Type:</strong> <strong>Public</strong> · <strong>Class Name:</strong> <code>Entity</code></li>
<li><strong>Parent:</strong> <strong>All Classes -&gt; Entity</strong> · <strong>Class Type:</strong> <strong>Public</strong> · <strong>Class Name:</strong> <code>Circle</code></li>
<li><strong>Parent:</strong> <strong>All Classes -&gt; Entity</strong> · <strong>Class Type:</strong> <strong>Public</strong> · <strong>Class Name:</strong> <code>Food</code></li>
<li><strong>Parent:</strong> <strong>Pawn</strong> · <strong>Class Type:</strong> <strong>Public</strong> · <strong>Class Name:</strong> <code>PlayerPawn</code></li>
<li><strong>Parent:</strong> <strong>Player Controller</strong> · <strong>Class Type:</strong> <strong>Public</strong> · <strong>Class Name:</strong> <code>BlackholioPlayerController</code></li>
<li><strong>Parent:</strong> <strong>None</strong> · <strong>Class Type:</strong> <strong>Public</strong> · <strong>Class Name:</strong> <code>DbVector2</code></li>
</ol>
<p>Next add blueprints for our these classes:</p>
<p><img decoding="async" loading="lazy" alt="Add Circle" src="/assets/images/part-3-01-create-blueprint-a8dd08b919c9bc10c38cb81721025781.png" width="620" height="597" class="img_f3N0"></p>
<ol>
<li>
<p><strong>Circle Blueprint</strong></p>
<ul>
<li>In the <strong>Content Drawer</strong>, right-click and choose <strong>Blueprint -&gt; Blueprint Class</strong>.</li>
<li>Expand <strong>All Classes</strong>, search for <code>Circle</code>, highlight <code>Circle</code>, and click <strong>Select</strong>.</li>
<li>Rename the new Blueprint to <code>BP_Circle</code>.</li>
</ul>
</li>
<li>
<p><strong>Food Blueprint</strong></p>
<ul>
<li>In the <strong>Content Drawer</strong>, right-click and choose <strong>Blueprint -&gt; Blueprint Class</strong>.</li>
<li>Expand <strong>All Classes</strong>, search for <code>Food</code>, highlight <code>Food</code>, and click <strong>Select</strong>.</li>
<li>Rename the new Blueprint to <code>BP_Food</code>.</li>
</ul>
</li>
<li>
<p><strong>Player Blueprint</strong></p>
<ul>
<li>In the <strong>Content Drawer</strong>, right-click and choose <strong>Blueprint -&gt; Blueprint Class</strong>.</li>
<li>Expand <strong>All Classes</strong>, search for <code>PlayerPawn</code>, highlight <code>PlayerPawn</code>, and click <strong>Select</strong>.</li>
<li>Rename the new Blueprint to <code>BP_PlayerPawn</code>.</li>
</ul>
</li>
<li>
<p><strong>Player Controller Blueprint</strong></p>
<ul>
<li>In the <strong>Content Drawer</strong>, right-click and choose <strong>Blueprint -&gt; Blueprint Class</strong>.</li>
<li>Expand <strong>All Classes</strong>, search for <code>BlackholioPlayerController</code>, highlight <code>BlackholioPlayerController</code>, and click <strong>Select</strong>.</li>
<li>Rename the new Blueprint to <code>BP_BlackholioPlayerController</code>.</li>
<li>Open <strong>Window -&gt; World Settings</strong> in the top menu.</li>
<li>Change <strong>Player Controller Class</strong> from <strong>PlayerController</strong> to <code>BP_BlackholioPlayerController</code>.</li>
<li>Save the level.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="set-up-the-nameplate-blueprint">Set Up the Nameplate Blueprint<a href="#set-up-the-nameplate-blueprint" class="hash-link" aria-label="Direct link to Set Up the Nameplate Blueprint" title="Direct link to Set Up the Nameplate Blueprint" translate="no">​</a></h3>
<p>Create a widget Blueprint for the player nameplate:</p>
<ul>
<li>In the <strong>Content Drawer</strong>, right-click and choose <strong>Blueprint -&gt; Blueprint Class</strong>.</li>
<li>Expand <strong>All Classes</strong>, search for <strong>UserWidget</strong>, highlight <strong>UserWidget</strong>, and click <strong>Select</strong>.</li>
<li>Name the new Blueprint <code>WBP_Nameplate</code>.</li>
</ul>
<p>Double-click <code>WBP_Nameplate</code> to open it, then make the following changes:</p>
<ol>
<li>In the <strong>Palette</strong> on the left, search for <strong>Size Box</strong> and drag it into the <strong>Hierarchy</strong> under <code>WBP_Nameplate</code>.</li>
<li>Search the <strong>Palette</strong> for <strong>Text</strong> and drag it under the <strong>Size Box</strong>.</li>
<li>Select the <strong>Text</strong> widget and update its details:<!-- -->
<ul>
<li>Rename it to <code>TextBlock</code>.</li>
<li>Check <strong>Is Variable</strong>.</li>
<li>Set <strong>Font -&gt; Size</strong> to <code>24</code>.</li>
<li>Set <strong>Font -&gt; Justification</strong> to <strong>Align Text Center</strong>.</li>
</ul>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="WBP_Nameplate" src="/assets/images/part-3-02-create-nameplate-342369b82742c46f4b3a8e78788ffe35.png" width="1286" height="726" class="img_f3N0"></p>
<p>Finally, add Blueprint logic so the circle can update its nameplate:</p>
<ol>
<li>In the <code>WBP_Nameplate</code> editor, open the <strong>Graph</strong> tab (top right).</li>
<li>Click the <strong>+</strong> button next to <strong>My Blueprint -&gt; Functions</strong> and name the new function <code>UpdateText</code>.</li>
<li>Select <code>UpdateText</code> in the editor, then in <strong>Details -&gt; Inputs</strong>, add a variable named <code>Text</code> of type <code>String</code>.</li>
<li>Drag <strong>TextBlock</strong> into the graph and choose <strong>Get TextBlock</strong>.</li>
<li>Drag off <strong>TextBlock</strong> and search for <strong>Set Text</strong>.</li>
<li>Connect <strong>UpdateText</strong> to <strong>Set Text</strong>, then connect <strong>UpdateText -&gt; Text</strong> to <strong>Set Text -&gt; Text</strong>.<!-- -->
<ul>
<li>A conversion from <code>String</code> to <code>Text</code> is added automatically; this is expected.</li>
</ul>
</li>
<li>Click <strong>Save</strong> and <strong>Compile</strong>.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="UpdateText Function" src="/assets/images/part-3-03-update-text-function-a3479013d73b464574dce9cb404c5172.png" width="608" height="258" class="img_f3N0"></p>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="set-up-circle-entity-blueprint">Set Up Circle Entity Blueprint<a href="#set-up-circle-entity-blueprint" class="hash-link" aria-label="Direct link to Set Up Circle Entity Blueprint" title="Direct link to Set Up Circle Entity Blueprint" translate="no">​</a></h3>
<p>Import and set up the circle sprite:</p>
<ol>
<li>
<p>Right-click the image below and save it locally:<br>
<img decoding="async" loading="lazy" alt="Circle" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFGmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0NDg4LCAyMDIwLzA3LzEwLTIyOjA2OjUzICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjIuMCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjEtMDEtMDRUMTM6NDc6MTYrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIxLTAxLTI2VDIyOjMzOjUyKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIxLTAxLTI2VDIyOjMzOjUyKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmVhNDhlNmEyLTcwYTMtNGUwYi04OWVkLTc4NTcwYTRhNGZlYiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDplYTQ4ZTZhMi03MGEzLTRlMGItODllZC03ODU3MGE0YTRmZWIiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplYTQ4ZTZhMi03MGEzLTRlMGItODllZC03ODU3MGE0YTRmZWIiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVhNDhlNmEyLTcwYTMtNGUwYi04OWVkLTc4NTcwYTRhNGZlYiIgc3RFdnQ6d2hlbj0iMjAyMS0wMS0wNFQxMzo0NzoxNiswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjAgKE1hY2ludG9zaCkiLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+N8To/gAAElFJREFUeJzt3X2QVfV9x/H38gwirosoUsCQQpsWwfBgFbVSjAGdJI7RNG0aY0yrVdsmmSYzyTRPbUx0qtG0E9smRjuxFltj2iQmkyrqaEIRFIooSGMjRgUFEmR5CPKwyNI/vvdy7969d/fee875fc/D5zVzx2W595wv7vl+9/s7D79fx9GjRxGRYhrmHYBENhI4DZgGTALGAyeVXuNLry5gNHA89jMfVfpztQPAQeBN4FelP3cDO0uv10uvncA24OfAK8ChxP5lkrgOdQCZMBT4dWA2MKv09VuwpD8V6HCK6yhWDF4CXgZeBDYA60tfH3GKS5qkApA+w4B5wFlYwp8B/DYwxjOoNuwH/hd4FisITwFrsQ5DUkIFwN8JwALgPOBc4EzgONeIkvMGsAZ4AlgBrAL2uEZUcCoA4Q3Dkv2dpddcrMUvol6sK3ik9FqBOoSgVADCOBF4D/AuYAn2W1/62wMsA34E/BDY5RtO/qkAJKcLeB9wObAIGO4bTub0AA8D9wMPAHt9w8knFYB4jQQuAz4AXISSPi4HgQexYvD90p8lBioA8ZgFXA1cgf3ml+R0A0uBu7BLjhKBCkD7xgLvxxJ/gXMsRbUKKwT3A/ucY8kkFYDWTQI+BlwLdPqGIiW7gTuArwFbfUPJFhWA5s0CPomN70c4xyL19QD/DtyGhgdNUQEY3PnAZ4DF+N1yK605it1XcBPwE+dYUk0FoLFzgC8CF3oHIpE8Cvw1sNI7kDQa4h1ACs3HbkR5AiV/HlyI/Sx/hP1spYo6gIrpwM3Ae1Grn1dHge8BnwY2OceSCuoA7Bn5W4GN2E08Sv786sB+xhuxn/k433D8FbkDGAJcBXwZe6Zeimcb8DngbuzBpMIpagGYD3wTmOMdiKTCOuy+jjXegYRWtCHAccBXgSdR8kvFHOyuwq+S37kY6ipSB7AE+Do2jZZIIy8B12OPJedeETqALuAe4CGU/DK4adixcg8FeLAr7x3AIuBfgCnegUgmvQpcCTzuHUhS8toBjMCu6T+Kkl/aNxk7hm4mp89/5LED+E3gXmxmXZG4PA38EfB/3oHEKW8dwFXYD0rJL3Gbix1bVznHEau8FIBR2HX9b5G9+fMlO8Zgx9g3sWMu8/IwBJiCzRM31zkOKZangUuBLc5xRJL1DmAh8D8o+SW8udiaBgu9A4kiywXgKmzSh5Od45DimoAdg1d7B9KuLBaADuAGbCymabfF23DgTuAWMrjCU9bOAYzEZoG9wjsQkTr+Ezs2M7NuQZYKQBfwXTI+5pLcewK4BFu/IPWyUgAmYmOt070DEWnCRmwqsu3egQwmC+cApgLLUfJLdszEjtmp3oEMJu0FYDr2P3KGdyAiLZpBBo7dNBeAchU9zTsQkTadhq1LMNM7kEbSeg5gJvYI5gTvQERisAO4AHjOO5BaaSwA07GqOck7EJEYbcWuYKVqOvK0FYDJ2GWU1J88EWnDZuA8UvT8QJrOAUzE2n4lv+TVVOAx7FhPhbQUgBOAh7H2XyTPpmPHeqdzHEA6CsAYbN22Wd6BiAQyC5t41H3uCu8CMBRbz/1c5zhEQjsLO/ZdHyDyLgA3YvdNixTRJcBNngF4XgW4BptaSaTorsUpF7wKwPnYwz25nGpZpEU9wGLs/pegPArAFGwqJd3lJ1KxA5vNOug9AqHPAYwCvoeSX6TWBGxy26CzDYcuALejOftFGpmL5UgwIYcAHwbuDrUzkQz7CIFyJVQBeBs2fXeh1l4XadN+rFN+PukdhRgCjACWouQXadYYLGcSv0oWogDcgMb9Iq2aB3wp6Z0kPQRYhC2v7H3HoUgW9WKTiz6e1A6SLABdwDPYdX8Rac+rwBkkNM14kr+Z/w4lv0hUk7FcSkRSHcBiYFkSGxYpqCXYPAKxSqIAHAdsAKbFvWGRAnsJm0fgjTg3msQQ4Eso+UXiNo0ErgrE3QGcCawig6ukimTAEWABsCauDcZZAIZgd/vNiWuDItLPOmA+dokwsjiHAH+Mkl8kaXOwXItFXB3AOOBnwClxbExEBvQL4DeAvVE3FFcH8HmU/CKhnAJ8IY4NxdEBzMAu+42MHo6INOkQdlnwhSgbiaMDuBklv0hoI4GvRN1I1A5gPrAa6IgaiIi05Rzs0ntbonYAN6DkF/F0Y5QPR+kAFgAro+xcRGLxDmzR0ZZF6QASn6xARJryN+1+sN0CsBCrOiLi73exyXda1m4B+Ks2Pyciyfh0Ox9q5xzAGdj9yDr5J5IeR7HbhJ9t5UPtdACfQMkvkjYdWG629qEWO4BJ2MQEWtRTJH16sHkDtjb7gVY7gL9EyS+SViOwHG1aKx3AWGzl0s7WYhKRgHZjk/Hua+bNrXQA70fJL5J2nViuNqWVAvCnLYciIh6uafaNzQ4BZgHr2w5HREKbjT2mP6BmO4Cro8UiIoE1lbPNdACjgdeAE6NGJCLB7AJ+DTgw0Jua6QAuRckvkjUnYrk7oGYKwIcihyIiHj442BsGGwKchN1VNDyuiEQkmMPY3buvN3rDYB3AZSj5RbJqOJbDDQ1WAC6PLxYRcfC+gf5yoCFAF7AddQAiWXYYmAh01/vLgTqAd6HkF8m64cC7G/3lQAXgovhjEREHSxr9RaMhwBBgBzYMEJFs6wYmUGdF4UYdwJko+UXyogvL6X4aFYCLk4tFRBzUzelGBUDjf5F8qZvT9c4BdAI7iW/pcBHx14sNBfZUf7Neki9o8H0Rya4h2EKi/b5Z69zkYxERB/1yWwVApDj65XbtOYBh2BhhTKiIRCSY/cAJwJvlb9R2AHNR8ovk1Rgsx4+pLQBnh4tFRBz0yfHaAjA7YCAiEl6fHK8tALMCBiIi4fUpANUnAYcCe9E5AJE8OwAcDxyBvh3AdJT8Ink3Gst1oG8BUPsvUgzHcl0FQKR46haAGQ6BiEh4x3K99hyAiOTfsQJQfRWgGy0BJlIEuynlerkDGIeSX6QoOrFnAo4VgCluoYiIhylQKQBTHQMRkfCmQqUATHQMRETCOwUqBWC8YyAiEt54qBSAkxwDEZHwJoAKgEhR9ekAtAqQSLFoCCBSYH0KQKdfHCLioBMqBeAEvzhExMFYqBSAUY6BiEh4Q6FSAEY6BiIi4Y2CSgEY5hiIiIQ3EioF4DjHQEQkvKFQmQ+g3xrhIpJ7HVoGXKTAVABEimkfVArAG46BiEh4fRYGeXOAN4pI/hyCSgE45BiIiIR3ECoF4KBjICISXp8hwB7HQEQkvD4nAXf7xSEiDnZDpQC87heHiDjYCZUC0O0YiIiE16cAqAMQKRYVAJEC2wGVArDTMRARCa8bKgVgu2MgIhLedqgUgC2OgYhIeJuhUgA2OwYiIuFtgUoB2Avs8otFRALaTenu3+r5ADa5hCIiob1Y/kIFQKR4Xih/MaTeN0Uk135W/qK6AGxwCEREwjuW6yoAIsVzLNfL04KDzRP+K2C0R0QiEsQB4HhqJgSh9A11ASL5tpFS8kP/acFVAETy7dnqP9QWgPUBAxGR8PrkeG0BeDJgICISXp8crz4JCLZK8B5gTMiIRCSI/UAncLj8jdoO4E1gdcCARCSc1VQlP9RfG3BlmFhEJLB+uV2vAKwIEIiIhNcvt2vPAQCciM0RqJWDRfKjFxhPzRog9ZJ8F7AmQEAiEs4a6iwA1Oi3/LJEQxGR0OrmdKMC8F8JBiIi4dXN6XrnAMAKww6gK8mIRCSIbuBkqp4BKGvUAfQCDyUZkYgE8xB1kh8GPtOvAiCSDw3P6TUaAoC1/9uB4UlEJCJB9AATaTDr90AdQDfw4wQCEpFwHmGAKf8Hu9nnP+KNRUQCu3+gvxxoCABwErAVDQNEsugQdvZ/b6M3DNYBvA48HGdEIhLMgwyQ/NDc/f73xhOLiAT2ncHeMNgQAGyW4Newh4REJBv2AJOwSUAaaqYDOAAsjSMiEQnmPgZJfmj+kd87o8UiIoF9q5k3NVsANgBPtR+LiAT0DE3mayuTfqgLEMmGbzT7xmZOApaNBbZgs4qKSDrtBqYA+5p5cysdwD7grjYCEpFw7qLJ5IfWOgCAycCLwIgWgxKR5PUAb8Uu2zel1Yk/X8UuL4hI+txHC8kPrXcAAHOAtUBHqx8UkUTNBda18oF2pv5eh54PEEmbZbSY/ND+3P9/2+bnRCQZt7TzoXYLwI+Bx9r8rIjEawVt5mOU1X8+H+GzIhKfL7b7wSgFYCX2vLGI+PkJ8Gi7H27nKkC1M7F7jnVFQMTHOcCqdj8cdQHQNcADEbchIu15gAjJD9E7AIAZ2NOCI6NuSESa1gOcDrwQZSNxLAH+AvAPMWxHRJp3OxGTH+LpAADGYcGcHMfGRGRAv8Q67wEn/GxGHB0AWCCfjWlbIjKwzxJD8kN8HQBYMVkLvD2uDYpIP88A87AFfCOLqwMAC+h6YgpMRPrpBf6MGHMszgIA8CRwR8zbFBFzBxEv+9WKcwhQ1glsxOYkF5F4bAVmYlN+xSbuDgAswOsS2K5IkV1HzMkPyRQAgB+ixURE4rIUy6nYJTEEKOsCnsXmERSR9rwGzAa6k9h4Uh0AWMBXoqsCIu3qBT5EQskPyRYAgMeBWxPeh0he3YblUGKSHAKUjcDmDpiX9I5EcmQt9qhvT5I7CVEAAN6G/YPGhNiZSMbtx35hPp/0jpIeApQ9D/x5oH2JZN1fECD5IVwBALgbLS0mMph/psmlveMQaghQNhqbwXRuyJ2KZMTTwHnAgVA7DF0AwFYuXQtMCL1jkRTbAcwHNofcacghQNkW4PdJ+OymSIb0YDkRNPnBpwCATWX8Mad9i6TNx7GcCM6rAIA92vgVx/2LpMGtwDe8du5xDqDaUOC7wCWeQYg4+QFwGXDEKwDvAgB2c9BjwFnegYgE9BRwAXbTjxvPIUDZfuA92NoCIkXwHHbMuyY/pKMDKDsVWA5M9w5EJEGbgPOBbd6BQLoKANg9AiuAqd6BiCRgM3ajzxbvQMrSMASotgV4Bzb/mUiebMOO7dQkP6SvAIC1SIuxO6NE8mAHdkxv8g6kVhoLANiswotIyThJJIJt2LH8nHcg9aS1AIAVgYXAK96BiLTpFewY3ugdSCNpLgBgC44uJIZVUEUCy8Sxm/YCAFZFzyfFVVSkRma61ywUAIDtWBFY7h2IyCCWk6Lr/IPJSgEAmxp5MXCvdyAiDfwbdowmNo133LJUAAAOYfOkf9k7EJEaNwJXYMdoZqTtTsBWfAR7pHi4dyBSaIeBawk4j1+cslwAwMZa3wYmegcihbQd+AMyfG4qa0OAWsuxedRWegcihbMSO/Yym/yQ/QIAtnji7wH/6ByHFMc/YXf3veYdSFRZHwLUuhL4OlqBSJKxH7geuMc7kLjkrQAA/Ba2nrrWHpA4PY2d5f+pdyBxysMQoNZPgQXALWhpcomuFzuWFpCz5Id8dgDVFmHt2mTvQCSTXgU+jM1ZmUt57ACqPQ6cAfyrdyCSOUuxYye3yQ/57wCqLcFOEE7zDkRS7WXgOmCZcxxB5L0DqLYMmAX8PY7zsEtqHcGOjdMpSPJDsTqAar+DrcYyxzsQSYV12G/91d6BhFakDqDaauwurj8BfuEci/j5JXYMzKeAyQ/F7QCqdQKfAz4KjPANRQLpAW7Hnird7RuKLxWAiunY9d5LgQ7fUCQhR4HvA58ihTP0eijqEKCeTdhCjWcBDzrHIvF7CPvZXoaS/xh1AI2dC9yALeAo2fUY8AXgCe9A0kgFYHCLgM8AF3oHIi15FLgJuxlMGlABaN7bgU9iE0BoFqJ0OoxNEHMb8IxvKNmgAtC6KdgVg2uwKwjibw9wJ/A1Urb2XtqpALRvLPCH2HXks51jKaqngLuA+4B9zrFkkgpAPGZhHcEHgS7nWPKuG5sa/k5gg3MsmacCEK/RwHuBD2APH+lcQTwOYZfxvo1dxz/gGk2OqAAkZzxweel1ATDMN5zM6QEeBr4DPICN8yVmKgBhjAfeDVwMvBMNExrpBh7BbsT6AbDLN5z8UwEIbyj2NOLFwEXAPIp7R2YvsBZr7x/EHsjRo9oBqQD468Lmm1sAnIcVh9GuESXnALAG+G9gVemVmXX08kgFIH2GYzManw3MLr1mkr2icABbJnt96fUkNrPuYc+gpC8VgGwYij2tOBu75PhWbGqzacCpjnGBLYP9Uun1c+zS3HrsgRu18ymnApB9o4C3lF6TsBOOE0r/rX6NBMZhxeR4+l6V2E9lVdvyibdDwM6a147Sf7dic+e9DByM/58koagAiBTY/wOBNsycF3nWOwAAAABJRU5ErkJggg==" width="256" height="256" class="img_f3N0"></p>
</li>
<li>
<p>In the <strong>Content Drawer</strong>, right-click and select <strong>Import to Current Folder</strong>, then choose the saved image.</p>
<ul>
<li>This imports the Circle as a texture.</li>
<li>Right-click the imported texture, select <strong>Sprite Actions -&gt; Create Sprite</strong>, and rename it <code>Circle_Sprite</code>.</li>
</ul>
</li>
</ol>
<p>Next, open <code>BP_Circle</code> and configure it:</p>
<ol>
<li>
<p>Select <strong>DefaultSceneRoot</strong>, add a <strong>Components -&gt; Paper Sprite</strong> component, and rename it <code>Circle</code>.</p>
<ul>
<li>In the <strong>Details</strong> panel, set <strong>Scale</strong> to <code>0.4</code> for all three axes.</li>
<li>Set <strong>Source Sprite</strong> to <code>Circle_Sprite</code>.</li>
</ul>
</li>
<li>
<p>Select <strong>DefaultSceneRoot</strong>, add a <strong>Components -&gt; Widget</strong> component, and rename it <code>NameplateWidget</code>.</p>
<ul>
<li>In the <strong>Details</strong> panel, set <strong>Location</strong> to <code>0, 10, -45</code>.</li>
<li>Set <strong>Rotation</strong> to <code>0, 0, 90</code>.</li>
<li>Under <strong>User Interface</strong>, update:<!-- -->
<ul>
<li><strong>Widget Class</strong> to <code>WBP_Nameplate</code></li>
<li><strong>Draw Size</strong> to <code>300, 60</code></li>
<li><strong>Pivot</strong> to <code>0.5, 1.0</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Click <strong>Save</strong> and <strong>Compile</strong>.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="set-up-the-food-entity-blueprint">Set Up the Food Entity Blueprint<a href="#set-up-the-food-entity-blueprint" class="hash-link" aria-label="Direct link to Set Up the Food Entity Blueprint" title="Direct link to Set Up the Food Entity Blueprint" translate="no">​</a></h3>
<p>The food entity is a simple collectible. Open <code>BP_Food</code> and configure it as follows:</p>
<ol>
<li>Select <strong>DefaultSceneRoot</strong>, add a <strong>Components -&gt; Paper Sprite</strong> component, and rename it <code>Circle</code>.<!-- -->
<ul>
<li>In the <strong>Details</strong> panel, set <strong>Scale</strong> to <code>0.4</code> for all three axes.</li>
<li>Set <strong>Source Sprite</strong> to <code>Circle_Sprite</code>.</li>
</ul>
</li>
<li>Click <strong>Save</strong> and <strong>Compile</strong>.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="set-up-the-playerpawn-blueprint">Set Up the PlayerPawn Blueprint<a href="#set-up-the-playerpawn-blueprint" class="hash-link" aria-label="Direct link to Set Up the PlayerPawn Blueprint" title="Direct link to Set Up the PlayerPawn Blueprint" translate="no">​</a></h3>
<p>The PlayerPawn owns the circles and controls the camera by following the center of mass. This setup provides the initial functionality; additional behavior will be added in the C++ class.</p>
<p>Open <code>BP_PlayerPawn</code> and make the following changes:</p>
<ol>
<li>Select <strong>DefaultSceneRoot</strong>, add a <strong>Components -&gt; Spring Arm</strong> component.</li>
<li>Select <strong>SpringArm</strong>, add a <strong>Components -&gt; Camera</strong> component.</li>
<li>Select <strong>SpringArm</strong>
<ul>
<li>In the <strong>Details</strong> panel, set:<!-- -->
<ul>
<li><strong>Location</strong> to <code>0, 15000, 0</code></li>
<li><strong>Rotation</strong> to <code>0, 0, -90</code></li>
<li><strong>Target Arm Length</strong> to <code>200</code></li>
</ul>
</li>
</ul>
</li>
<li>Click <strong>Save</strong> and <strong>Compile</strong>.</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p>Make sure the <strong>Camera</strong> component&#x27;s <strong>Location</strong> and <strong>Rotation</strong> are <code>0, 0, 0</code></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="update-classes">Update Classes<a href="#update-classes" class="hash-link" aria-label="Direct link to Update Classes" title="Direct link to Update Classes" translate="no">​</a></h3>
<p>With the Blueprints set up, return to the source code behind the entities. First, add helper functions to translate server-side vectors to Unreal vectors.</p>
<p>Open <code>DbVector2.h</code> and update it as follows:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#pragma</span><span style="color:#50FA7B;font-style:italic"> once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Types/DbVector2Type.g.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">FORCEINLINE FDbVector2Type </span><span style="color:#50FA7B">ToDbVector</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> FVector2D</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2"> Vec)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    FDbVector2Type Out;</span></span>
<span class="line"><span style="color:#F8F8F2">    Out.X </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Vec.X;</span></span>
<span class="line"><span style="color:#F8F8F2">    Out.Y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Vec.Y;</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> Out;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">FORCEINLINE FDbVector2Type </span><span style="color:#50FA7B">ToDbVector</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> FVector</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2"> Vec)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    FDbVector2Type Out;</span></span>
<span class="line"><span style="color:#F8F8F2">    Out.X </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Vec.X;</span></span>
<span class="line"><span style="color:#F8F8F2">    Out.Y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Vec.Y;</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> Out;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">FORCEINLINE FVector2D </span><span style="color:#50FA7B">ToFVector2D</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> FDbVector2Type</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2"> Vec)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#50FA7B"> FVector2D</span><span style="color:#F8F8F2">(Vec.X </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 100.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, Vec.Y </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 100.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">FORCEINLINE FVector </span><span style="color:#50FA7B">ToFVector</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> FDbVector2Type</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2"> Vec, </span><span style="color:#FF79C6">float</span><span style="color:#F8F8F2"> Z </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#50FA7B"> FVector</span><span style="color:#F8F8F2">(Vec.X </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 100.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, Z, Vec.Y </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 100.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<div class="theme-admonition theme-admonition-warning admonition_scYj alert alert--warning"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_O7JJ"><p>Delete <code>DbVector2.cpp</code> (not needed), or clear its contents so compilation succeeds.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_wKCU" id="entity-class">Entity Class<a href="#entity-class" class="hash-link" aria-label="Direct link to Entity Class" title="Direct link to Entity Class" translate="no">​</a></h4>
<p>With the foundation in place, implement the core entity class. Edit <code>Entity.h</code> as follows:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#pragma</span><span style="color:#50FA7B;font-style:italic"> once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">CoreMinimal.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">GameFramework/Actor.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Entity.generated.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> FEntityType</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">UCLASS</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#F8F8F2"> CLIENT_UNREAL_API </span><span style="color:#8BE9FD">AEntity</span><span style="color:#F8F8F2"> : </span><span style="color:#FF79C6">public</span><span style="color:#8BE9FD;font-style:italic"> AActor</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#50FA7B">    GENERATED_BODY</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public:</span></span>
<span class="line"><span style="color:#50FA7B">    AEntity</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">protected:</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EditDefaultsOnly</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Entity</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    float</span><span style="color:#F8F8F2"> LerpTime </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EditDefaultsOnly</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Entity</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    float</span><span style="color:#F8F8F2"> LerpDuration </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.10</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    FVector LerpStartPosition </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> FVector</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector;</span></span>
<span class="line"><span style="color:#F8F8F2">    FVector LerpTargetPosition </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> FVector</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector;</span></span>
<span class="line"><span style="color:#FF79C6">    float</span><span style="color:#F8F8F2"> TargetScale </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public:</span></span>
<span class="line"><span style="color:#F8F8F2">    uint32 EntityId </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Tick</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> DeltaTime</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">override</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> Spawn</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">uint32</span><span style="color:#FFB86C;font-style:italic"> InEntityId</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">    virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> OnEntityUpdated</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEntityType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> NewVal</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">    virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> OnDelete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> SetColor</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FLinearColor</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Color</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    static</span><span style="color:#FF79C6"> float</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">uint32</span><span style="color:#FFB86C;font-style:italic"> Mass</span><span style="color:#F8F8F2">) { </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> FMath</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Sqrt</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">static_cast&lt;float&gt;</span><span style="color:#F8F8F2">(Mass)); }</span></span>
<span class="line"><span style="color:#FF79C6">    static</span><span style="color:#FF79C6"> float</span><span style="color:#50FA7B"> MassToDiameter</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">uint32</span><span style="color:#FFB86C;font-style:italic"> Mass</span><span style="color:#F8F8F2">) { </span><span style="color:#FF79C6">return</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(Mass) </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">; }</span></span>
<span class="line"><span style="color:#F8F8F2">};</span></span></code></pre>
<p>Update <code>Entity.cpp</code> as follows:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Entity.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">DbVector2.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">GameManager.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">PaperSpriteComponent.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Tables/EntityTable.g.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">AEntity</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">AEntity</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    PrimaryActorTick.bCanEverTick </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    LerpTime </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AEntity</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Tick</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> DeltaTime</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Super</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Tick</span><span style="color:#F8F8F2">(DeltaTime);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Interpolate the position and scale</span></span>
<span class="line"><span style="color:#F8F8F2">    LerpTime </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> FMath</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Min</span><span style="color:#F8F8F2">(LerpTime </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> DeltaTime, LerpDuration);</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> Alpha </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (LerpDuration </span><span style="color:#FF79C6">&gt;</span><span style="color:#BD93F9"> 0.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2"> (LerpTime </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> LerpDuration) </span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#50FA7B">    SetActorLocation</span><span style="color:#F8F8F2">(FMath</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Lerp</span><span style="color:#F8F8F2">(LerpStartPosition, LerpTargetPosition, Alpha));</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> NewScale </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> FMath</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FInterpTo</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">GetActorScale3D</span><span style="color:#F8F8F2">().X, TargetScale, DeltaTime, </span><span style="color:#BD93F9">8.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#50FA7B">    SetActorScale3D</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FVector</span><span style="color:#F8F8F2">(NewScale));</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AEntity</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Spawn</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">uint32</span><span style="color:#FFB86C;font-style:italic"> InEntityId</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    EntityId </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> InEntityId;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FEntityType EntityRow </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">Instance</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Entity</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">EntityId</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(InEntityId);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    LerpStartPosition </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> LerpTargetPosition </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> ToFVector</span><span style="color:#F8F8F2">(EntityRow.Position);</span></span>
<span class="line"><span style="color:#F8F8F2">    TargetScale </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToDiameter</span><span style="color:#F8F8F2">(EntityRow.Mass);</span></span>
<span class="line"><span style="color:#50FA7B">    SetActorScale3D</span><span style="color:#F8F8F2">(FVector</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">OneVector);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AEntity</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnEntityUpdated</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEntityType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> NewVal</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    LerpStartPosition </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> GetActorLocation</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">    LerpTargetPosition </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> ToFVector</span><span style="color:#F8F8F2">(NewVal.Position);</span></span>
<span class="line"><span style="color:#F8F8F2">    TargetScale </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToDiameter</span><span style="color:#F8F8F2">(NewVal.Mass);</span></span>
<span class="line"><span style="color:#F8F8F2">    LerpTime </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AEntity</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnDelete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#50FA7B">    Destroy</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AEntity</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">SetColor</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FLinearColor</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Color</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">const</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (UPaperSpriteComponent</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> SpriteComponent </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> FindComponentByClass</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">UPaperSpriteComponent</span><span style="color:#F8F8F2">&gt;())</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        SpriteComponent</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">SetSpriteColor</span><span style="color:#F8F8F2">(Color);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>The <code>Entity</code> class provides helper functions and basic functionality to manage game objects based on entity updates.</p>
<div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p>One notable feature is linear interpolation (lerp) between the server-reported entity position and the client-drawn position. This technique produces smoother movement.</p><p>If you&#x27;re interested in learning more checkout <a href="https://gabrielgambetta.com/client-side-prediction-live-demo.html" target="_blank" rel="noopener noreferrer">this demo</a> from Gabriel Gambetta.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_wKCU" id="circle-class">Circle Class<a href="#circle-class" class="hash-link" aria-label="Direct link to Circle Class" title="Direct link to Circle Class" translate="no">​</a></h4>
<p>Open <code>Circle.h</code> and update it as follows:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#pragma</span><span style="color:#50FA7B;font-style:italic"> once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">CoreMinimal.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Entity.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Circle.generated.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> FCircleType</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> APlayerPawn</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">UCLASS</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#F8F8F2"> CLIENT_UNREAL_API </span><span style="color:#8BE9FD">ACircle</span><span style="color:#F8F8F2"> : </span><span style="color:#FF79C6">public</span><span style="color:#8BE9FD;font-style:italic"> AEntity</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#50FA7B">    GENERATED_BODY</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public:</span></span>
<span class="line"><span style="color:#50FA7B">    ACircle</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    uint32 OwnerPlayerId </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">BlueprintReadOnly</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Circle</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    FString Username;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> Spawn</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FCircleType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Circle</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">APlayerPawn</span><span style="color:#FF79C6">*</span><span style="color:#FFB86C;font-style:italic"> InOwner</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">    virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> OnDelete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">override</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">BlueprintCallable</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Circle</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> SetUsername</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FString</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> InUsername</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">FOnUsernameChanged</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FString</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">NewUsername</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">BlueprintAssignable</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Circle</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    FOnUsernameChanged OnUsernameChanged;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">protected:</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EditDefaultsOnly</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Circle</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    TArray</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">FLinearColor</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> ColorPalette;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">private:</span></span>
<span class="line"><span style="color:#F8F8F2">    TWeakObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">APlayerPawn</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> Owner;</span></span>
<span class="line"><span style="color:#F8F8F2">};</span></span></code></pre>
<p>Update <code>Circle.cpp</code> as follows:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Circle.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">PlayerPawn.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Types/CircleType.g.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">ACircle</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">ACircle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    ColorPalette </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">        // Yellow</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">175</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">159</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">49</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">175</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">116</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">49</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        // Purple</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">112</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">47</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">252</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">51</span><span style="color:#F8F8F2">,  </span><span style="color:#BD93F9">91</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">252</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        // Red</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">176</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">54</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">54</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">176</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">109</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">54</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">141</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">43</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">99</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        // Blue</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">,   </span><span style="color:#BD93F9">188</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">250</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">7</span><span style="color:#F8F8F2">,   </span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">,  </span><span style="color:#BD93F9">251</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">,   </span><span style="color:#BD93F9">28</span><span style="color:#F8F8F2">,  </span><span style="color:#BD93F9">146</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">    };</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> ACircle</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Spawn</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FCircleType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Circle</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">APlayerPawn</span><span style="color:#FF79C6">*</span><span style="color:#FFB86C;font-style:italic"> InOwner</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Super</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Spawn</span><span style="color:#F8F8F2">(Circle.EntityId);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> int32 Index </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ColorPalette.</span><span style="color:#50FA7B">Num</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">?</span><span style="color:#FF79C6"> static_cast&lt;</span><span style="color:#F8F8F2">int32</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">(InOwner</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">PlayerId </span><span style="color:#FF79C6">%</span><span style="color:#F8F8F2"> ColorPalette.</span><span style="color:#50FA7B">Num</span><span style="color:#F8F8F2">()) </span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FLinearColor Color </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ColorPalette.</span><span style="color:#50FA7B">IsValidIndex</span><span style="color:#F8F8F2">(Index) </span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2"> ColorPalette[Index] </span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">Green;</span></span>
<span class="line"><span style="color:#50FA7B">    SetColor</span><span style="color:#F8F8F2">(Color);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">    this</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Owner </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> InOwner;</span></span>
<span class="line"><span style="color:#50FA7B">    SetUsername</span><span style="color:#F8F8F2">(InOwner</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Username);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> ACircle</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnDelete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Super</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnDelete</span><span style="color:#F8F8F2">(Context);</span></span>
<span class="line"><span style="color:#F8F8F2">    Owner</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">OnCircleDeleted</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> ACircle</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">SetUsername</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FString</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> InUsername</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (Username.</span><span style="color:#50FA7B">Equals</span><span style="color:#F8F8F2">(InUsername, ESearchCase</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">CaseSensitive))</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    Username </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> InUsername;</span></span>
<span class="line"><span style="color:#F8F8F2">    OnUsernameChanged.</span><span style="color:#50FA7B">Broadcast</span><span style="color:#F8F8F2">(Username);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>At the top of the file, define possible colors for the circle. A spawn function creates an <code>ACircle</code> (the same type stored in the <code>circle</code> table) and an <code>APlayerPawn</code>. The function sets the circle’s color based on the player ID and updates the circle’s text with the player’s username.</p>
<div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p><code>ACircle</code> inherits from <code>AEntity</code>, not <code>AActor</code>. Compilation will fail until <code>APlayerPawn</code> is implemented.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_wKCU" id="food-class">Food Class<a href="#food-class" class="hash-link" aria-label="Direct link to Food Class" title="Direct link to Food Class" translate="no">​</a></h4>
<p>Open <code>Food.h</code> and update it as follows:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#pragma</span><span style="color:#50FA7B;font-style:italic"> once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">CoreMinimal.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Entity.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Food.generated.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> FFoodType</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">UCLASS</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#F8F8F2"> CLIENT_UNREAL_API </span><span style="color:#8BE9FD">AFood</span><span style="color:#F8F8F2"> : </span><span style="color:#FF79C6">public</span><span style="color:#8BE9FD;font-style:italic"> AEntity</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#50FA7B">    GENERATED_BODY</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public:</span></span>
<span class="line"><span style="color:#50FA7B">    AFood</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> Spawn</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FFoodType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> FoodEntity</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">protected:</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EditDefaultsOnly</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Food</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    TArray</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">FLinearColor</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> ColorPalette;</span></span>
<span class="line"><span style="color:#F8F8F2">};</span></span></code></pre>
<p>Update <code>Food.cpp</code> as follows:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Food.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Types/FoodType.g.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">AFood</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">AFood</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    ColorPalette </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">        // Greenish</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">119</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">252</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">173</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">76</span><span style="color:#F8F8F2">,  </span><span style="color:#BD93F9">250</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">146</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">35</span><span style="color:#F8F8F2">,  </span><span style="color:#BD93F9">246</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">120</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        // Aqua / Teal</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">119</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">251</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">201</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">76</span><span style="color:#F8F8F2">,  </span><span style="color:#BD93F9">249</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">184</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">        FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">FromSRGBColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">FColor</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">35</span><span style="color:#F8F8F2">,  </span><span style="color:#BD93F9">245</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">165</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">)),</span></span>
<span class="line"><span style="color:#F8F8F2">    };</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AFood</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Spawn</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FFoodType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> FoodEntity</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Super</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Spawn</span><span style="color:#F8F8F2">(FoodEntity.EntityId);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> int32 Index </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ColorPalette.</span><span style="color:#50FA7B">Num</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">?</span><span style="color:#FF79C6"> static_cast&lt;</span><span style="color:#F8F8F2">int32</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">(EntityId </span><span style="color:#FF79C6">%</span><span style="color:#F8F8F2"> ColorPalette.</span><span style="color:#50FA7B">Num</span><span style="color:#F8F8F2">()) </span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FLinearColor Color </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ColorPalette.</span><span style="color:#50FA7B">IsValidIndex</span><span style="color:#F8F8F2">(Index) </span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2"> ColorPalette[Index] </span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> FLinearColor</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">Green;</span></span>
<span class="line"><span style="color:#50FA7B">    SetColor</span><span style="color:#F8F8F2">(Color);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h4 class="anchor anchorWithStickyNavbar_wKCU" id="playerpawn-class">PlayerPawn Class<a href="#playerpawn-class" class="hash-link" aria-label="Direct link to PlayerPawn Class" title="Direct link to PlayerPawn Class" translate="no">​</a></h4>
<p>Open <code>PlayerPawn.h</code> and update it as follows:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#pragma</span><span style="color:#50FA7B;font-style:italic"> once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">CoreMinimal.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">GameFramework/Pawn.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">PlayerPawn.generated.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> ACircle</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> FPlayerType</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">UCLASS</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#F8F8F2"> CLIENT_UNREAL_API </span><span style="color:#8BE9FD">APlayerPawn</span><span style="color:#F8F8F2"> : </span><span style="color:#FF79C6">public</span><span style="color:#8BE9FD;font-style:italic"> APawn</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#50FA7B">    GENERATED_BODY</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public:</span></span>
<span class="line"><span style="color:#50FA7B">    APlayerPawn</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> Initialize</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">FPlayerType</span><span style="color:#FFB86C;font-style:italic"> Player</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    uint32 PlayerId </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">BlueprintReadOnly</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Player</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    FString Username;</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">BlueprintReadWrite</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Player</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    bool</span><span style="color:#F8F8F2"> bIsLocalPlayer </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> false</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    TArray</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">TWeakObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">ACircle</span><span style="color:#FF79C6">&gt;&gt;</span><span style="color:#F8F8F2"> OwnedCircles;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> OnCircleSpawned</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ACircle</span><span style="color:#FF79C6">*</span><span style="color:#FFB86C;font-style:italic"> Circle</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> OnCircleDeleted</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ACircle</span><span style="color:#FF79C6">*</span><span style="color:#FFB86C;font-style:italic"> Circle</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    uint32</span><span style="color:#50FA7B"> TotalMass</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">BlueprintPure</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Player</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    FVector</span><span style="color:#50FA7B"> CenterOfMass</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">protected:</span></span>
<span class="line"><span style="color:#FF79C6">    virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Destroyed</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">override</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public:</span></span>
<span class="line"><span style="color:#FF79C6">    virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Tick</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> DeltaTime</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">override</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">private:</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EditDefaultsOnly</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Net</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    float</span><span style="color:#F8F8F2"> SendUpdatesFrequency </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.0333</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">};</span></span></code></pre>
<p>Next, add the implementation to <code>PlayerPawn.cpp</code>.<br>
<!-- -->In the Blueprint we&#x27;ve set the <code>PlayerPawn</code> with a spring arm and camera, simplifying camera controls since the camera automatically follows the pawn.<br>
<!-- -->You can see this behavior in the <code>Tick</code> function below:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">PlayerPawn.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Circle.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">GameManager.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Kismet/GameplayStatics.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Tables/EntityTable.g.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Types/EntityType.g.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Types/PlayerType.g.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">APlayerPawn</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">APlayerPawn</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    PrimaryActorTick.bCanEverTick </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> APlayerPawn</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Initialize</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">FPlayerType</span><span style="color:#FFB86C;font-style:italic"> Player</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    PlayerId </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Player.PlayerId;</span></span>
<span class="line"><span style="color:#F8F8F2">    Username </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Player.Name;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (Player.Identity </span><span style="color:#FF79C6">==</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">Instance</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">LocalIdentity)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        bIsLocalPlayer </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (APlayerController</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> PC </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> UGameplayStatics</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">GetPlayerController</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">GetWorld</span><span style="color:#F8F8F2">(), </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            PC</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Possess</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> APlayerPawn</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnCircleSpawned</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ACircle</span><span style="color:#FF79C6">*</span><span style="color:#FFB86C;font-style:italic"> Circle</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#50FA7B">ensure</span><span style="color:#F8F8F2">(Circle))</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        OwnedCircles.</span><span style="color:#50FA7B">AddUnique</span><span style="color:#F8F8F2">(Circle);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> APlayerPawn</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnCircleDeleted</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ACircle</span><span style="color:#FF79C6">*</span><span style="color:#FFB86C;font-style:italic"> Circle</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (Circle)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        for</span><span style="color:#F8F8F2"> (int32 i </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> OwnedCircles.</span><span style="color:#50FA7B">Num</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">; i </span><span style="color:#FF79C6">&gt;=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">--</span><span style="color:#F8F8F2">i)</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">OwnedCircles[i].</span><span style="color:#50FA7B">IsValid</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">||</span><span style="color:#F8F8F2"> OwnedCircles[i].</span><span style="color:#50FA7B">Get</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">==</span><span style="color:#F8F8F2"> Circle)</span></span>
<span class="line"><span style="color:#F8F8F2">            {</span></span>
<span class="line"><span style="color:#F8F8F2">                OwnedCircles.</span><span style="color:#50FA7B">RemoveAt</span><span style="color:#F8F8F2">(i);</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (OwnedCircles.</span><span style="color:#50FA7B">Num</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6"> &amp;&amp;</span><span style="color:#F8F8F2"> bIsLocalPlayer)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#50FA7B">        UE_LOG</span><span style="color:#F8F8F2">(LogTemp, Log, </span><span style="color:#50FA7B">TEXT</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Player has died!</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">));</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">uint32</span><span style="color:#F8F8F2"> APlayerPawn</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">TotalMass</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">const</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    uint32 Total </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> (int32 Index </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">; Index </span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2"> OwnedCircles.</span><span style="color:#50FA7B">Num</span><span style="color:#F8F8F2">(); </span><span style="color:#FF79C6">++</span><span style="color:#F8F8F2">Index)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> TWeakObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">ACircle</span><span style="color:#FF79C6">&gt;&amp;</span><span style="color:#F8F8F2"> Weak </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> OwnedCircles[Index];</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">Weak.</span><span style="color:#50FA7B">IsValid</span><span style="color:#F8F8F2">()) </span><span style="color:#FF79C6">continue</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> ACircle</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> Circle </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Weak.</span><span style="color:#50FA7B">Get</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> uint32 Id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Circle</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">EntityId;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> FEntityType Entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">Instance</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Entity</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">EntityId</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(Id);</span></span>
<span class="line"><span style="color:#F8F8F2">        Total </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> Entity.Mass;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> Total;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">FVector</span><span style="color:#F8F8F2"> APlayerPawn</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">CenterOfMass</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">const</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (OwnedCircles.</span><span style="color:#50FA7B">Num</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> FVector</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    FVector WeightedPosition </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> FVector</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector;</span><span style="color:#6272A4"> // Σ (pos * mass)</span></span>
<span class="line"><span style="color:#FF79C6">    double</span><span style="color:#F8F8F2">  TotalMass        </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.0</span><span style="color:#F8F8F2">;</span><span style="color:#6272A4">                 // Σ mass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> int32 Count </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> OwnedCircles.</span><span style="color:#50FA7B">Num</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> (int32 Index </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">; Index </span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2"> Count; </span><span style="color:#FF79C6">++</span><span style="color:#F8F8F2">Index)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> TWeakObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">ACircle</span><span style="color:#FF79C6">&gt;&amp;</span><span style="color:#F8F8F2"> Weak </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> OwnedCircles[Index];</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">Weak.</span><span style="color:#50FA7B">IsValid</span><span style="color:#F8F8F2">()) </span><span style="color:#FF79C6">continue</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> ACircle</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> Circle </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Weak.</span><span style="color:#50FA7B">Get</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> uint32 Id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Circle</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">EntityId;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> FEntityType Entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">Instance</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Entity</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">EntityId</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(Id);</span></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#FF79C6"> double</span><span style="color:#F8F8F2"> Mass </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Entity.Mass;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> FVector Loc </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Circle</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">GetActorLocation</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (Mass </span><span style="color:#FF79C6">&lt;=</span><span style="color:#BD93F9"> 0.0</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">continue</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">        WeightedPosition </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> (Loc </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> Mass);</span></span>
<span class="line"><span style="color:#F8F8F2">        TotalMass </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> Mass;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FVector ActorLoc </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> GetActorLocation</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    FVector Result </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> FVector</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector;</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (TotalMass </span><span style="color:#FF79C6">&gt;</span><span style="color:#BD93F9"> 0.0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> FVector CalculatedCenter </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> WeightedPosition </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> TotalMass;</span></span>
<span class="line"><span style="color:#6272A4">        // Keep Z at the player&#x27;s Z, per your original intent</span></span>
<span class="line"><span style="color:#F8F8F2">        Result </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> FVector</span><span style="color:#F8F8F2">(CalculatedCenter.X, ActorLoc.Y, CalculatedCenter.Z);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> Result;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> APlayerPawn</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Destroyed</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Super</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Destroyed</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> (TWeakObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">ACircle</span><span style="color:#FF79C6">&gt;&amp;</span><span style="color:#F8F8F2"> CirclePtr : OwnedCircles)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (ACircle</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> Circle </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> CirclePtr.</span><span style="color:#50FA7B">Get</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            Circle</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Destroy</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    OwnedCircles.</span><span style="color:#50FA7B">Empty</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> APlayerPawn</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Tick</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> DeltaTime</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Super</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Tick</span><span style="color:#F8F8F2">(DeltaTime);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">bIsLocalPlayer </span><span style="color:#FF79C6">||</span><span style="color:#F8F8F2"> OwnedCircles.</span><span style="color:#50FA7B">Num</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FVector </span><span style="color:#50FA7B">ArenaCenter</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">1.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">0.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    FVector Target </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ArenaCenter;</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">Instance</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">IsConnected</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        const</span><span style="color:#F8F8F2"> FVector CoM </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> CenterOfMass</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">CoM.</span><span style="color:#50FA7B">ContainsNaN</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            Target </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> { CoM.X, </span><span style="color:#BD93F9">1.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">, CoM.Z };</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FVector NewLoc </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> FMath</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">VInterpTo</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">GetActorLocation</span><span style="color:#F8F8F2">(), Target, DeltaTime, </span><span style="color:#BD93F9">120.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#50FA7B">    SetActorLocation</span><span style="color:#F8F8F2">(NewLoc);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="spawning-blueprints">Spawning Blueprints<a href="#spawning-blueprints" class="hash-link" aria-label="Direct link to Spawning Blueprints" title="Direct link to Spawning Blueprints" translate="no">​</a></h3>
<p>Update <code>GameManager.h</code> to support spawning Blueprints.<br>
<!-- -->Make the following edits to the file:</p>
<p>Add the code below after the <code>UDbConnection</code> forward declaration:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#6272A4">// ...</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> UDbConnection</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> AEntity</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> ACircle</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> AFood</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> APlayerPawn</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">UCLASS</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#F8F8F2"> CLIENT_UNREAL_API </span><span style="color:#8BE9FD">AGameManager</span><span style="color:#F8F8F2"> : </span><span style="color:#FF79C6">public</span><span style="color:#8BE9FD;font-style:italic"> AActor</span></span>
<span class="line"><span style="color:#6272A4">// ...</span></span></code></pre>
<p>Add in public below the TokenFilePath:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">class</span><span style="color:#F8F8F2"> CLIENT_UNREAL_API </span><span style="color:#8BE9FD">AGameManager</span><span style="color:#F8F8F2"> : </span><span style="color:#FF79C6">public</span><span style="color:#8BE9FD;font-style:italic"> AActor</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#50FA7B">    GENERATED_BODY</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public:</span></span>
<span class="line"><span style="color:#6272A4">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(EditAnywhere, Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Classes</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    TSubclassOf</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">ACircle</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> CircleClass;</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EditAnywhere</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Classes</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    TSubclassOf</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">AFood</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> FoodClass;</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EditAnywhere</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Category</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BH|Classes</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    TSubclassOf</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">APlayerPawn</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> PlayerClass;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // ...</span></span></code></pre>
<p>Below the <code>/* Border */</code> section, add code to link the SpacetimeDB tables to the <code>GameManager</code> and handle entity spawning:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#6272A4">    // ...</span></span>
<span class="line"><span style="color:#6272A4">    /* Border */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    /* Data Bindings */</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    TMap</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">uint32, TWeakObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">AEntity</span><span style="color:#FF79C6">&gt;&gt;</span><span style="color:#F8F8F2"> EntityMap;</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    TMap</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">uint32, TWeakObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">APlayerPawn</span><span style="color:#FF79C6">&gt;&gt;</span><span style="color:#F8F8F2"> PlayerMap;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    APlayerPawn</span><span style="color:#FF79C6">*</span><span style="color:#50FA7B"> SpawnOrGetPlayer</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FPlayerType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> PlayerRow</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    ACircle</span><span style="color:#FF79C6">*</span><span style="color:#50FA7B"> SpawnCircle</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FCircleType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> CircleRow</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    AFood</span><span style="color:#FF79C6">*</span><span style="color:#50FA7B"> SpawnFood</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FFoodType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Food</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> OnCircleInsert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FCircleType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> NewRow</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> OnEntityUpdate</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEntityType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> OldRow</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEntityType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> NewRow</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> OnEntityDelete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEntityType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> RemovedRow</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> OnFoodInsert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FFoodType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> NewFood</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> OnPlayerInsert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FPlayerType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> NewRow</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#50FA7B">    UFUNCTION</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> OnPlayerDelete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FPlayerType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> RemovedRow</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#6272A4">    /* Data Bindings */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // ...</span></span></code></pre>
<p>With the header updated, add the wiring for spawning entities with data from SpacetimeDB in <code>GameManager.cpp</code>.<br>
<!-- -->As with the header, edit only the relevant parts of the file.</p>
<p>First, update the includes:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">GameManager.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Circle.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Entity.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Food.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">PlayerPawn.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Components/InstancedStaticMeshComponent.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Connection/Credentials.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Tables/CircleTable.g.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Tables/ConfigTable.g.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Tables/EntityTable.g.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Tables/FoodTable.g.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">ModuleBindings/Tables/PlayerTable.g.h</span><span style="color:#E9F284">&quot;</span></span></code></pre>
<p>Next, update <code>HandleConnect</code> to register the table-change handlers:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">HandleConnect</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">UDbConnection</span><span style="color:#FF79C6">*</span><span style="color:#FFB86C;font-style:italic"> InConn</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">FSpacetimeDBIdentity</span><span style="color:#FFB86C;font-style:italic"> Identity</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FString</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Token</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#50FA7B">    UE_LOG</span><span style="color:#F8F8F2">(LogTemp, Log, </span><span style="color:#50FA7B">TEXT</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Connected.</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">));</span></span>
<span class="line"><span style="color:#F8F8F2">    UCredentials</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">SaveToken</span><span style="color:#F8F8F2">(Token);</span></span>
<span class="line"><span style="color:#F8F8F2">    LocalIdentity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Identity;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Circle</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">OnInsert.</span><span style="color:#50FA7B">AddDynamic</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">OnCircleInsert);</span></span>
<span class="line"><span style="color:#F8F8F2">    Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Entity</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">OnUpdate.</span><span style="color:#50FA7B">AddDynamic</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">OnEntityUpdate);</span></span>
<span class="line"><span style="color:#F8F8F2">    Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Entity</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">OnDelete.</span><span style="color:#50FA7B">AddDynamic</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">OnEntityDelete);</span></span>
<span class="line"><span style="color:#F8F8F2">    Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Food</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">OnInsert.</span><span style="color:#50FA7B">AddDynamic</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">OnFoodInsert);</span></span>
<span class="line"><span style="color:#F8F8F2">    Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Player</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">OnInsert.</span><span style="color:#50FA7B">AddDynamic</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">OnPlayerInsert);</span></span>
<span class="line"><span style="color:#F8F8F2">    Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Player</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">OnDelete.</span><span style="color:#50FA7B">AddDynamic</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">OnPlayerDelete);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    FOnSubscriptionApplied AppliedDelegate;</span></span>
<span class="line"><span style="color:#50FA7B">    BIND_DELEGATE_SAFE</span><span style="color:#F8F8F2">(AppliedDelegate, </span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">, AGameManager, HandleSubscriptionApplied);</span></span>
<span class="line"><span style="color:#F8F8F2">    Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">SubscriptionBuilder</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        -&gt;</span><span style="color:#50FA7B">OnApplied</span><span style="color:#F8F8F2">(AppliedDelegate)</span></span>
<span class="line"><span style="color:#FF79C6">        -&gt;</span><span style="color:#50FA7B">SubscribeToAllTables</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>Finally, add the new functions at the end of <code>GameManager.cpp</code> to handle entity spawning:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnCircleInsert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FCircleType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> NewRow</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (EntityMap.</span><span style="color:#50FA7B">Contains</span><span style="color:#F8F8F2">(NewRow.EntityId)) </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#50FA7B">    SpawnCircle</span><span style="color:#F8F8F2">(NewRow);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnEntityUpdate</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEntityType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> OldRow</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEntityType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> NewRow</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (TWeakObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">AEntity</span><span style="color:#FF79C6">&gt;*</span><span style="color:#F8F8F2"> WeakEntity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> EntityMap.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(NewRow.EntityId))</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">WeakEntity</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">IsValid</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#FF79C6">            return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (AEntity</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> Entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> WeakEntity</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Get</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            Entity</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">OnEntityUpdated</span><span style="color:#F8F8F2">(NewRow);</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnEntityDelete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEntityType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> RemovedRow</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    TWeakObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">AEntity</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> EntityPtr;</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#FF79C6"> bool</span><span style="color:#F8F8F2"> bHadEntry </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> EntityMap.</span><span style="color:#50FA7B">RemoveAndCopyValue</span><span style="color:#F8F8F2">(RemovedRow.EntityId, EntityPtr);</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#FF79C6"> bool</span><span style="color:#F8F8F2"> bIsValid </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2">EntityPtr.</span><span style="color:#50FA7B">IsValid</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">bHadEntry </span><span style="color:#FF79C6">||</span><span style="color:#FF79C6"> !</span><span style="color:#F8F8F2">bIsValid)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (AEntity</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> Entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> EntityPtr.</span><span style="color:#50FA7B">Get</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        Entity</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">OnDelete</span><span style="color:#F8F8F2">(Context);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnFoodInsert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FFoodType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> NewRow</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (EntityMap.</span><span style="color:#50FA7B">Contains</span><span style="color:#F8F8F2">(NewRow.EntityId)) </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#50FA7B">    SpawnFood</span><span style="color:#F8F8F2">(NewRow);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnPlayerInsert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FPlayerType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> NewRow</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#50FA7B">    SpawnOrGetPlayer</span><span style="color:#F8F8F2">(NewRow);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnPlayerDelete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FPlayerType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> RemovedRow</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    TWeakObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">APlayerPawn</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> PlayerPtr;</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#FF79C6"> bool</span><span style="color:#F8F8F2"> bHadEntry </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> PlayerMap.</span><span style="color:#50FA7B">RemoveAndCopyValue</span><span style="color:#F8F8F2">(RemovedRow.PlayerId, PlayerPtr);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">bHadEntry </span><span style="color:#FF79C6">||</span><span style="color:#FF79C6"> !</span><span style="color:#F8F8F2">PlayerPtr.</span><span style="color:#50FA7B">IsValid</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (APlayerPawn</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> Player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> PlayerPtr.</span><span style="color:#50FA7B">Get</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        Player</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Destroy</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">APlayerPawn</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">SpawnOrGetPlayer</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FPlayerType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> PlayerRow</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    TWeakObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">APlayerPawn</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> WeakPlayer </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> PlayerMap.</span><span style="color:#50FA7B">FindRef</span><span style="color:#F8F8F2">(PlayerRow.PlayerId);</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (WeakPlayer.</span><span style="color:#50FA7B">IsValid</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> WeakPlayer.</span><span style="color:#50FA7B">Get</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">PlayerClass)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#50FA7B">        UE_LOG</span><span style="color:#F8F8F2">(LogTemp, Error, </span><span style="color:#50FA7B">TEXT</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">GameManager - PlayerClass not set.</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">));</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#BD93F9"> nullptr</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    FActorSpawnParameters Params;</span></span>
<span class="line"><span style="color:#F8F8F2">    Params.SpawnCollisionHandlingOverride </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ESpawnActorCollisionHandlingMethod</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">AlwaysSpawn;</span></span>
<span class="line"><span style="color:#F8F8F2">    APlayerPawn</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> Player </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> GetWorld</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">SpawnActor</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">APlayerPawn</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">(PlayerClass, FVector</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector, FRotator</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroRotator, Params);</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (Player)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        Player</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Initialize</span><span style="color:#F8F8F2">(PlayerRow);</span></span>
<span class="line"><span style="color:#F8F8F2">        PlayerMap.</span><span style="color:#50FA7B">Add</span><span style="color:#F8F8F2">(PlayerRow.PlayerId, Player);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> Player;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">ACircle</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">SpawnCircle</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FCircleType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> CircleRow</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">CircleClass)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#50FA7B">        UE_LOG</span><span style="color:#F8F8F2">(LogTemp, Error, </span><span style="color:#50FA7B">TEXT</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">GameManager - CircleClass not set.</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">));</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#BD93F9"> nullptr</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#6272A4">    // Need player row for username</span></span>
<span class="line"><span style="color:#FF79C6">    const</span><span style="color:#F8F8F2"> FPlayerType PlayerRow </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Player</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">PlayerId</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(CircleRow.PlayerId);</span></span>
<span class="line"><span style="color:#F8F8F2">    APlayerPawn</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> OwningPlayer </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> SpawnOrGetPlayer</span><span style="color:#F8F8F2">(PlayerRow);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    FActorSpawnParameters Params;</span></span>
<span class="line"><span style="color:#FF79C6">    auto*</span><span style="color:#F8F8F2"> Circle </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> GetWorld</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">SpawnActor</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">ACircle</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">(CircleClass, FVector</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector, FRotator</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroRotator, Params);</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (Circle)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        Circle</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Spawn</span><span style="color:#F8F8F2">(CircleRow, OwningPlayer);</span></span>
<span class="line"><span style="color:#F8F8F2">        EntityMap.</span><span style="color:#50FA7B">Add</span><span style="color:#F8F8F2">(CircleRow.EntityId, Circle);</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (OwningPlayer)</span></span>
<span class="line"><span style="color:#F8F8F2">            OwningPlayer</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">OnCircleSpawned</span><span style="color:#F8F8F2">(Circle);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> Circle;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">AFood</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">SpawnFood</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> FFoodType</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> FoodEntity</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">FoodClass)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#50FA7B">        UE_LOG</span><span style="color:#F8F8F2">(LogTemp, Error, </span><span style="color:#50FA7B">TEXT</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">GameManager - FoodClass not set.</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">));</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#BD93F9"> nullptr</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    FActorSpawnParameters Params;</span></span>
<span class="line"><span style="color:#F8F8F2">    AFood</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> Food </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> GetWorld</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">SpawnActor</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">AFood</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">(FoodClass, FVector</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector, FRotator</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroRotator, Params);</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (Food)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        Food</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Spawn</span><span style="color:#F8F8F2">(FoodEntity);</span></span>
<span class="line"><span style="color:#F8F8F2">        EntityMap.</span><span style="color:#50FA7B">Add</span><span style="color:#F8F8F2">(FoodEntity.EntityId, Food);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> Food;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="player-controller">Player Controller<a href="#player-controller" class="hash-link" aria-label="Direct link to Player Controller" title="Direct link to Player Controller" translate="no">​</a></h3>
<p>In most Unreal projects, proper input handling depends on setting up the PlayerController.<br>
<!-- -->We’ll finish that setup in the next part of the tutorial. For now, add the possession logic.</p>
<p>Edit <code>BlackholioPlayerController.h</code> as follows:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#pragma</span><span style="color:#50FA7B;font-style:italic"> once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">CoreMinimal.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">PlayerPawn.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">GameFramework/PlayerController.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">BlackholioPlayerController.generated.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> APlayerPawn</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">UCLASS</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#F8F8F2"> CLIENT_UNREAL_API </span><span style="color:#8BE9FD">ABlackholioPlayerController</span><span style="color:#F8F8F2"> : </span><span style="color:#FF79C6">public</span><span style="color:#8BE9FD;font-style:italic"> APlayerController</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#50FA7B">    GENERATED_BODY</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public:</span></span>
<span class="line"><span style="color:#50FA7B">    ABlackholioPlayerController</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">protected:</span></span>
<span class="line"><span style="color:#FF79C6">    virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Tick</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> DeltaSeconds</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">override</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> OnPossess</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">APawn</span><span style="color:#FF79C6">*</span><span style="color:#FFB86C;font-style:italic"> InPawn</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">override</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    FVector2D</span><span style="color:#50FA7B"> ComputeDesiredDirection</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">private:</span></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    TObjectPtr</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">APlayerPawn</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> LocalPlayer;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    UPROPERTY</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    float</span><span style="color:#F8F8F2"> SendUpdatesFrequency </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.0333</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    float</span><span style="color:#F8F8F2"> LastMovementSendTimestamp </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.</span><span style="color:#FF79C6">f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    TOptional</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">FVector2D</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> LockInputPosition;</span></span>
<span class="line"><span style="color:#F8F8F2">};</span></span></code></pre>
<p>Update <code>BlackholioPlayerController.cpp</code> (the movement logic will be added in the next part):</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">BlackholioPlayerController.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">DbVector2.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">GameManager.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">#include</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">PlayerPawn.h</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">ABlackholioPlayerController</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">ABlackholioPlayerController</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    bShowMouseCursor </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    bEnableClickEvents </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    bEnableMouseOverEvents </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    PrimaryActorTick.bCanEverTick </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> ABlackholioPlayerController</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Tick</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> DeltaSeconds</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Super</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Tick</span><span style="color:#F8F8F2">(DeltaSeconds);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> ABlackholioPlayerController</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnPossess</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">APawn</span><span style="color:#FF79C6">*</span><span style="color:#FFB86C;font-style:italic"> InPawn</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Super</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">OnPossess</span><span style="color:#F8F8F2">(InPawn);</span></span>
<span class="line"><span style="color:#F8F8F2">    LocalPlayer </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> Cast</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">APlayerPawn</span><span style="color:#F8F8F2">&gt;(InPawn);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">FVector2D</span><span style="color:#F8F8F2"> ABlackholioPlayerController</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">ComputeDesiredDirection</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">const</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> FVector2D</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">ZeroVector;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="entering-the-game">Entering the Game<a href="#entering-the-game" class="hash-link" aria-label="Direct link to Entering the Game" title="Direct link to Entering the Game" translate="no">​</a></h3>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>At this point, you may need to regenerate your bindings the following command from the <code>server-rust</code> directory.</p></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>At this point, you may need to regenerate your bindings the following command from the <code>server-csharp</code> directory.</p></div></div></div>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> generate</span><span style="color:#BD93F9"> --lang</span><span style="color:#F1FA8C"> unrealcpp</span><span style="color:#BD93F9"> --uproject-dir</span><span style="color:#F1FA8C"> ../client_unreal</span><span style="color:#BD93F9"> --project-path</span><span style="color:#F1FA8C"> ./</span><span style="color:#BD93F9"> --module-name</span><span style="color:#F1FA8C"> client_unreal</span></span></code></pre>
<p>The last step is to call the <code>enter_game</code> reducer on the server, passing in a username for the player.
For simplicity, call <code>enter_game</code> from the <code>HandleSubscriptionApplied</code> callback with the name <code>TestPlayer</code>.</p>
<p>Open up <code>GameManager.cpp</code> and edit <code>HandleSubscriptionApplied</code> to match the following:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">void</span><span style="color:#F8F8F2"> AGameManager</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">HandleSubscriptionApplied</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">FSubscriptionEventContext</span><span style="color:#FF79C6">&amp;</span><span style="color:#FFB86C;font-style:italic"> Context</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#50FA7B">    UE_LOG</span><span style="color:#F8F8F2">(LogTemp, Log, </span><span style="color:#50FA7B">TEXT</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Subscription applied!</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Once we have the initial subscription sync&#x27;d to the client cache</span></span>
<span class="line"><span style="color:#6272A4">    // Get the world size from the config table and set up the arena</span></span>
<span class="line"><span style="color:#F8F8F2">    uint64 WorldSize </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Conn</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Db</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Config</span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2">Id</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">).WorldSize;</span></span>
<span class="line"><span style="color:#50FA7B">    SetupArena</span><span style="color:#F8F8F2">(WorldSize);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    Context.Reducers</span><span style="color:#FF79C6">-&gt;</span><span style="color:#50FA7B">EnterGame</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">TestPlayer</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<div class="theme-admonition theme-admonition-warning admonition_scYj alert alert--warning"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_O7JJ"><p>Be sure to rebuild your project after making changes to the code.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="trying-it-out">Trying It Out<a href="#trying-it-out" class="hash-link" aria-label="Direct link to Trying It Out" title="Direct link to Trying It Out" translate="no">​</a></h3>
<p>Almost everything is ready to play. Before launching, set up the spawning classes:</p>
<ol>
<li>Open <code>BP_GameManager</code>.</li>
<li>Update the spawning classes:<!-- -->
<ul>
<li><strong>Circle Class</strong> → <code>BP_Circle</code></li>
<li><strong>Food Class</strong> → <code>BP_Food</code></li>
<li><strong>Player Class</strong> → <code>BP_PlayerPawn</code></li>
</ul>
</li>
</ol>
<div class="theme-admonition theme-admonition-warning admonition_scYj alert alert--warning"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_O7JJ"><p>Compile and save your changes.</p></div></div>
<p>Next, wire up <code>SetUsername</code> to update the Nameplate:</p>
<ol>
<li>Open <code>BP_Circle</code>.</li>
<li>In <strong>Event BeginPlay</strong>, add the following:</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Nameplate Update" src="/assets/images/part-3-04-nameplate-change-8961ac104ee6df35c0a49e0cc3dc1de2.png" width="1055" height="549" class="img_f3N0"></p>
<hr>
<p>After publishing the module, press <strong>Play</strong> to see it in action.<br>
<!-- -->You should see your player’s circle with its username label, surrounded by food.</p>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">​</a></h3>
<p>It&#x27;s pretty cool to see our player in game surrounded by food, but there&#x27;s a problem! We can&#x27;t move yet. In the next part, we&#x27;ll explore how to get your player moving and interacting with food and other objects.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/unreal/part-2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">2 - Connecting to SpacetimeDB</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/unreal/part-4"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">4 - Moving and Colliding</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Ea_L thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#spawning-food" class="table-of-contents__link toc-highlight">Spawning Food</a></li><li><a href="#logging-players-in" class="table-of-contents__link toc-highlight">Logging Players In</a></li><li><a href="#spawning-player-circles" class="table-of-contents__link toc-highlight">Spawning Player Circles</a></li><li><a href="#creating-the-arena" class="table-of-contents__link toc-highlight">Creating the Arena</a></li><li><a href="#create-entity-blueprints" class="table-of-contents__link toc-highlight">Create Entity Blueprints</a></li><li><a href="#set-up-the-nameplate-blueprint" class="table-of-contents__link toc-highlight">Set Up the Nameplate Blueprint</a></li><li><a href="#set-up-circle-entity-blueprint" class="table-of-contents__link toc-highlight">Set Up Circle Entity Blueprint</a></li><li><a href="#set-up-the-food-entity-blueprint" class="table-of-contents__link toc-highlight">Set Up the Food Entity Blueprint</a></li><li><a href="#set-up-the-playerpawn-blueprint" class="table-of-contents__link toc-highlight">Set Up the PlayerPawn Blueprint</a></li><li><a href="#update-classes" class="table-of-contents__link toc-highlight">Update Classes</a></li><li><a href="#spawning-blueprints" class="table-of-contents__link toc-highlight">Spawning Blueprints</a></li><li><a href="#player-controller" class="table-of-contents__link toc-highlight">Player Controller</a></li><li><a href="#entering-the-game" class="table-of-contents__link toc-highlight">Entering the Game</a></li><li><a href="#trying-it-out" class="table-of-contents__link toc-highlight">Trying It Out</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"></div></footer></div>
</body>
</html>