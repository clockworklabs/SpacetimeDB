<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Unity tutorial/part-3" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">3 - Gameplay | SpacetimeDB docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.spacetimedb.com/unity/part-3"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="3 - Gameplay | SpacetimeDB docs"><meta data-rh="true" name="description" content="Need help with the tutorial? Join our Discord server!"><meta data-rh="true" property="og:description" content="Need help with the tutorial? Join our Discord server!"><link data-rh="true" rel="icon" href="/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.spacetimedb.com/unity/part-3"><link data-rh="true" rel="alternate" href="https://docs.spacetimedb.com/unity/part-3" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.spacetimedb.com/unity/part-3" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QBC7Z9KXS2-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"3 - Gameplay","item":"https://docs.spacetimedb.com/unity/part-3"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="SpacetimeDB docs" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.0cb9f7a7.css">
<script src="/assets/js/runtime~main.d71df0f5.js" defer="defer"></script>
<script src="/assets/js/main.31d95d83.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="https://spacetimedb.com/images/brand.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_6jFv" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="https://spacetimedb.com/images/brand.png" alt="SpacetimeDB Logo" class="themedComponent_rvet themedComponent--light_mbAJ"><img src="https://spacetimedb.com/images/brand.png" alt="SpacetimeDB Logo" class="themedComponent_rvet themedComponent--dark_Ncy6"></div></a><div class="navbarSearchContainer_AesG"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://spacetimedb.com/install" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Install</a><a href="https://spacetimedb.com/pricing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Pricing</a><a href="https://spacetimedb.com/maincloud" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Maincloud</a><a href="https://spacetimedb.com/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://spacetimedb.com/community" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_hV_y"><div class="docsWrapper_f07g"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_MJiz" type="button"></button><div class="docRoot_Gd2s"><aside class="theme-doc-sidebar-container docSidebarContainer_fSpF"><div class="sidebarViewport_YElg"><div class="sidebar_kjg4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_AG0n"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/"><span title="Intro" class="categoryLinkLabel_EDYQ">Intro</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/deploying/maincloud"><span title="Deploying" class="categoryLinkLabel_EDYQ">Deploying</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/unity"><span title="Unity tutorial" class="categoryLinkLabel_EDYQ">Unity tutorial</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unity"><span title="Overview" class="linkLabel_dpMB">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unity/part-1"><span title="1 - Setup" class="linkLabel_dpMB">1 - Setup</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unity/part-2"><span title="2 - Connecting to SpacetimeDB" class="linkLabel_dpMB">2 - Connecting to SpacetimeDB</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/unity/part-3"><span title="3 - Gameplay" class="linkLabel_dpMB">3 - Gameplay</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/unity/part-4"><span title="4 - Moving and Colliding" class="linkLabel_dpMB">4 - Moving and Colliding</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/unreal"><span title="Unreal Tutorial" class="categoryLinkLabel_EDYQ">Unreal Tutorial</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cli-reference"><span title="CLI Reference" class="categoryLinkLabel_EDYQ">CLI Reference</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/modules"><span title="Server Module Languages" class="categoryLinkLabel_EDYQ">Server Module Languages</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sdks"><span title="Client SDK Languages" class="categoryLinkLabel_EDYQ">Client SDK Languages</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sql"><span title="SQL" class="categoryLinkLabel_EDYQ">SQL</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/subscriptions"><span title="Subscriptions" class="categoryLinkLabel_EDYQ">Subscriptions</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rls"><span title="Row Level Security" class="linkLabel_dpMB">Row Level Security</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/how-to/incremental-migrations"><span title="How-To" class="categoryLinkLabel_EDYQ">How-To</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/spacetimeauth"><span title="SpacetimeAuth" class="categoryLinkLabel_EDYQ">SpacetimeAuth</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/http/authorization"><span title="HTTP API" class="categoryLinkLabel_EDYQ">HTTP API</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/webassembly-abi"><span title="Internals" class="categoryLinkLabel_EDYQ">Internals</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/appendix"><span title="Appendix" class="linkLabel_dpMB">Appendix</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_dkUT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_w2oE"><div class="docItemContainer_f71m"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_xsLZ" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_oyay"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Unity tutorial</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">3 - Gameplay</span></li></ul></nav><div class="tocCollapsible_dqme theme-doc-toc-mobile tocMobile_Z34P"><button type="button" class="clean-btn tocCollapsibleButton_QMSE">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Unity Tutorial - Part 3 - Gameplay</h1></header>
<p>Need help with the tutorial? <a href="https://discord.gg/spacetimedb" target="_blank" rel="noopener noreferrer">Join our Discord server</a>!</p>
<p>This progressive tutorial is continued from <a href="/unity/part-2">part 2</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="spawning-food">Spawning Food<a href="#spawning-food" class="hash-link" aria-label="Direct link to Spawning Food" title="Direct link to Spawning Food" translate="no">​</a></h3>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>Let&#x27;s start by spawning food into the map. The first thing we need to do is create a new, special reducer called the <code>init</code> reducer. SpacetimeDB calls the <code>init</code> reducer automatically when first publish your module, and also after any time you run with <code>publish --delete-data</code>. It gives you an opportunity to initialize the state of your database before any clients connect.</p><p>Add this new reducer above our <code>connect</code> reducer.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#6272A4">// Note the `init` parameter passed to the reducer macro.</span></span>
<span class="line"><span style="color:#6272A4">// That indicates to SpacetimeDB that it should be called</span></span>
<span class="line"><span style="color:#6272A4">// once upon database creation.</span></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer(init)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> init</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2">    log</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">info!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Initializing...&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Config</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        world_size</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1000</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>This reducer also demonstrates how to insert new rows into a table. Here we are adding a single <code>Config</code> row to the <code>config</code> table with the <code>try_insert</code> function. <code>try_insert</code> returns an error if inserting the row into the table would violate any constraints, like unique constraints, on the table. You can also use <code>insert</code> which panics on constraint violations if you know for sure that you will not violate any constraints.</p><p>Now that we&#x27;ve ensured that our database always has a valid <code>world_size</code> let&#x27;s spawn some food into the map. Add the following code to the end of the file.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> FOOD_MASS_MIN</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> FOOD_MASS_MAX</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 4</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> TARGET_FOOD_COUNT</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> usize</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 600</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> mass_to_radius</span><span style="color:#F8F8F2">(mass</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    (mass </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">sqrt</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> spawn_food</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">count</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">        // Are there no logged in players? Skip food spawn.</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#8BE9FD;font-style:italic"> Ok</span><span style="color:#F8F8F2">(());</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">id</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Config not found&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">world_size;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> rng </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">rng</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> food_count </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">food</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">count</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">    while</span><span style="color:#F8F8F2"> food_count </span><span style="color:#FF79C6">&lt;</span><span style="color:#BD93F9"> TARGET_FOOD_COUNT</span><span style="color:#FF79C6"> as</span><span style="color:#8BE9FD;font-style:italic"> u64</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> food_mass </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">gen_range</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">FOOD_MASS_MIN</span><span style="color:#FF79C6">..</span><span style="color:#BD93F9">FOOD_MASS_MAX</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> food_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> mass_to_radius</span><span style="color:#F8F8F2">(food_mass);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">gen_range</span><span style="color:#F8F8F2">(food_radius</span><span style="color:#FF79C6">..</span><span style="color:#F8F8F2">world_size </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> -</span><span style="color:#F8F8F2"> food_radius);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">gen_range</span><span style="color:#F8F8F2">(food_radius</span><span style="color:#FF79C6">..</span><span style="color:#F8F8F2">world_size </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> -</span><span style="color:#F8F8F2"> food_radius);</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            entity_id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">            position</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> { x, y },</span></span>
<span class="line"><span style="color:#F8F8F2">            mass</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> food_mass,</span></span>
<span class="line"><span style="color:#F8F8F2">        })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">food</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Food</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            entity_id</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        food_count </span><span style="color:#FF79C6">+=</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        log</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">info!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Spawned food! {}&quot;</span><span style="color:#F8F8F2">, entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>In this reducer, we are using the <code>world_size</code> we configured along with the <code>ReducerContext</code>&#x27;s random number generator <code>.rng()</code> function to place 600 food uniformly randomly throughout the map. We&#x27;ve also chosen the <code>mass</code> of the food to be a random number between 2 and 4 inclusive.</p></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>Let&#x27;s start by spawning food into the map. The first thing we need to do is create a new, special reducer called the <code>Init</code> reducer. SpacetimeDB calls the <code>Init</code> reducer automatically when you first publish your module, and also after any time you run with <code>publish --delete-data</code>. It gives you an opportunity to initialize the state of your database before any clients connect.</p><p>Add this new reducer above our <code>Connect</code> reducer.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#6272A4">// Note the `init` parameter passed to the reducer macro.</span></span>
<span class="line"><span style="color:#6272A4">// That indicates to SpacetimeDB that it should be called</span></span>
<span class="line"><span style="color:#6272A4">// once upon database creation.</span></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">(ReducerKind.Init)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Init</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Log.</span><span style="color:#50FA7B">Info</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">$&quot;</span><span style="color:#F1FA8C">Initializing...</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.config.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Config</span><span style="color:#F8F8F2"> { world_size </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1000</span><span style="color:#F8F8F2"> });</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>This reducer also demonstrates how to insert new rows into a table. Here we are adding a single <code>Config</code> row to the <code>config</code> table with the <code>Insert</code> function.</p><p>Now that we&#x27;ve ensured that our database always has a valid <code>world_size</code> let&#x27;s spawn some food into the map. Add the following code to the end of the <code>Module</code> class.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">const</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> FOOD_MASS_MIN </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> FOOD_MASS_MAX </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 4</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> TARGET_FOOD_COUNT </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 600</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> float</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> mass</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> MathF.</span><span style="color:#50FA7B">Sqrt</span><span style="color:#F8F8F2">(mass);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> SpawnFood</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (ctx.Db.player.Count </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">//Are there no players yet?</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (ctx.Db.config.id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Config not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)).world_size;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> rng </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Rng;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> food_count </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.food.Count;</span></span>
<span class="line"><span style="color:#FF79C6">    while</span><span style="color:#F8F8F2"> (food_count </span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2"> TARGET_FOOD_COUNT)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> food_mass </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">Range</span><span style="color:#F8F8F2">(FOOD_MASS_MIN, FOOD_MASS_MAX);</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> food_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(food_mass);</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">Range</span><span style="color:#F8F8F2">(food_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> food_radius);</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">Range</span><span style="color:#F8F8F2">(food_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> food_radius);</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.entity.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Entity</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            position </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(x, y),</span></span>
<span class="line"><span style="color:#F8F8F2">            mass </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> food_mass,</span></span>
<span class="line"><span style="color:#F8F8F2">        });</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.food.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Food</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            entity_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> entity.entity_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        });</span></span>
<span class="line"><span style="color:#F8F8F2">        food_count</span><span style="color:#FF79C6">++</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        Log.</span><span style="color:#50FA7B">Info</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">$&quot;</span><span style="color:#F1FA8C">Spawned food! </span><span style="color:#FF79C6">{</span><span style="color:#F8F8F2">entity</span><span style="color:#F1FA8C">.</span><span style="color:#F8F8F2">entity_id</span><span style="color:#FF79C6">}</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> float</span><span style="color:#50FA7B"> Range</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">this</span><span style="color:#8BE9FD;font-style:italic"> Random</span><span style="color:#FFB86C;font-style:italic"> rng</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> min</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> max</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">NextSingle</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> (max </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> min) </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> min;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> uint</span><span style="color:#50FA7B"> Range</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">this</span><span style="color:#8BE9FD;font-style:italic"> Random</span><span style="color:#FFB86C;font-style:italic"> rng</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> min</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> max</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">uint</span><span style="color:#F8F8F2">)rng.</span><span style="color:#50FA7B">NextInt64</span><span style="color:#F8F8F2">(min, max);</span></span></code></pre><p>In this reducer, we are using the <code>world_size</code> we configured along with the <code>ReducerContext</code>&#x27;s random number generator <code>.Rng</code> function to place 600 food uniformly randomly throughout the map. We&#x27;ve also chosen the <code>mass</code> of the food to be a random number between 2 and 4 inclusive.</p><p>We also added two helper functions so we can get a random range as either a <code>uint</code> or a <code>float</code>.</p></div></div></div>
<p>Although, we&#x27;ve written the reducer to spawn food, no food will actually be spawned until we call the function while players are logged in. This raises the question, who should call this function and when?</p>
<p>We would like for this function to be called periodically to &quot;top up&quot; the amount of food on the map so that it never falls very far below our target amount of food. SpacetimeDB has built in functionality for exactly this. With SpacetimeDB you can schedule your module to call itself in the future or repeatedly with reducers.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>In order to schedule a reducer to be called we have to create a new table which specifies when and how a reducer should be called. Add this new table to the top of the file, below your imports.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">table(name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> spawn_food_timer, scheduled(spawn_food))]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> SpawnFoodTimer</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    #[primary_key]</span></span>
<span class="line"><span style="color:#F8F8F2">    #[auto_inc]</span></span>
<span class="line"><span style="color:#F8F8F2">    scheduled_id</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u64</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    scheduled_at</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">ScheduleAt</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>Note the <code>scheduled(spawn_food)</code> parameter in the table macro. This tells SpacetimeDB that the rows in this table specify a schedule for when the <code>spawn_food</code> reducer should be called. Each scheduled table requires a <code>scheduled_id</code> and a <code>scheduled_at</code> field so that SpacetimeDB can call your reducer, however you can also add your own fields to these rows as well.</p></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>In order to schedule a reducer to be called we have to create a new table which specifies when an how a reducer should be called. Add this new table to the top of the <code>Module</code> class.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Table</span><span style="color:#F8F8F2">(Name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">spawn_food_timer</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, Scheduled </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> nameof</span><span style="color:#F8F8F2">(SpawnFood), ScheduledAt </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> nameof</span><span style="color:#F8F8F2">(scheduled_at))]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> partial</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> SpawnFoodTimer</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    [</span><span style="color:#8BE9FD;font-style:italic">PrimaryKey</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">AutoInc</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> ulong</span><span style="color:#F8F8F2"> scheduled_id;</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#8BE9FD;font-style:italic"> ScheduleAt</span><span style="color:#F8F8F2"> scheduled_at;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>Note the <code>Scheduled = nameof(SpawnFood)</code> parameter in the table macro. This tells SpacetimeDB that the rows in this table specify a schedule for when the <code>SpawnFood</code> reducer should be called. Each scheduled table requires a <code>scheduled_id</code> and a <code>scheduled_at</code> field so that SpacetimeDB can call your reducer, however you can also add your own fields to these rows as well.</p></div></div></div>
<p>You can create, delete, or change a schedule by inserting, deleting, or updating rows in this table.</p>
<p>You will see an error telling you that the <code>spawn_food</code> reducer needs to take two arguments, but currently only takes one. This is because the schedule row must be passed in to all scheduled reducers. Modify your <code>spawn_food</code> reducer to take the scheduled row as an argument.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> spawn_food</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, _timer</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> SpawnFoodTimer</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#6272A4">    // ...</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> SpawnFood</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">SpawnFoodTimer</span><span style="color:#FFB86C;font-style:italic"> _timer</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#6272A4">    // ...</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div></div></div>
<p>In our case we aren&#x27;t interested in the data on the row, so we name the argument <code>_timer</code>.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>Let&#x27;s modify our <code>init</code> reducer to schedule our <code>spawn_food</code> reducer to be called every 500 milliseconds.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer(init)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> init</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2">    log</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">info!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Initializing...&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Config</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        world_size</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1000</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">spawn_food_timer</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">SpawnFoodTimer</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        scheduled_id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        scheduled_at</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> ScheduleAt</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Interval</span><span style="color:#F8F8F2">(Duration</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">from_millis</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">500</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into</span><span style="color:#F8F8F2">()),</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p>You can use <code>ScheduleAt::Interval</code> to schedule a reducer call at an interval like we&#x27;re doing here. SpacetimeDB will continue to call the reducer at this interval until you remove the row. You can also use <code>ScheduleAt::Time()</code> to specify a specific at which to call a reducer once. SpacetimeDB will remove that row automatically after the reducer has been called.</p></div></div></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>Let&#x27;s modify our <code>Init</code> reducer to schedule our <code>SpawnFood</code> reducer to be called every 500 milliseconds.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">(ReducerKind.Init)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Init</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Log.</span><span style="color:#50FA7B">Info</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">$&quot;</span><span style="color:#F1FA8C">Initializing...</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.config.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Config</span><span style="color:#F8F8F2"> { world_size </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1000</span><span style="color:#F8F8F2"> });</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.spawn_food_timer.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> SpawnFoodTimer</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        scheduled_at </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> ScheduleAt</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Interval</span><span style="color:#F8F8F2">(TimeSpan.</span><span style="color:#50FA7B">FromMilliseconds</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">500</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    });</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p>You can use <code>ScheduleAt.Interval</code> to schedule a reducer call at an interval like we&#x27;re doing here. SpacetimeDB will continue to call the reducer at this interval until you remove the row. You can also use <code>ScheduleAt.Time()</code> to specify a specific at which to call a reducer once. SpacetimeDB will remove that row automatically after the reducer has been called.</p></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="logging-players-in">Logging Players In<a href="#logging-players-in" class="hash-link" aria-label="Direct link to Logging Players In" title="Direct link to Logging Players In" translate="no">​</a></h3>
<p>Let&#x27;s continue building out our server module by modifying it to log in a player when they connect to the database, or to create a new player if they&#x27;ve never connected before.</p>
<p>Let&#x27;s add a second table to our <code>Player</code> struct. Modify the <code>Player</code> struct by adding this above the struct:</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">table(name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> logged_out_player)]</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Table</span><span style="color:#F8F8F2">(Name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">logged_out_player</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)]</span></span></code></pre></div></div></div>
<p>Your struct should now look like this:</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">table(name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> player, public)]</span></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">table(name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> logged_out_player)]</span></span>
<span class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD;font-style:italic">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Clone</span><span style="color:#F8F8F2">)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> Player</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    #[primary_key]</span></span>
<span class="line"><span style="color:#F8F8F2">    identity</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Identity</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    #[unique]</span></span>
<span class="line"><span style="color:#F8F8F2">    #[auto_inc]</span></span>
<span class="line"><span style="color:#F8F8F2">    player_id</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    name</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Table</span><span style="color:#F8F8F2">(Name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">player</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, Public </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">)]</span></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Table</span><span style="color:#F8F8F2">(Name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">logged_out_player</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> partial</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> Player</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    [</span><span style="color:#8BE9FD;font-style:italic">PrimaryKey</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#8BE9FD;font-style:italic"> Identity</span><span style="color:#F8F8F2"> identity;</span></span>
<span class="line"><span style="color:#F8F8F2">    [</span><span style="color:#8BE9FD;font-style:italic">Unique</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">AutoInc</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> player_id;</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> string</span><span style="color:#F8F8F2"> name;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div></div></div>
<p>This line creates an additional tabled called <code>logged_out_player</code> whose rows share the same <code>Player</code> type as in the <code>player</code> table.</p>
<div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p>IMPORTANT! Note that this new table is not marked <code>public</code>. This means that it can only be accessed by the database owner (which is almost always the database creator). In order to prevent any unintended data access, all SpacetimeDB tables are private by default.</p><p>If your client isn&#x27;t syncing rows from the server, check that your table is not accidentally marked private.</p></div></div>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>Next, modify your <code>connect</code> reducer and add a new <code>disconnect</code> reducer below it:</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer(client_connected)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> connect</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Some</span><span style="color:#F8F8F2">(player) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">logged_out_player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender) {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(player</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clone</span><span style="color:#F8F8F2">());</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">            .</span><span style="color:#50FA7B">logged_out_player</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">            .</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">            .</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">player</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">identity);</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Player</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            identity</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender,</span></span>
<span class="line"><span style="color:#F8F8F2">            player_id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">            name</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> String</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(),</span></span>
<span class="line"><span style="color:#F8F8F2">        })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer(client_disconnected)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> disconnect</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Player not found&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> player</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">player_id;</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">logged_out_player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>Next, modify your <code>Connect</code> reducer and add a new <code>Disconnect</code> reducer below it:</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">(ReducerKind.ClientConnected)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Connect</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.logged_out_player.identity.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(ctx.Sender);</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> (player </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> null</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.player.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(player.Value);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.logged_out_player.identity.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(player.Value.identity);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    else</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.player.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Player</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            identity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Sender,</span></span>
<span class="line"><span style="color:#F8F8F2">            name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;&quot;</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        });</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">(ReducerKind.ClientDisconnected)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Disconnect</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.player.identity.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(ctx.Sender) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Player not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.logged_out_player.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.player.identity.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(player.identity);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div></div></div>
<p>Now when a client connects, if the player corresponding to the client is in the <code>logged_out_player</code> table, we will move them into the <code>player</code> table, thus indicating that they are logged in and connected. For any new unrecognized client connects we will create a <code>Player</code> and insert it into the <code>player</code> table.</p>
<p>When a player disconnects, we will transfer their player row from the <code>player</code> table to the <code>logged_out_player</code> table to indicate they&#x27;re offline.</p>
<div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p>Note that we could have added a <code>logged_in</code> boolean to the <code>Player</code> type to indicated whether the player is logged in. There&#x27;s nothing incorrect about that approach, however for several reasons we recommend this two table approach:</p><ul>
<li>We can iterate over all logged in players without any <code>if</code> statements or branching</li>
<li>The <code>Player</code> type now uses less program memory improving cache efficiency</li>
<li>We can easily check whether a player is logged in, based on whether their row exists in the <code>player</code> table</li>
</ul><p>This approach is more generally referred to as <a href="https://www.dataorienteddesign.com/dodmain/node4.html" target="_blank" rel="noopener noreferrer">existence based processing</a> and it is a common technique in data-oriented design.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="spawning-player-circles">Spawning Player Circles<a href="#spawning-player-circles" class="hash-link" aria-label="Direct link to Spawning Player Circles" title="Direct link to Spawning Player Circles" translate="no">​</a></h3>
<p>Now that we&#x27;ve got our food spawning and our players set up, let&#x27;s create a match and spawn player circle entities into it. The first thing we should do before spawning a player into a match is give them a name.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>Add the following to the bottom of your file.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> START_PLAYER_MASS</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 15</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> enter_game</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, name</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2">    log</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">info!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Creating player with name {}&quot;</span><span style="color:#F8F8F2">, name);</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> player</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Player</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> player</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">player_id;</span></span>
<span class="line"><span style="color:#F8F8F2">    player</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name;</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">update</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#50FA7B">    spawn_player_initial_circle</span><span style="color:#F8F8F2">(ctx, player_id)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> spawn_player_initial_circle</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, player_id</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> rng </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">rng</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">id</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Config not found&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">world_size;</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player_start_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> mass_to_radius</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">START_PLAYER_MASS</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">gen_range</span><span style="color:#F8F8F2">(player_start_radius</span><span style="color:#FF79C6">..</span><span style="color:#F8F8F2">(world_size </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> -</span><span style="color:#F8F8F2"> player_start_radius));</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">gen_range</span><span style="color:#F8F8F2">(player_start_radius</span><span style="color:#FF79C6">..</span><span style="color:#F8F8F2">(world_size </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> f32</span><span style="color:#FF79C6"> -</span><span style="color:#F8F8F2"> player_start_radius));</span></span>
<span class="line"><span style="color:#50FA7B">    spawn_circle_at</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx,</span></span>
<span class="line"><span style="color:#F8F8F2">        player_id,</span></span>
<span class="line"><span style="color:#BD93F9">        START_PLAYER_MASS</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        DbVector2</span><span style="color:#F8F8F2"> { x, y },</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">timestamp,</span></span>
<span class="line"><span style="color:#F8F8F2">    )</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> spawn_circle_at</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    player_id</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    mass</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> u32</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    position</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    timestamp</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Timestamp</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        entity_id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        position,</span></span>
<span class="line"><span style="color:#F8F8F2">        mass,</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Circle</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        entity_id</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> entity</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        player_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        direction</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2"> { x</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0.0</span><span style="color:#F8F8F2">, y</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1.0</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">        speed</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0.0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        last_split_time</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> timestamp,</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(entity)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>The <code>enter_game</code> reducer takes one argument, the player&#x27;s <code>name</code>. We can use this name to display as a label for the player in the match, by storing the name on the player&#x27;s row. We are also spawning some circles for the player to control now that they are entering the game. To do this, we choose a random position within the bounds of the arena and create a new entity and corresponding circle row.</p></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>Add the following to the end of the <code>Module</code> class.</p><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">const</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> START_PLAYER_MASS </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 15</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> EnterGame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">string</span><span style="color:#FFB86C;font-style:italic"> name</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    Log.</span><span style="color:#50FA7B">Info</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">$&quot;</span><span style="color:#F1FA8C">Creating player with name </span><span style="color:#FF79C6">{</span><span style="color:#F8F8F2">name</span><span style="color:#FF79C6">}</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.player.identity.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(ctx.Sender) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Player not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    player.name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name;</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.player.identity.</span><span style="color:#50FA7B">Update</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#50FA7B">    SpawnPlayerInitialCircle</span><span style="color:#F8F8F2">(ctx, player.player_id);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> Entity</span><span style="color:#50FA7B"> SpawnPlayerInitialCircle</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> player_id</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> rng </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Rng;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> world_size </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (ctx.Db.config.id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Config not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)).world_size;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> player_start_radius </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(START_PLAYER_MASS);</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">Range</span><span style="color:#F8F8F2">(player_start_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> player_start_radius);</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rng.</span><span style="color:#50FA7B">Range</span><span style="color:#F8F8F2">(player_start_radius, world_size </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> player_start_radius);</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#50FA7B"> SpawnCircleAt</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx,</span></span>
<span class="line"><span style="color:#F8F8F2">        player_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        START_PLAYER_MASS,</span></span>
<span class="line"><span style="color:#FF79C6">        new</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(x, y),</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Timestamp</span></span>
<span class="line"><span style="color:#F8F8F2">    );</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> Entity</span><span style="color:#50FA7B"> SpawnCircleAt</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> player_id</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> mass</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#FFB86C;font-style:italic"> position</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">SpacetimeDB</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Timestamp</span><span style="color:#FFB86C;font-style:italic"> timestamp</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.entity.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Entity</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        position </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> position,</span></span>
<span class="line"><span style="color:#F8F8F2">        mass </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> mass,</span></span>
<span class="line"><span style="color:#F8F8F2">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.circle.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Circle</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        entity_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> entity.entity_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        player_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> player_id,</span></span>
<span class="line"><span style="color:#F8F8F2">        direction </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">        speed </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0f</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        last_split_time </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> timestamp,</span></span>
<span class="line"><span style="color:#F8F8F2">    });</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> entity;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre><p>The <code>EnterGame</code> reducer takes one argument, the player&#x27;s <code>name</code>. We can use this name to display as a label for the player in the match, by storing the name on the player&#x27;s row. We are also spawning some circles for the player to control now that they are entering the game. To do this, we choose a random position within the bounds of the arena and create a new entity and corresponding circle row.</p></div></div></div>
<p>Let&#x27;s also modify our <code>disconnect</code> reducer to remove the circles from the arena when the player disconnects from the database server.</p>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">reducer(client_disconnected)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> disconnect</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#F8F8F2">db</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Player not found&quot;</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> player_id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> player</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">player_id;</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">logged_out_player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Remove any circles from the arena</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">player_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">filter</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">player_id) {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">circle</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">entity_id</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">delete</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">circle</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div><div role="tabpanel" class="tabItem_sydm" hidden=""><pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD;font-style:italic">Reducer</span><span style="color:#F8F8F2">(ReducerKind.ClientDisconnected)]</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Disconnect</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.player.identity.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(ctx.Sender) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Player not found</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#6272A4">    // Remove any circles from the arena</span></span>
<span class="line"><span style="color:#FF79C6">    foreach</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> ctx.Db.circle.player_id.</span><span style="color:#50FA7B">Filter</span><span style="color:#F8F8F2">(player.player_id))</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx.Db.entity.entity_id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(circle.entity_id) </span><span style="color:#FF79C6">??</span><span style="color:#FF79C6"> throw</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Exception</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Could not find circle</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.entity.entity_id.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(entity.entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Db.circle.entity_id.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(entity.entity_id);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.logged_out_player.</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx.Db.player.identity.</span><span style="color:#50FA7B">Delete</span><span style="color:#F8F8F2">(player.identity);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div></div></div>
<p>Finally, publish the new module to SpacetimeDB with this command:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> publish</span><span style="color:#BD93F9"> --server</span><span style="color:#F1FA8C"> local</span><span style="color:#F1FA8C"> blackholio</span><span style="color:#BD93F9"> --delete-data</span></span></code></pre>
<p>Deleting the data is optional in this case, but in case you&#x27;ve been messing around with the module we can just start fresh.</p>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="creating-the-arena">Creating the Arena<a href="#creating-the-arena" class="hash-link" aria-label="Direct link to Creating the Arena" title="Direct link to Creating the Arena" translate="no">​</a></h3>
<p>Now that we&#x27;ve set up our server logic to spawn food and players, let&#x27;s continue developing our Unity client to display what we have so far.</p>
<p>Start by adding <code>SetupArena</code> and <code>CreateBorderCube</code> methods to your <code>GameManager</code> class:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> SetupArena</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> worldSize</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#50FA7B">        CreateBorderCube</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(worldSize </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">, worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#FF79C6">            new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">, borderThickness)); </span><span style="color:#6272A4">//North</span></span>
<span class="line"><span style="color:#50FA7B">        CreateBorderCube</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(worldSize </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2">borderThickness </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#FF79C6">            new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">, borderThickness)); </span><span style="color:#6272A4">//South</span></span>
<span class="line"><span style="color:#50FA7B">        CreateBorderCube</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">, worldSize </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#FF79C6">            new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(borderThickness, worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">)); </span><span style="color:#6272A4">//East</span></span>
<span class="line"><span style="color:#50FA7B">        CreateBorderCube</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2">borderThickness </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">, worldSize </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#FF79C6">            new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(borderThickness, worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">)); </span><span style="color:#6272A4">//West</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> CreateBorderCube</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Vector2</span><span style="color:#FFB86C;font-style:italic"> position</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Vector2</span><span style="color:#FFB86C;font-style:italic"> scale</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> cube </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> GameObject.</span><span style="color:#50FA7B">CreatePrimitive</span><span style="color:#F8F8F2">(PrimitiveType.Cube);</span></span>
<span class="line"><span style="color:#F8F8F2">        cube.name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Border</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        cube.transform.localScale </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Vector3</span><span style="color:#F8F8F2">(scale.x, scale.y, </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        cube.transform.position </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Vector3</span><span style="color:#F8F8F2">(position.x, position.y, </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        cube.</span><span style="color:#50FA7B">GetComponent</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">MeshRenderer</span><span style="color:#F8F8F2">&gt;().material </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> borderMaterial;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span></code></pre>
<p>In your <code>HandleSubscriptionApplied</code> let&#x27;s now call <code>SetupArena</code> method. Modify your <code>HandleSubscriptionApplied</code> method as in the below.</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> HandleSubscriptionApplied</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">SubscriptionEventContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        Debug.</span><span style="color:#50FA7B">Log</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Subscription applied!</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        OnSubscriptionApplied</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">Invoke</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        // Once we have the initial subscription sync&#x27;d to the client cache</span></span>
<span class="line"><span style="color:#6272A4">        // Get the world size from the config table and set up the arena</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> worldSize </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Conn.Db.Config.Id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">).WorldSize;</span></span>
<span class="line"><span style="color:#50FA7B">        SetupArena</span><span style="color:#F8F8F2">(worldSize);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span></code></pre>
<p>The <code>OnApplied</code> callback will be called after the server synchronizes the initial state of your tables with your client. Once the sync has happened, we can look up the world size from the <code>config</code> table and use it to set up our arena.</p>
<p>In the scene view, select the <code>GameManager</code> object. Click on the <code>Border Material</code> property and choose <code>Sprites-Default</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="creating-gameobjects">Creating GameObjects<a href="#creating-gameobjects" class="hash-link" aria-label="Direct link to Creating GameObjects" title="Direct link to Creating GameObjects" translate="no">​</a></h3>
<p>Now that we have our arena all set up, we need to take the row data that SpacetimeDB syncs with our client and use it to create and draw <code>GameObject</code>s on the screen.</p>
<p>Let&#x27;s start by making some controller scripts for each of the game objects we&#x27;d like to have in our scene. In the project window, right-click and select <code>Create &gt; C# Script</code>. Name the new script <code>PlayerController.cs</code>. Repeat that process for <code>CircleController.cs</code> and <code>FoodController.cs</code>. We&#x27;ll modify the contents of these files later.</p>
<p>Now let&#x27;s make some prefabs for our game objects. In the scene hierarchy window, create a new <code>GameObject</code> by right-clicking and selecting:</p>
<div class="language-text codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_p1l2"><pre tabindex="0" class="prism-code language-text codeBlock_qbrE thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="token-line" style="color:#bfc7d5"><span class="token plain">2D Object &gt; Sprites &gt; Circle</span><br></span></code></pre></div></div>
<p>Rename the new game object in the scene to <code>CirclePrefab</code>. Next in the <code>Inspector</code> window click the <code>Add Component</code> button and add the <code>Circle Controller</code> script component that we just created. Finally drag the object into the <code>Project</code> folder. Once the prefab file is created, delete the <code>CirclePrefab</code> object from the scene. We&#x27;ll use this prefab to draw the circles that a player controls.</p>
<p>Next repeat that same process for the <code>FoodPrefab</code> and <code>Food Controller</code> component.</p>
<p>In the <code>Project</code> view, double click the <code>CirclePrefab</code> to bring it up in the scene view. Right-click anywhere in the hierarchy and navigate to:</p>
<div class="language-text codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_p1l2"><pre tabindex="0" class="prism-code language-text codeBlock_qbrE thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="token-line" style="color:#bfc7d5"><span class="token plain">UI &gt; Text - Text Mesh Pro</span><br></span></code></pre></div></div>
<p>This will add a label to the circle prefab. You may need to import &quot;TextMeshPro Essential Resources&quot; into Unity in order to add the TextMeshPro element. Your logs will say &quot;[TMP Essential Resources] have been imported.&quot; if it has worked correctly. Don&#x27;t forget to set the transform position of the label to <code>Pos X: 0, Pos Y: 0, Pos Z: 0</code>.</p>
<p>Finally we need to make the <code>PlayerPrefab</code>. In the hierarchy window, create a new <code>GameObject</code> by right-clicking and selecting:</p>
<div class="language-text codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_p1l2"><pre tabindex="0" class="prism-code language-text codeBlock_qbrE thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Create Empty</span><br></span></code></pre></div></div>
<p>Rename the game object to <code>PlayerPrefab</code>. Next in the <code>Inspector</code> window click the <code>Add Component</code> button and add the <code>Player Controller</code> script component that we just created. Next drag the object into the <code>Project</code> folder. Once the prefab file is created, delete the <code>PlayerPrefab</code> object from the scene.</p>
<h4 class="anchor anchorWithStickyNavbar_wKCU" id="entitycontroller">EntityController<a href="#entitycontroller" class="hash-link" aria-label="Direct link to EntityController" title="Direct link to EntityController" translate="no">​</a></h4>
<p>Let&#x27;s also create an <code>EntityController</code> script which will serve as a base class for both our <code>CircleController</code> and <code>FoodController</code> classes since both <code>Circle</code>s and <code>Food</code> are entities.</p>
<p>Create a new file called <code>EntityController.cs</code> and replace its contents with:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> SpacetimeDB</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Types</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Collections</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Collections</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Generic</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Linq</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> Unity</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">VisualScripting</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> UnityEngine</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> abstract</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> EntityController</span><span style="color:#F8F8F2"> : </span><span style="color:#8BE9FD;font-style:italic">MonoBehaviour</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6"> const</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> LERP_DURATION_SEC </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.1f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> readonly</span><span style="color:#FF79C6"> int</span><span style="color:#F8F8F2"> ShaderColorProperty </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Shader.</span><span style="color:#50FA7B">PropertyToID</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">_Color</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2"> [</span><span style="color:#8BE9FD;font-style:italic">DoNotSerialize</span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> EntityId;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> protected</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> LerpTime;</span></span>
<span class="line"><span style="color:#FF79C6"> protected</span><span style="color:#8BE9FD;font-style:italic"> Vector3</span><span style="color:#F8F8F2"> LerpStartPosition;</span></span>
<span class="line"><span style="color:#FF79C6"> protected</span><span style="color:#8BE9FD;font-style:italic"> Vector3</span><span style="color:#F8F8F2"> LerpTargetPosition;</span></span>
<span class="line"><span style="color:#FF79C6"> protected</span><span style="color:#8BE9FD;font-style:italic"> Vector3</span><span style="color:#F8F8F2"> TargetScale;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> protected</span><span style="color:#FF79C6"> virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Spawn</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> entityId</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">  EntityId </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> entityId;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> GameManager.Conn.Db.Entity.EntityId.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(entityId);</span></span>
<span class="line"><span style="color:#F8F8F2">  LerpStartPosition </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> LerpTargetPosition </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> transform.position </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (</span><span style="color:#8BE9FD;font-style:italic">Vector2</span><span style="color:#F8F8F2">)entity.Position;</span></span>
<span class="line"><span style="color:#F8F8F2">  transform.localScale </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Vector3.one;</span></span>
<span class="line"><span style="color:#F8F8F2">  TargetScale </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToScale</span><span style="color:#F8F8F2">(entity.Mass);</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> SetColor</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#50FA7B">  GetComponent</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">SpriteRenderer</span><span style="color:#F8F8F2">&gt;().material.</span><span style="color:#50FA7B">SetColor</span><span style="color:#F8F8F2">(ShaderColorProperty, color);</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> OnEntityUpdated</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#FFB86C;font-style:italic"> newVal</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">  LerpTime </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.0f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">  LerpStartPosition </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> transform.position;</span></span>
<span class="line"><span style="color:#F8F8F2">  LerpTargetPosition </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (</span><span style="color:#8BE9FD;font-style:italic">Vector2</span><span style="color:#F8F8F2">)newVal.Position;</span></span>
<span class="line"><span style="color:#F8F8F2">  TargetScale </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToScale</span><span style="color:#F8F8F2">(newVal.Mass);</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> OnDelete</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EventContext</span><span style="color:#FFB86C;font-style:italic"> context</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#50FA7B">  Destroy</span><span style="color:#F8F8F2">(gameObject);</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> virtual</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Update</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">  // Interpolate position and scale</span></span>
<span class="line"><span style="color:#F8F8F2">  LerpTime </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Mathf.</span><span style="color:#50FA7B">Min</span><span style="color:#F8F8F2">(LerpTime </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> Time.deltaTime, LERP_DURATION_SEC);</span></span>
<span class="line"><span style="color:#F8F8F2">  transform.position </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Vector3.</span><span style="color:#50FA7B">Lerp</span><span style="color:#F8F8F2">(LerpStartPosition, LerpTargetPosition, LerpTime </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> LERP_DURATION_SEC);</span></span>
<span class="line"><span style="color:#F8F8F2">  transform.localScale </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Vector3.</span><span style="color:#50FA7B">Lerp</span><span style="color:#F8F8F2">(transform.localScale, TargetScale, Time.deltaTime </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 8</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> Vector3</span><span style="color:#50FA7B"> MassToScale</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> mass</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> diameter </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> MassToDiameter</span><span style="color:#F8F8F2">(mass);</span></span>
<span class="line"><span style="color:#FF79C6">  return</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Vector3</span><span style="color:#F8F8F2">(diameter, diameter, </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> float</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> mass</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> Mathf.</span><span style="color:#50FA7B">Sqrt</span><span style="color:#F8F8F2">(mass);</span></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> float</span><span style="color:#50FA7B"> MassToDiameter</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> mass</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#50FA7B"> MassToRadius</span><span style="color:#F8F8F2">(mass) </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>The <code>EntityController</code> script just provides some helper functions and basic functionality to manage our game objects based on entity updates.</p>
<blockquote>
<p>One notable feature is that we linearly interpolate (lerp) between the position where the server says the entity is, and where we actually draw it. This is a common technique which provides for smoother movement.</p>
<p>If you&#x27;re interested in learning more checkout <a href="https://gabrielgambetta.com/client-side-prediction-live-demo.html" target="_blank" rel="noopener noreferrer">this demo</a> from Gabriel Gambetta.</p>
</blockquote>
<p>At this point you&#x27;ll have a compilation error because we can&#x27;t yet convert from <code>SpacetimeDB.Types.DbVector2</code> to <code>UnityEngine.Vector2</code>. To fix this, let&#x27;s also create a new <code>Extensions.cs</code> script and replace the contents with:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> SpacetimeDB</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Types</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> UnityEngine</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">namespace</span><span style="color:#8BE9FD;font-style:italic"> SpacetimeDB</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Types</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> partial</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> DbVector2</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> implicit</span><span style="color:#FF79C6"> operator</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">DbVector2</span><span style="color:#FFB86C;font-style:italic"> vec</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">  {</span></span>
<span class="line"><span style="color:#FF79C6">   return</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(vec.X, vec.Y);</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> implicit</span><span style="color:#FF79C6"> operator</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Vector2</span><span style="color:#FFB86C;font-style:italic"> vec</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">  {</span></span>
<span class="line"><span style="color:#FF79C6">   return</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> DbVector2</span><span style="color:#F8F8F2">(vec.x, vec.y);</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>This just allows us to implicitly convert between our <code>DbVector2</code> type and the Unity <code>Vector2</code> type.</p>
<h4 class="anchor anchorWithStickyNavbar_wKCU" id="circlecontroller">CircleController<a href="#circlecontroller" class="hash-link" aria-label="Direct link to CircleController" title="Direct link to CircleController" translate="no">​</a></h4>
<p>Now open the <code>CircleController</code> script and modify the contents of the <code>CircleController</code> script to be:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Collections</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Generic</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> SpacetimeDB</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> SpacetimeDB</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Types</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> UnityEngine</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> CircleController</span><span style="color:#F8F8F2"> : </span><span style="color:#8BE9FD;font-style:italic">EntityController</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> Color</span><span style="color:#F8F8F2">[] ColorPalette </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#F8F8F2">[]</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">        //Yellow</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">175</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">159</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">49</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">175</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">116</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">49</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        //Purple</span></span>
<span class="line"><span style="color:#F8F8F2">        (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">112</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">47</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">252</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">51</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">91</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">252</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        //Red</span></span>
<span class="line"><span style="color:#F8F8F2">        (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">176</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">54</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">54</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">176</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">109</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">54</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">141</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">43</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">99</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        //Blue</span></span>
<span class="line"><span style="color:#F8F8F2">        (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">188</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">250</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">7</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">251</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">28</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">146</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#8BE9FD;font-style:italic"> PlayerController</span><span style="color:#F8F8F2"> Owner;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Spawn</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Circle</span><span style="color:#FFB86C;font-style:italic"> circle</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">PlayerController</span><span style="color:#FFB86C;font-style:italic"> owner</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        base</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">Spawn</span><span style="color:#F8F8F2">(circle.EntityId);</span></span>
<span class="line"><span style="color:#50FA7B">  SetColor</span><span style="color:#F8F8F2">(ColorPalette[circle.PlayerId </span><span style="color:#FF79C6">%</span><span style="color:#F8F8F2"> ColorPalette.Length]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        this</span><span style="color:#F8F8F2">.Owner </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> owner;</span></span>
<span class="line"><span style="color:#50FA7B">        GetComponentInChildren</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">TMPro</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">TextMeshProUGUI</span><span style="color:#F8F8F2">&gt;().text </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> owner.Username;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> override</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> OnDelete</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EventContext</span><span style="color:#FFB86C;font-style:italic"> context</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">  base</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">OnDelete</span><span style="color:#F8F8F2">(context);</span></span>
<span class="line"><span style="color:#F8F8F2">        Owner.</span><span style="color:#50FA7B">OnCircleDeleted</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>At the top, we&#x27;re just defining some possible colors for our circle. We&#x27;ve also created a spawn function which takes a <code>Circle</code> (same type that&#x27;s in our <code>circle</code> table) and a <code>PlayerController</code> which sets the color based on the circle&#x27;s player ID, as well as setting the text of the Cricle to be the player&#x27;s username.</p>
<p>Note that the <code>CircleController</code> inherits from the <code>EntityController</code>, not <code>MonoBehavior</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_wKCU" id="foodcontroller">FoodController<a href="#foodcontroller" class="hash-link" aria-label="Direct link to FoodController" title="Direct link to FoodController" translate="no">​</a></h4>
<p>Next open the <code>FoodController.cs</code> file and replace the contents with:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> SpacetimeDB</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Types</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> Unity</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">VisualScripting</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> UnityEngine</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> FoodController</span><span style="color:#F8F8F2"> : </span><span style="color:#8BE9FD;font-style:italic">EntityController</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> Color</span><span style="color:#F8F8F2">[] ColorPalette </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#F8F8F2">[]</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">119</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">252</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">173</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">76</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">250</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">146</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">35</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">246</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">120</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">119</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">251</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">201</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">76</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">249</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">184</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">  (</span><span style="color:#8BE9FD;font-style:italic">Color</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Color32</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">35</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">245</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">165</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">255</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Spawn</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Food</span><span style="color:#FFB86C;font-style:italic"> food</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        base</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">Spawn</span><span style="color:#F8F8F2">(food.EntityId);</span></span>
<span class="line"><span style="color:#50FA7B">  SetColor</span><span style="color:#F8F8F2">(ColorPalette[EntityId </span><span style="color:#FF79C6">%</span><span style="color:#F8F8F2"> ColorPalette.Length]);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h4 class="anchor anchorWithStickyNavbar_wKCU" id="playercontroller">PlayerController<a href="#playercontroller" class="hash-link" aria-label="Direct link to PlayerController" title="Direct link to PlayerController" translate="no">​</a></h4>
<p>Open the <code>PlayerController</code> script and modify the contents of the <code>PlayerController</code> script to be:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Collections</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Generic</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Linq</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> SpacetimeDB</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> SpacetimeDB</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Types</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> UnityEngine</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> PlayerController</span><span style="color:#F8F8F2"> : </span><span style="color:#8BE9FD;font-style:italic">MonoBehaviour</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6"> const</span><span style="color:#FF79C6"> int</span><span style="color:#F8F8F2"> SEND_UPDATES_PER_SEC </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 20</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6"> const</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> SEND_UPDATES_FREQUENCY </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1f</span><span style="color:#FF79C6"> /</span><span style="color:#F8F8F2"> SEND_UPDATES_PER_SEC;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> PlayerController</span><span style="color:#F8F8F2"> Local { </span><span style="color:#FF79C6">get</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">private</span><span style="color:#FF79C6"> set</span><span style="color:#F8F8F2">; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> uint</span><span style="color:#F8F8F2"> PlayerId;</span></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> LastMovementSendTimestamp;</span></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">? LockInputPosition;</span></span>
<span class="line"><span style="color:#FF79C6"> private</span><span style="color:#8BE9FD;font-style:italic"> List</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">CircleController</span><span style="color:#F8F8F2">&gt; OwnedCircles </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> List</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">CircleController</span><span style="color:#F8F8F2">&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> string</span><span style="color:#F8F8F2"> Username </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> GameManager.Conn.Db.Player.PlayerId.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(PlayerId).Name;</span></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> int</span><span style="color:#F8F8F2"> NumberOfOwnedCircles </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> OwnedCircles.Count;</span></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> bool</span><span style="color:#F8F8F2"> IsLocalPlayer </span><span style="color:#FF79C6">=&gt;</span><span style="color:#BD93F9;font-style:italic"> this</span><span style="color:#FF79C6"> ==</span><span style="color:#F8F8F2"> Local;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Initialize</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Player</span><span style="color:#FFB86C;font-style:italic"> player</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        PlayerId </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> player.PlayerId;</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (player.Identity </span><span style="color:#FF79C6">==</span><span style="color:#F8F8F2"> GameManager.LocalIdentity)</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            Local </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> this</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> OnDestroy</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#6272A4">        // If we have any circles, destroy them</span></span>
<span class="line"><span style="color:#FF79C6">        foreach</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> OwnedCircles)</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#F8F8F2"> (circle </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> null</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            {</span></span>
<span class="line"><span style="color:#50FA7B">                Destroy</span><span style="color:#F8F8F2">(circle.gameObject);</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">        OwnedCircles.</span><span style="color:#50FA7B">Clear</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> OnCircleSpawned</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">CircleController</span><span style="color:#FFB86C;font-style:italic"> circle</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        OwnedCircles.</span><span style="color:#50FA7B">Add</span><span style="color:#F8F8F2">(circle);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> OnCircleDeleted</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">CircleController</span><span style="color:#FFB86C;font-style:italic"> deletedCircle</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">  // This means we got eaten</span></span>
<span class="line"><span style="color:#FF79C6">  if</span><span style="color:#F8F8F2"> (OwnedCircles.</span><span style="color:#50FA7B">Remove</span><span style="color:#F8F8F2">(deletedCircle) </span><span style="color:#FF79C6">&amp;&amp;</span><span style="color:#F8F8F2"> IsLocalPlayer </span><span style="color:#FF79C6">&amp;&amp;</span><span style="color:#F8F8F2"> OwnedCircles.Count </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">  {</span></span>
<span class="line"><span style="color:#6272A4">   // DeathScreen.Instance.SetVisible(true);</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> uint</span><span style="color:#50FA7B"> TotalMass</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">uint</span><span style="color:#F8F8F2">)OwnedCircles</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#50FA7B">Select</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">circle</span><span style="color:#FF79C6"> =&gt;</span><span style="color:#F8F8F2"> GameManager.Conn.Db.Entity.EntityId.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(circle.EntityId))</span></span>
<span class="line"><span style="color:#F8F8F2">   .</span><span style="color:#50FA7B">Sum</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">e</span><span style="color:#FF79C6"> =&gt;</span><span style="color:#F8F8F2"> e</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">.Mass </span><span style="color:#FF79C6">??</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">); </span><span style="color:#6272A4">//If this entity is being deleted on the same frame that we&#x27;re moving, we can have a null entity here.</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">? </span><span style="color:#50FA7B">CenterOfMass</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (OwnedCircles.Count </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#FF79C6">            return</span><span style="color:#BD93F9"> null</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        Vector2</span><span style="color:#F8F8F2"> totalPos </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Vector2.zero;</span></span>
<span class="line"><span style="color:#FF79C6">        float</span><span style="color:#F8F8F2"> totalMass </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">        foreach</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> circle </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> OwnedCircles)</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#FF79C6">            var</span><span style="color:#F8F8F2"> entity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> GameManager.Conn.Db.Entity.EntityId.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(circle.EntityId);</span></span>
<span class="line"><span style="color:#FF79C6">            var</span><span style="color:#F8F8F2"> position </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> circle.transform.position;</span></span>
<span class="line"><span style="color:#F8F8F2">            totalPos </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> (</span><span style="color:#8BE9FD;font-style:italic">Vector2</span><span style="color:#F8F8F2">)position </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> entity.Mass;</span></span>
<span class="line"><span style="color:#F8F8F2">            totalMass </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> entity.Mass;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> totalPos </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> totalMass;</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> OnGUI</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">IsLocalPlayer </span><span style="color:#FF79C6">||</span><span style="color:#FF79C6"> !</span><span style="color:#F8F8F2">GameManager.</span><span style="color:#50FA7B">IsConnected</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">  {</span></span>
<span class="line"><span style="color:#FF79C6">   return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">  GUI.</span><span style="color:#50FA7B">Label</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Rect</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">), </span><span style="color:#E9F284">$&quot;</span><span style="color:#F1FA8C">Total Mass: </span><span style="color:#FF79C6">{</span><span style="color:#50FA7B">TotalMass</span><span style="color:#F1FA8C">()</span><span style="color:#FF79C6">}</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4"> //Automated testing members</span></span>
<span class="line"><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> bool</span><span style="color:#F8F8F2"> testInputEnabled;</span></span>
<span class="line"><span style="color:#FF79C6"> private</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2"> testInput;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> SetTestInput</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Vector2</span><span style="color:#FFB86C;font-style:italic"> input</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> testInput </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> input;</span></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> EnableTestInput</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> testInputEnabled </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>Let&#x27;s also add a new <code>PrefabManager.cs</code> script which we can use as a factory for creating prefabs. Replace the contents of the file with:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> SpacetimeDB</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Types</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Collections</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Collections</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Generic</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> UnityEngine</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> PrefabManager</span><span style="color:#F8F8F2"> : </span><span style="color:#8BE9FD;font-style:italic">MonoBehaviour</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> PrefabManager</span><span style="color:#F8F8F2"> Instance;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#8BE9FD;font-style:italic"> CircleController</span><span style="color:#F8F8F2"> CirclePrefab;</span></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#8BE9FD;font-style:italic"> FoodController</span><span style="color:#F8F8F2"> FoodPrefab;</span></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#8BE9FD;font-style:italic"> PlayerController</span><span style="color:#F8F8F2"> PlayerPrefab;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> Awake</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">  Instance </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> this</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> CircleController</span><span style="color:#50FA7B"> SpawnCircle</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Circle</span><span style="color:#FFB86C;font-style:italic"> circle</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">PlayerController</span><span style="color:#FFB86C;font-style:italic"> owner</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> entityController </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> Instantiate</span><span style="color:#F8F8F2">(Instance.CirclePrefab);</span></span>
<span class="line"><span style="color:#F8F8F2">  entityController.name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> $&quot;</span><span style="color:#F1FA8C">Circle - </span><span style="color:#FF79C6">{</span><span style="color:#F8F8F2">circle</span><span style="color:#F1FA8C">.</span><span style="color:#F8F8F2">EntityId</span><span style="color:#FF79C6">}</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">  entityController.</span><span style="color:#50FA7B">Spawn</span><span style="color:#F8F8F2">(circle, owner);</span></span>
<span class="line"><span style="color:#F8F8F2">  owner.</span><span style="color:#50FA7B">OnCircleSpawned</span><span style="color:#F8F8F2">(entityController);</span></span>
<span class="line"><span style="color:#FF79C6">  return</span><span style="color:#F8F8F2"> entityController;</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> FoodController</span><span style="color:#50FA7B"> SpawnFood</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Food</span><span style="color:#FFB86C;font-style:italic"> food</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> entityController </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> Instantiate</span><span style="color:#F8F8F2">(Instance.FoodPrefab);</span></span>
<span class="line"><span style="color:#F8F8F2">  entityController.name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> $&quot;</span><span style="color:#F1FA8C">Food - </span><span style="color:#FF79C6">{</span><span style="color:#F8F8F2">food</span><span style="color:#F1FA8C">.</span><span style="color:#F8F8F2">EntityId</span><span style="color:#FF79C6">}</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">  entityController.</span><span style="color:#50FA7B">Spawn</span><span style="color:#F8F8F2">(food);</span></span>
<span class="line"><span style="color:#FF79C6">  return</span><span style="color:#F8F8F2"> entityController;</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> PlayerController</span><span style="color:#50FA7B"> SpawnPlayer</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Player</span><span style="color:#FFB86C;font-style:italic"> player</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> playerController </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> Instantiate</span><span style="color:#F8F8F2">(Instance.PlayerPrefab);</span></span>
<span class="line"><span style="color:#F8F8F2">  playerController.name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> $&quot;</span><span style="color:#F1FA8C">PlayerController - </span><span style="color:#FF79C6">{</span><span style="color:#F8F8F2">player</span><span style="color:#F1FA8C">.</span><span style="color:#F8F8F2">Name</span><span style="color:#FF79C6">}</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">  playerController.</span><span style="color:#50FA7B">Initialize</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#FF79C6">  return</span><span style="color:#F8F8F2"> playerController;</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>In the scene hierarchy, select the <code>GameManager</code> object and add the <code>Prefab Manager</code> script as a component to the <code>GameManager</code> object. Drag the corresponding <code>CirclePrefab</code>, <code>FoodPrefab</code>, and <code>PlayerPrefab</code> prefabs we created earlier from the project view into their respective slots in the <code>Prefab Manager</code>. Save the scene.</p>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="hooking-up-the-data">Hooking up the Data<a href="#hooking-up-the-data" class="hash-link" aria-label="Direct link to Hooking up the Data" title="Direct link to Hooking up the Data" translate="no">​</a></h3>
<p>We&#x27;ve now prepared our Unity project so that we can hook up the data from our tables to the Unity game objects and have them drawn on the screen.</p>
<p>Add a couple dictionaries at the top of your <code>GameManager</code> class which we&#x27;ll use to hold onto the game objects we create for our scene. Add these two lines just below your <code>DbConnection</code> like so:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#F8F8F2"> DbConnection Conn { get; </span><span style="color:#8BE9FD;font-style:italic">private</span><span style="color:#F8F8F2"> set; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> Dictionary</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">uint</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">EntityController</span><span style="color:#F8F8F2">&gt; Entities </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Dictionary</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">uint</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">EntityController</span><span style="color:#F8F8F2">&gt;();</span></span>
<span class="line"><span style="color:#FF79C6"> public</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> Dictionary</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">uint</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">PlayerController</span><span style="color:#F8F8F2">&gt; Players </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Dictionary</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">uint</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">PlayerController</span><span style="color:#F8F8F2">&gt;();</span></span></code></pre>
<p>Next lets add some callbacks when rows change in the database. Modify the <code>HandleConnect</code> method as below.</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#6272A4">    // Called when we connect to SpacetimeDB and receive our client identity</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> HandleConnect</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">DbConnection</span><span style="color:#FFB86C;font-style:italic"> conn</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Identity</span><span style="color:#FFB86C;font-style:italic"> identity</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">string</span><span style="color:#FFB86C;font-style:italic"> token</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        Debug.</span><span style="color:#50FA7B">Log</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Connected.</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        AuthToken.</span><span style="color:#50FA7B">SaveToken</span><span style="color:#F8F8F2">(token);</span></span>
<span class="line"><span style="color:#F8F8F2">        LocalIdentity </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> identity;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">        conn.Db.Circle.OnInsert </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> CircleOnInsert;</span></span>
<span class="line"><span style="color:#F8F8F2">        conn.Db.Entity.OnUpdate </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> EntityOnUpdate;</span></span>
<span class="line"><span style="color:#F8F8F2">        conn.Db.Entity.OnDelete </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> EntityOnDelete;</span></span>
<span class="line"><span style="color:#F8F8F2">        conn.Db.Food.OnInsert </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> FoodOnInsert;</span></span>
<span class="line"><span style="color:#F8F8F2">        conn.Db.Player.OnInsert </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> PlayerOnInsert;</span></span>
<span class="line"><span style="color:#F8F8F2">        conn.Db.Player.OnDelete </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> PlayerOnDelete;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">        OnConnected</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">Invoke</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        // Request all tables</span></span>
<span class="line"><span style="color:#F8F8F2">        Conn.</span><span style="color:#50FA7B">SubscriptionBuilder</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#50FA7B">OnApplied</span><span style="color:#F8F8F2">(HandleSubscriptionApplied)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#50FA7B">SubscribeToAllTables</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span></code></pre>
<p>Next add the following implementations for those callbacks to the <code>GameManager</code> class.</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> CircleOnInsert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EventContext</span><span style="color:#FFB86C;font-style:italic"> context</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Circle</span><span style="color:#FFB86C;font-style:italic"> insertedValue</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> GetOrCreatePlayer</span><span style="color:#F8F8F2">(insertedValue.PlayerId);</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> entityController </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> PrefabManager.</span><span style="color:#50FA7B">SpawnCircle</span><span style="color:#F8F8F2">(insertedValue, player);</span></span>
<span class="line"><span style="color:#F8F8F2">        Entities.</span><span style="color:#50FA7B">Add</span><span style="color:#F8F8F2">(insertedValue.EntityId, entityController);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> EntityOnUpdate</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EventContext</span><span style="color:#FFB86C;font-style:italic"> context</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#FFB86C;font-style:italic"> oldEntity</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#FFB86C;font-style:italic"> newEntity</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">Entities.</span><span style="color:#50FA7B">TryGetValue</span><span style="color:#F8F8F2">(newEntity.EntityId, </span><span style="color:#FF79C6">out</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> entityController))</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#FF79C6">            return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">        entityController.</span><span style="color:#50FA7B">OnEntityUpdated</span><span style="color:#F8F8F2">(newEntity);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> EntityOnDelete</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EventContext</span><span style="color:#FFB86C;font-style:italic"> context</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Entity</span><span style="color:#FFB86C;font-style:italic"> oldEntity</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (Entities.</span><span style="color:#50FA7B">Remove</span><span style="color:#F8F8F2">(oldEntity.EntityId, </span><span style="color:#FF79C6">out</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> entityController))</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            entityController.</span><span style="color:#50FA7B">OnDelete</span><span style="color:#F8F8F2">(context);</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> FoodOnInsert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EventContext</span><span style="color:#FFB86C;font-style:italic"> context</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Food</span><span style="color:#FFB86C;font-style:italic"> insertedValue</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> entityController </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> PrefabManager.</span><span style="color:#50FA7B">SpawnFood</span><span style="color:#F8F8F2">(insertedValue);</span></span>
<span class="line"><span style="color:#F8F8F2">        Entities.</span><span style="color:#50FA7B">Add</span><span style="color:#F8F8F2">(insertedValue.EntityId, entityController);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> PlayerOnInsert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EventContext</span><span style="color:#FFB86C;font-style:italic"> context</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Player</span><span style="color:#FFB86C;font-style:italic"> insertedPlayer</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#50FA7B">        GetOrCreatePlayer</span><span style="color:#F8F8F2">(insertedPlayer.PlayerId);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> PlayerOnDelete</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">EventContext</span><span style="color:#FFB86C;font-style:italic"> context</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Player</span><span style="color:#FFB86C;font-style:italic"> deletedvalue</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (Players.</span><span style="color:#50FA7B">Remove</span><span style="color:#F8F8F2">(deletedvalue.PlayerId, </span><span style="color:#FF79C6">out</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> playerController))</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            GameObject.</span><span style="color:#50FA7B">Destroy</span><span style="color:#F8F8F2">(playerController.gameObject);</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> static</span><span style="color:#8BE9FD;font-style:italic"> PlayerController</span><span style="color:#50FA7B"> GetOrCreatePlayer</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">uint</span><span style="color:#FFB86C;font-style:italic"> playerId</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2">Players.</span><span style="color:#50FA7B">TryGetValue</span><span style="color:#F8F8F2">(playerId, </span><span style="color:#FF79C6">out</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> playerController))</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#FF79C6">            var</span><span style="color:#F8F8F2"> player </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Conn.Db.Player.PlayerId.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(playerId);</span></span>
<span class="line"><span style="color:#F8F8F2">            playerController </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> PrefabManager.</span><span style="color:#50FA7B">SpawnPlayer</span><span style="color:#F8F8F2">(player);</span></span>
<span class="line"><span style="color:#F8F8F2">            Players.</span><span style="color:#50FA7B">Add</span><span style="color:#F8F8F2">(playerId, playerController);</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> playerController;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span></code></pre>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="camera-controller">Camera Controller<a href="#camera-controller" class="hash-link" aria-label="Direct link to Camera Controller" title="Direct link to Camera Controller" translate="no">​</a></h3>
<p>One of the last steps is to create a camera controller to make sure the camera moves around with the player. Create a script called <code>CameraController.cs</code> and add it to your project. Replace the contents of the file with this:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Collections</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> System</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Collections</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Generic</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">using</span><span style="color:#8BE9FD;font-style:italic"> UnityEngine</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> CameraController</span><span style="color:#F8F8F2"> : </span><span style="color:#8BE9FD;font-style:italic">MonoBehaviour</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> float</span><span style="color:#F8F8F2"> WorldSize </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.0f</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> LateUpdate</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> arenaCenterTransform </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Vector3</span><span style="color:#F8F8F2">(WorldSize </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">, WorldSize </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">-</span><span style="color:#BD93F9">10.0f</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (PlayerController.Local </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> null</span><span style="color:#FF79C6"> ||</span><span style="color:#FF79C6"> !</span><span style="color:#F8F8F2">GameManager.</span><span style="color:#50FA7B">IsConnected</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#6272A4">            // Set the camera to be in middle of the arena if we are not connected or</span></span>
<span class="line"><span style="color:#6272A4">            // there is no local player</span></span>
<span class="line"><span style="color:#F8F8F2">            transform.position </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> arenaCenterTransform;</span></span>
<span class="line"><span style="color:#FF79C6">            return</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> centerOfMass </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> PlayerController.Local.</span><span style="color:#50FA7B">CenterOfMass</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> (centerOfMass.HasValue)</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#6272A4">            // Set the camera to be the center of mass of the local player</span></span>
<span class="line"><span style="color:#6272A4">            // if the local player has one</span></span>
<span class="line"><span style="color:#F8F8F2">            transform.position </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> Vector3</span></span>
<span class="line"><span style="color:#F8F8F2">            {</span></span>
<span class="line"><span style="color:#F8F8F2">                x </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> centerOfMass.Value.x,</span></span>
<span class="line"><span style="color:#F8F8F2">                y </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> centerOfMass.Value.y,</span></span>
<span class="line"><span style="color:#F8F8F2">                z </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> transform.position.z</span></span>
<span class="line"><span style="color:#F8F8F2">            };</span></span>
<span class="line"><span style="color:#F8F8F2">        } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            transform.position </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> arenaCenterTransform;</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  float</span><span style="color:#F8F8F2"> targetCameraSize </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> CalculateCameraSize</span><span style="color:#F8F8F2">(PlayerController.Local);</span></span>
<span class="line"><span style="color:#F8F8F2">  Camera.main.orthographicSize </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Mathf.</span><span style="color:#50FA7B">Lerp</span><span style="color:#F8F8F2">(Camera.main.orthographicSize, targetCameraSize, Time.deltaTime </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> float</span><span style="color:#50FA7B"> CalculateCameraSize</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">PlayerController</span><span style="color:#FFB86C;font-style:italic"> player</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  return</span><span style="color:#BD93F9"> 50f</span><span style="color:#FF79C6"> +</span><span style="color:#6272A4"> //Base size</span></span>
<span class="line"><span style="color:#F8F8F2">            Mathf.</span><span style="color:#50FA7B">Min</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">, player.</span><span style="color:#50FA7B">TotalMass</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 5</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">+</span><span style="color:#6272A4"> //Increase camera size with mass</span></span>
<span class="line"><span style="color:#F8F8F2">            Mathf.</span><span style="color:#50FA7B">Min</span><span style="color:#F8F8F2">(player.NumberOfOwnedCircles </span><span style="color:#FF79C6">-</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 30</span><span style="color:#F8F8F2">; </span><span style="color:#6272A4">//Zoom out when player splits</span></span>
<span class="line"><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>Add the <code>CameraController</code> as a component to the <code>Main Camera</code> object in the scene.</p>
<p>Lastly modify the <code>GameManager.SetupArena</code> method to set the <code>WorldSize</code> on the <code>CameraController</code>.</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> SetupArena</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">float</span><span style="color:#FFB86C;font-style:italic"> worldSize</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#50FA7B">        CreateBorderCube</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(worldSize </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">, worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#FF79C6">            new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">, borderThickness)); </span><span style="color:#6272A4">//North</span></span>
<span class="line"><span style="color:#50FA7B">        CreateBorderCube</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(worldSize </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2">borderThickness </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#FF79C6">            new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">, borderThickness)); </span><span style="color:#6272A4">//South</span></span>
<span class="line"><span style="color:#50FA7B">        CreateBorderCube</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">, worldSize </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#FF79C6">            new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(borderThickness, worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">)); </span><span style="color:#6272A4">//East</span></span>
<span class="line"><span style="color:#50FA7B">        CreateBorderCube</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2">borderThickness </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">, worldSize </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#FF79C6">            new</span><span style="color:#8BE9FD;font-style:italic"> Vector2</span><span style="color:#F8F8F2">(borderThickness, worldSize </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> borderThickness </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2.0f</span><span style="color:#F8F8F2">)); </span><span style="color:#6272A4">//West</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        // Set the world size for the camera controller</span></span>
<span class="line"><span style="color:#F8F8F2">        CameraController.WorldSize </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> worldSize;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span></code></pre>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="entering-the-game">Entering the Game<a href="#entering-the-game" class="hash-link" aria-label="Direct link to Entering the Game" title="Direct link to Entering the Game" translate="no">​</a></h3>
<div class="theme-tabs-container tabs-container tabList_MbSD"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Ssy3 tabs__item--active">Rust</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Ssy3">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_sydm"><p>At this point, you may need to regenerate your bindings the following
command from the <code>server-rust</code> directory.</p></div><div role="tabpanel" class="tabItem_sydm" hidden=""><p>At this point, you may need to regenerate your bindings the following
command from the <code>server-csharp</code> directory.</p></div></div></div>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> generate</span><span style="color:#BD93F9"> --lang</span><span style="color:#F1FA8C"> csharp</span><span style="color:#BD93F9"> --out-dir</span><span style="color:#F1FA8C"> ../client-unity/Assets/autogen</span></span></code></pre>
<p>The last step is to call the <code>enter_game</code> reducer on the server, passing in a username for our player, which will spawn a circle for our player. For the sake of simplicity, let&#x27;s call the <code>enter_game</code> reducer from the <code>HandleSubscriptionApplied</code> callback with the name &quot;3Blave&quot;.</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> HandleSubscriptionApplied</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">SubscriptionEventContext</span><span style="color:#FFB86C;font-style:italic"> ctx</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        Debug.</span><span style="color:#50FA7B">Log</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Subscription applied!</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        OnSubscriptionApplied</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">Invoke</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        // Once we have the initial subscription sync&#x27;d to the client cache</span></span>
<span class="line"><span style="color:#6272A4">        // Get the world size from the config table and set up the arena</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> worldSize </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Conn.Db.Config.Id.</span><span style="color:#50FA7B">Find</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">).WorldSize;</span></span>
<span class="line"><span style="color:#50FA7B">        SetupArena</span><span style="color:#F8F8F2">(worldSize);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">        // Call enter game with the player name 3Blave</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx.Reducers.</span><span style="color:#50FA7B">EnterGame</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">3Blave</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span></code></pre>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="trying-it-out">Trying it out<a href="#trying-it-out" class="hash-link" aria-label="Direct link to Trying it out" title="Direct link to Trying it out" translate="no">​</a></h3>
<p>At this point, after publishing our module we can press the play button to see the fruits of our labor! You should be able to see your player&#x27;s circle, with its username label, surrounded by food.</p>
<p><img decoding="async" loading="lazy" alt="Player on screen" src="/assets/images/part-3-player-on-screen-2e752a62db574760fbdc41c9fa52992b.png" width="2134" height="1110" class="img_f3N0"></p>
<div class="theme-admonition theme-admonition-note admonition_scYj alert alert--secondary"><div class="admonitionHeading_zhQc"><span class="admonitionIcon_kfZz"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_O7JJ"><p>The label won&#x27;t be centered at this point. Feel free to adjust it if you like. We just didn&#x27;t want to complicate the tutorial.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">​</a></h3>
<ul>
<li>
<p>If you get an error when running the generate command, make sure you have an empty subfolder in your Unity project Assets folder called <code>autogen</code></p>
</li>
<li>
<p>If you get an error in your Unity console when starting the game, double check that you have published your module and you have the correct module name specified in your <code>GameManager</code>.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_wKCU" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">​</a></h3>
<p>It&#x27;s pretty cool to see our player in game surrounded by food, but there&#x27;s a problem! We can&#x27;t move yet. In the next part, we&#x27;ll explore how to get your player moving and interacting with food and other objects.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/unity/part-2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">2 - Connecting to SpacetimeDB</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/unity/part-4"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">4 - Moving and Colliding</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Ea_L thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#spawning-food" class="table-of-contents__link toc-highlight">Spawning Food</a></li><li><a href="#logging-players-in" class="table-of-contents__link toc-highlight">Logging Players In</a></li><li><a href="#spawning-player-circles" class="table-of-contents__link toc-highlight">Spawning Player Circles</a></li><li><a href="#creating-the-arena" class="table-of-contents__link toc-highlight">Creating the Arena</a></li><li><a href="#creating-gameobjects" class="table-of-contents__link toc-highlight">Creating GameObjects</a></li><li><a href="#hooking-up-the-data" class="table-of-contents__link toc-highlight">Hooking up the Data</a></li><li><a href="#camera-controller" class="table-of-contents__link toc-highlight">Camera Controller</a></li><li><a href="#entering-the-game" class="table-of-contents__link toc-highlight">Entering the Game</a></li><li><a href="#trying-it-out" class="table-of-contents__link toc-highlight">Trying it out</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"></div></footer></div>
</body>
</html>