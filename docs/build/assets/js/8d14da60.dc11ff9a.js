"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1111],{924:(s,e,l)=>{l.r(e),l.d(e,{assets:()=>i,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>t});const n=JSON.parse('{"id":"Appendix/index","title":"Appendix","description":"SEQUENCE","source":"@site/docs/15-Appendix/index.md","sourceDirName":"15-Appendix","slug":"/appendix","permalink":"/appendix","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/appendix"},"sidebar":"sidebar","previous":{"title":"BSATN Data Format","permalink":"/bsatn"}}');var r=l(7711),c=l(6119);const o={slug:"/appendix"},a="Appendix",i={},t=[{value:"SEQUENCE",id:"sequence",level:2},{value:"How It Works",id:"how-it-works",level:3}];function F(s){const e={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,c.R)(),...s.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"appendix",children:"Appendix"})}),"\n",(0,r.jsx)(e.h2,{id:"sequence",children:"SEQUENCE"}),"\n",(0,r.jsxs)(e.p,{children:["For each table containing an ",(0,r.jsx)(e.code,{children:"#[auto_inc]"})," column, SpacetimeDB creates a sequence number generator behind the scenes, which functions similarly to ",(0,r.jsx)(e.code,{children:"postgres"}),"'s ",(0,r.jsx)(e.code,{children:"SEQUENCE"}),"."]}),"\n",(0,r.jsx)(e.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsx)(e.admonition,{type:"warning",children:(0,r.jsx)(e.p,{children:"Sequence number generation is not transactional."})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Sequences in SpacetimeDB use Rust\u2019s ",(0,r.jsx)(e.code,{children:"i128"})," integer type."]}),"\n",(0,r.jsxs)(e.li,{children:["The field type marked with ",(0,r.jsx)(e.code,{children:"#[auto_inc]"})," is cast to ",(0,r.jsx)(e.code,{children:"i128"})," and increments by ",(0,r.jsx)(e.code,{children:"1"})," for each new row."]}),"\n",(0,r.jsxs)(e.li,{children:["Sequences are pre-allocated in chunks of ",(0,r.jsx)(e.code,{children:"4096"})," to speed up number generation, and then are only persisted to disk when the pre-allocated chunk is exhausted."]}),"\n",(0,r.jsx)(e.li,{children:"Numbers are incremented even if a transaction is later rolled back."}),"\n",(0,r.jsxs)(e.li,{children:["Unused numbers are not reclaimed, meaning sequences may have ",(0,r.jsx)(e.em,{children:"gaps"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:["If the server restarts or a transaction rolls back, the sequence continues from the next pre-allocated chunk + ",(0,r.jsx)(e.code,{children:"1"}),":"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Example:"})}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(e.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,r.jsxs)(e.code,{children:[(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"::"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"table(name "}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"="}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:" users, public)]"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"struct"}),(0,r.jsx)(e.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Users"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"    #[auto_inc]"})}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"    user_id"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:":"}),(0,r.jsx)(e.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" u64"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"    name"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:":"}),(0,r.jsx)(e.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" String"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,r.jsx)(e.span,{className:"line"}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"::"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"reducer]"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"pub"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:" fn"}),(0,r.jsx)(e.span,{style:{color:"#50FA7B"},children:" insert_user"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:":"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:" &"}),(0,r.jsx)(e.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:", count"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:":"}),(0,r.jsx)(e.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" u8"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:") {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"    for"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:" i "}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"in"}),(0,r.jsx)(e.span,{style:{color:"#BD93F9"},children:" 0"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:".."}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"count {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"        let"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:" name "}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"="}),(0,r.jsx)(e.span,{style:{color:"#50FA7B"},children:" format!"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"("}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:'"User {}"'}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:", i);"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"        ctx"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"."}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"db"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"."}),(0,r.jsx)(e.span,{style:{color:"#50FA7B"},children:"users"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"()"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"."}),(0,r.jsx)(e.span,{style:{color:"#50FA7B"},children:"insert"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"("}),(0,r.jsx)(e.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Users"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:" { user_id"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:":"}),(0,r.jsx)(e.span,{style:{color:"#BD93F9"},children:" 0"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:", name });"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"#6272A4"},children:"    // Query the table to see the effect of the `[auto_inc]` attribute:"})}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"    for"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:" user "}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"in"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:" ctx"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"."}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"db"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"."}),(0,r.jsx)(e.span,{style:{color:"#50FA7B"},children:"users"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"()"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"."}),(0,r.jsx)(e.span,{style:{color:"#50FA7B"},children:"iter"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"() {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"        log"}),(0,r.jsx)(e.span,{style:{color:"#FF79C6"},children:"::"}),(0,r.jsx)(e.span,{style:{color:"#50FA7B"},children:"info!"}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"("}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:'"User: {:?}"'}),(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:", user);"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,r.jsx)(e.p,{children:"Then:"}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(e.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,r.jsxs)(e.code,{children:[(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#50FA7B"},children:"\u276f"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" cargo"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" run"}),(0,r.jsx)(e.span,{style:{color:"#BD93F9"},children:" --bin"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" spacetimedb-cli"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" call"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" sample"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" insert_user"}),(0,r.jsx)(e.span,{style:{color:"#BD93F9"},children:" 3"})]}),"\n",(0,r.jsx)(e.span,{className:"line"}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#50FA7B"},children:"\u276f"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" spacetimedb-cli"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" logs"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" sample"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"#8BE9FD"},children:"..."})}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#8BE9FD"},children:".."}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" User:"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" Users"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" {"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" user_id:"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" 1,"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" name:"}),(0,r.jsx)(e.span,{style:{color:"#E9F284"},children:' "'}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:"User 0"}),(0,r.jsx)(e.span,{style:{color:"#E9F284"},children:'"'}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" }"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#8BE9FD"},children:".."}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" User:"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" Users"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" {"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" user_id:"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" 2,"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" name:"}),(0,r.jsx)(e.span,{style:{color:"#E9F284"},children:' "'}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:"User 1"}),(0,r.jsx)(e.span,{style:{color:"#E9F284"},children:'"'}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" }"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#8BE9FD"},children:".."}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" User:"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" Users"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" {"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" user_id:"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" 3,"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" name:"}),(0,r.jsx)(e.span,{style:{color:"#E9F284"},children:' "'}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:"User 2"}),(0,r.jsx)(e.span,{style:{color:"#E9F284"},children:'"'}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" }"})]}),"\n",(0,r.jsx)(e.span,{className:"line"}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"#6272A4"},children:"# Database restart, then"})}),"\n",(0,r.jsx)(e.span,{className:"line"}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#50FA7B"},children:"\u276f"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" cargo"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" run"}),(0,r.jsx)(e.span,{style:{color:"#BD93F9"},children:" --bin"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" spacetimedb-cli"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" call"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" sample"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" insert_user"}),(0,r.jsx)(e.span,{style:{color:"#BD93F9"},children:" 1"})]}),"\n",(0,r.jsx)(e.span,{className:"line"}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#50FA7B"},children:"\u276f"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" spacetimedb-cli"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" logs"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" sample"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"#8BE9FD"},children:"..."})}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#8BE9FD"},children:".."}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" User:"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" Users"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" {"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" user_id:"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" 3,"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" name:"}),(0,r.jsx)(e.span,{style:{color:"#E9F284"},children:' "'}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:"User 2"}),(0,r.jsx)(e.span,{style:{color:"#E9F284"},children:'"'}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" }"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"#8BE9FD"},children:".."}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" User:"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" Users"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" {"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" user_id:"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" 4098,"}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" name:"}),(0,r.jsx)(e.span,{style:{color:"#E9F284"},children:' "'}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:"User 0"}),(0,r.jsx)(e.span,{style:{color:"#E9F284"},children:'"'}),(0,r.jsx)(e.span,{style:{color:"#F1FA8C"},children:" }"})]})]})})})]})}function d(s={}){const{wrapper:e}={...(0,c.R)(),...s.components};return e?(0,r.jsx)(e,{...s,children:(0,r.jsx)(F,{...s})}):F(s)}},6119:(s,e,l)=>{l.d(e,{R:()=>o,x:()=>a});var n=l(3303);const r={},c=n.createContext(r);function o(s){const e=n.useContext(c);return n.useMemo(function(){return"function"==typeof s?s(e):{...e,...s}},[e,s])}function a(s){let e;return e=s.disableParentContext?"function"==typeof s.components?s.components(r):s.components||r:o(s.components),n.createElement(c.Provider,{value:e},s.children)}}}]);