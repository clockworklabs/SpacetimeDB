"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[728],{489:(s,l,e)=>{e.r(l),e.d(l,{assets:()=>i,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>n,toc:()=>F});const n=JSON.parse('{"id":"How-To/Incremental-Migrations","title":"Incremental Migrations","description":"SpacetimeDB does not provide built-in support for general schema-modifying migrations. It does, however, allow adding new tables, and changing reducers\' definitions in arbitrary ways. It\'s possible to run general migrations using an external tool, but this is tedious, necessitates downtime, and imposes the requirement that you update all your clients at the same time as publishing your new module version.","source":"@site/docs/11-How-To/01-Incremental-Migrations.md","sourceDirName":"11-How-To","slug":"/how-to/incremental-migrations","permalink":"/how-to/incremental-migrations","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"slug":"/how-to/incremental-migrations"},"sidebar":"sidebar","previous":{"title":"Row Level Security","permalink":"/rls"},"next":{"title":"Reject Client Connections","permalink":"/how-to/reject-client-connections"}}');var c=e(7711),r=e(6119);const a={slug:"/how-to/incremental-migrations"},o="Incremental Migrations",i={},F=[];function t(s){const l={a:"a",code:"code",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",span:"span",ul:"ul",...(0,r.R)(),...s.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(l.header,{children:(0,c.jsx)(l.h1,{id:"incremental-migrations",children:"Incremental Migrations"})}),"\n",(0,c.jsx)(l.p,{children:"SpacetimeDB does not provide built-in support for general schema-modifying migrations. It does, however, allow adding new tables, and changing reducers' definitions in arbitrary ways. It's possible to run general migrations using an external tool, but this is tedious, necessitates downtime, and imposes the requirement that you update all your clients at the same time as publishing your new module version."}),"\n",(0,c.jsxs)(l.p,{children:["Our friends at ",(0,c.jsx)(l.a,{href:"https://www.lightfoxgames.com/",children:"Lightfox Games"})," taught us a pattern they call \"incremental migrations,\" which mitigates all these problems, and works perfectly with SpacetimeDB's capabilities. The short version is that, instead of altering an existing table, you add a new table with the desired new schema. Whenever your module wants to access a row from that table, it first checks the new table. If the row is present in the new table, then you've already migrated, so do whatever you want to do. If the new table doesn't have the row, instead look it up in the old table, compute and insert a row for the new table, and use that. (If the row isn't present in either the old or new table, it's just not present.) If possible, you should also update the row in the old table to match any mutations that happen in the new table, so that outdated clients can still function."]}),"\n",(0,c.jsx)(l.p,{children:"This has several advantages:"}),"\n",(0,c.jsxs)(l.ul,{children:["\n",(0,c.jsxs)(l.li,{children:["SpacetimeDB's module hotswapping makes this a zero-downtime update. Write your new module, ",(0,c.jsx)(l.code,{children:"spacetime publish"})," it, and watch the new table populate as it's used."]}),"\n",(0,c.jsx)(l.li,{children:"It amortizes the cost of transforming rows or computing new columns across many transactions. Rows will only be added to the new table when they're needed."}),"\n",(0,c.jsx)(l.li,{children:"In many cases, old clients from before the update can coexist with new clients that use the new table. You can publish the updated module without disconnecting your clients, roll out the client update through normal channels, and allow your users to update at their own pace."}),"\n"]}),"\n",(0,c.jsxs)(l.p,{children:["For example, imagine we have a table ",(0,c.jsx)(l.code,{children:"player"})," which stores information about our players:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(l.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(l.code,{children:[(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"table(name "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character, public)]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"pub"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" struct"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    #[primary_key]"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Identity"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    #[unique]"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" String"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" u32"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    class"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Class"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[derive("}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"SpacetimeType"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Debug"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Copy"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Clone"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:")]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"pub"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" enum"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Class"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"    Fighter"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"    Caster"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"    Medic"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(l.p,{children:"We'll write a few helper functions and some simple reducers:"}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(l.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(l.code,{children:[(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"reducer]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" create_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", class"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Class"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" String"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    log"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"info!"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'        "Creating new level 1 {class:?} named {nickname}"'}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"db"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"insert"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"sender,"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        nickname,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 1"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        class,"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    });"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" find_character_for_player"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"->"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"db"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"        ."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"        ."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"player_id"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"        ."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"find"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"sender)"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"        ."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"expect"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'"Player has not created a character"'}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" update_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"db"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"player_id"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"update"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(character);"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"reducer]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" rename_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", new_name"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" String"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"    let"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" find_character_for_player"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx);"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    log"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"info!"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'        "Renaming {} to {}"'}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"nickname,"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        new_name,"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"    update_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        ctx,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"        Character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"            nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" new_name,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"            .."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"character"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        },"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"reducer]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" level_up_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"    let"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" find_character_for_player"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx);"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    log"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"info!"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'        "Leveling up {} from {} to {}"'}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"nickname,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"level,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"level "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"+"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 1"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"    update_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        ctx,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"        Character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"            level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"level "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"+"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 1"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"            .."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"character"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        },"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsxs)(l.p,{children:["We'll play around a bit with ",(0,c.jsx)(l.code,{children:"spacetime call"})," to set up a character:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(l.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(l.code,{children:[(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" logs"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" -f"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" &"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" call"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" create_character"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:" '"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'{ "Fighter": {} }'}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:"'"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:' "'}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"Phoebe"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:'"'})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"2025-01-07T15:32:57.447286Z"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"  INFO:"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" src/lib.rs:21:"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Creating"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" new"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" level"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 1"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Fighter"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" named"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Phoebe"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" call"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" -s"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" local"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" rename_character"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:' "'}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"Gefjon"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:'"'})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"2025-01-07T15:33:48.966134Z"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"  INFO:"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" src/lib.rs:48:"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Renaming"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Phoebe"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" to"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Gefjon"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" call"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" -s"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" local"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" level_up_character"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"2025-01-07T15:34:01.437495Z"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"  INFO:"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" src/lib.rs:66:"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Leveling"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" up"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Gefjon"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" from"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 1"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" to"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 2"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" sql"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:" '"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"SELECT * FROM character"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:"'"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" class"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"-----------+----------+-------+----------------"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" <"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"snip"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:">    "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"|"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:' "Gefjon"'}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" 2"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"     |"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"Fighter"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" ="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ())"})]})]})})}),"\n",(0,c.jsxs)(l.p,{children:["See ",(0,c.jsx)(l.a,{href:"/sats-json",children:"the SATS JSON reference"})," for more on the encoding of arguments to ",(0,c.jsx)(l.code,{children:"spacetime call"}),"."]}),"\n",(0,c.jsxs)(l.p,{children:["Now we want to add a new feature: each player should be able to align themselves with the forces of good or evil, so we can get some healthy competition going between our players. We'll start each character off with ",(0,c.jsx)(l.code,{children:"Alliance::Neutral"}),", and then offer them a reducer ",(0,c.jsx)(l.code,{children:"choose_alliance"})," to set it to either ",(0,c.jsx)(l.code,{children:"Alliance::Good"})," or ",(0,c.jsx)(l.code,{children:"Alliance::Evil"}),". Our first attempt will be to add a new column to the type ",(0,c.jsx)(l.code,{children:"Character"}),":"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(l.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(l.code,{children:[(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"table(name "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character, public)]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"struct"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    #[primary_key]"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Identity"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" String"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" u32"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    class"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Class"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    alliance"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Alliance"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[derive("}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"SpacetimeType"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Debug"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Copy"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Clone"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:")]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"enum"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Alliance"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"    Good"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"    Neutral"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"    Evil"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"reducer]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" choose_alliance"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", alliance"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Alliance"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"    let"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" find_character_for_player"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx);"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    log"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"info!"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'        "Setting {}\'s alliance to {:?} for player {}"'}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"nickname,"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        alliance,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"sender,"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"    update_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        ctx,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"        Character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"            alliance,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"            .."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"character"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        },"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsxs)(l.p,{children:["But that will fail, since SpacetimeDB doesn't know how to update our existing ",(0,c.jsx)(l.code,{children:"character"})," rows with the new column:"]}),"\n",(0,c.jsx)(l.pre,{children:(0,c.jsx)(l.code,{children:"Error: Database update rejected: Errors occurred:\nAdding a column alliance to table character requires a manual migration\n"})}),"\n",(0,c.jsxs)(l.p,{children:["Instead, we'll add a new table, ",(0,c.jsx)(l.code,{children:"character_v2"}),", which will coexist with our original ",(0,c.jsx)(l.code,{children:"character"})," table:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(l.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(l.code,{children:[(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"table(name "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character_v2, public)]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"struct"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" CharacterV2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    #[primary_key]"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Identity"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" String"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" u32"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    class"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Class"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    alliance"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Alliance"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsxs)(l.p,{children:["When a new player creates a character, we'll make rows in both tables for them. This way, any old clients that are still subscribing to the original ",(0,c.jsx)(l.code,{children:"character"})," table will continue to work, though of course they won't know about the character's alliance."]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(l.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(l.code,{children:[(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"reducer]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" create_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", class"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Class"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" String"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    log"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"info!"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'        "Creating new level 1 {class:?} named {nickname} for player {}"'}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"sender,"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"db"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"insert"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"sender,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"clone"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(),"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 1"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        class,"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    });"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"db"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"character_v2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"insert"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"CharacterV2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"sender,"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        nickname,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 1"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        class,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        alliance"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" Alliance"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Neutral"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    });"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsxs)(l.p,{children:["We'll update our helper functions so that they operate on ",(0,c.jsx)(l.code,{children:"character_v2"})," rows. In ",(0,c.jsx)(l.code,{children:"find_character_for_player"}),", if we don't see the player's row in ",(0,c.jsx)(l.code,{children:"character_v2"}),", we'll migrate it from ",(0,c.jsx)(l.code,{children:"character"})," on the fly. In this case, we'll make the player neutral, since they haven't chosen an alliance yet."]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(l.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(l.code,{children:[(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" find_character_for_player"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"->"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" CharacterV2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" let"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Some"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(character) "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"db"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"character_v2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"player_id"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"find"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"sender) {"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#6272A4"},children:"        // Already migrated; just return the new player."})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"        return"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character;"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#6272A4"},children:"    // Not yet migrated; look up an old character and update it."})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"    let"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" old_character "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ctx"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"        ."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"db"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"        ."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"        ."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"player_id"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"        ."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"find"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"sender)"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"        ."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"expect"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'"Player has not created a character"'}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"db"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"character_v2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"insert"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"CharacterV2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" old_character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"player_id,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" old_character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"nickname,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" old_character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"level,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        class"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" old_character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"class,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        alliance"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" Alliance"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Neutral"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    })"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsxs)(l.p,{children:["Just like when creating a new character, when we update a ",(0,c.jsx)(l.code,{children:"character_v2"})," row, we'll also update the old ",(0,c.jsx)(l.code,{children:"character"})," row, so that outdated clients can continue to function. It's very important that we perform the same translation between ",(0,c.jsx)(l.code,{children:"character"})," and ",(0,c.jsx)(l.code,{children:"character_v2"})," rows here as in ",(0,c.jsx)(l.code,{children:"create_character"})," and ",(0,c.jsx)(l.code,{children:"find_character_for_player"}),"."]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(l.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(l.code,{children:[(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" update_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" CharacterV2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"db"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"player_id"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"update"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"player_id,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"clone"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(),"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"level,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        class"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"class,"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    });"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"db"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"character_v2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"player_id"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"()"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"update"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(character);"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsxs)(l.p,{children:["Then we can make trivial modifications to the callers of ",(0,c.jsx)(l.code,{children:"update_character"})," so that they pass in ",(0,c.jsx)(l.code,{children:"CharacterV2"})," instances:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(l.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(l.code,{children:[(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"reducer]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" rename_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", new_name"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" String"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"    let"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" find_character_for_player"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx);"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    log"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"info!"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'        "Renaming {} to {}"'}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"nickname,"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        new_name,"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"    update_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        ctx,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"        CharacterV2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"            nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" new_name,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"            .."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"character"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        },"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"reducer]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" level_up_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"    let"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" find_character_for_player"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx);"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    log"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"info!"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'        "Leveling up {} from {} to {}"'}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"nickname,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"level,"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"level "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"+"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 1"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"    update_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        ctx,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"        CharacterV2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"            level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"level "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"+"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 1"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"            .."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"character"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        },"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsxs)(l.p,{children:["And finally, we can define our new ",(0,c.jsx)(l.code,{children:"choose_alliance"})," reducer:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(l.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(l.code,{children:[(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"#[spacetimedb"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"reducer]"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"fn"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" choose_alliance"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" &"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:", alliance"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:":"}),(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Alliance"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:") {"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"    let"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" character "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" find_character_for_player"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"(ctx);"})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    log"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"::"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"info!"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'        "Setting alliance of {} to {:?}"'}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        character"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"nickname,"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        alliance,"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"    update_character"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        ctx,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"        CharacterV2"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" {"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"            alliance,"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"            .."}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"character"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"        },"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(l.p,{children:"A bit more playing around with the CLI will show us that everything works as intended:"}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(l.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(l.code,{children:[(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#6272A4"},children:"# Our row in `character` still exists:"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" sql"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:" '"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"SELECT * FROM character"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:"'"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" class"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"-----------+----------+-------+----------------"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" <"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"snip"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:">    "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"|"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:' "Gefjon"'}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" 2"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"     |"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"Fighter"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" ="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ())"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#6272A4"},children:'# We haven\'t triggered the "Gefjon" row to migrate yet, so `character_v2` is empty:'})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" sql"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" -s"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" local"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:" '"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"SELECT * FROM character_v2"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:"'"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" class"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" alliance"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"-----------+----------+-------+-------+----------"})}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#6272A4"},children:"# Accessing our character, e.g. by leveling up, will cause it to migrate into `character_v2`:"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" call"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" level_up_character"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"2025-01-07T16:00:20.500600Z"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"  INFO:"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" src/lib.rs:110:"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Leveling"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" up"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Gefjon"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" from"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 2"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" to"}),(0,c.jsx)(l.span,{style:{color:"#BD93F9"},children:" 3"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#6272A4"},children:"# Now `character_v2` is populated:"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" sql"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:" '"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"SELECT * FROM character_v2"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:"'"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" class"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"          |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" alliance"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"-----------+----------+-------+----------------+----------------"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" <"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"snip"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:">    "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"|"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:' "Gefjon"'}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" 3"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"     |"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"Fighter"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" ="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ()) "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"|"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"Neutral"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" ="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ())"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#6272A4"},children:"# The original row in `character` still got updated by `level_up_character`,"})}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#6272A4"},children:"# so outdated clients can continue to function:"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" sql"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:" '"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"SELECT * FROM character"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:"'"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" class"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"-----------+----------+-------+----------------"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" <"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"snip"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:">    "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"|"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:' "Gefjon"'}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" 3"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"     |"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"Fighter"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" ="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ())"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#6272A4"},children:"# We can set our alliance:"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" call"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" choose_alliance"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:" '"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:'{ "Good": {} }'}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:"'"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"2025-01-07T16:13:53.816501Z"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"  INFO:"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" src/lib.rs:129:"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Setting"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" alliance"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" of"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Gefjon"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" to"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" Good"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#6272A4"},children:"# And that change shows up in `character_v2`:"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" sql"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:" '"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"SELECT * FROM character_v2"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:"'"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" class"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"          |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" alliance"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"-----------+----------+-------+----------------+-------------"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" <"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"snip"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:">    "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"|"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:' "Gefjon"'}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" 3"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"     |"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"Fighter"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" ="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ()) "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"|"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"Good"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" ="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ())"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#6272A4"},children:"# But `character` is not changed, since it doesn't know about alliances:"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"$"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" spacetime"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" sql"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" incr-migration-demo"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:" '"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:"SELECT * FROM character"}),(0,c.jsx)(l.span,{style:{color:"#E9F284"},children:"'"})]}),"\n",(0,c.jsx)(l.span,{className:"line"}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" player_id"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" nickname"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" level"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" class"})]}),"\n",(0,c.jsx)(l.span,{className:"line",children:(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"-----------+----------+-------+----------------"})}),"\n",(0,c.jsxs)(l.span,{className:"line",children:[(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" <"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"snip"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:">    "}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"|"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:' "Gefjon"'}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:" 3"}),(0,c.jsx)(l.span,{style:{color:"#FF79C6"},children:"     |"}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(l.span,{style:{color:"#50FA7B"},children:"Fighter"}),(0,c.jsx)(l.span,{style:{color:"#F1FA8C"},children:" ="}),(0,c.jsx)(l.span,{style:{color:"#F8F8F2"},children:" ())"})]})]})})}),"\n",(0,c.jsxs)(l.p,{children:["Now that we know how to define incremental migrations, we can add new features that would seem to require breaking schema changes without cumbersome external migration tools and while maintaining compatibility of outdated clients! The complete for this tutorial is on GitHub in the ",(0,c.jsx)(l.code,{children:"clockworklabs/incr-migration-demo"})," repository, in branches ",(0,c.jsx)(l.a,{href:"https://github.com/clockworklabs/incr-migration-demo/tree/v1",children:(0,c.jsx)(l.code,{children:"v1"})}),", ",(0,c.jsx)(l.a,{href:"https://github.com/clockworklabs/incr-migration-demo/tree/fails-publish",children:(0,c.jsx)(l.code,{children:"fails-publish"})})," and ",(0,c.jsx)(l.a,{href:"https://github.com/clockworklabs/incr-migration-demo/tree/v2",children:(0,c.jsx)(l.code,{children:"v2"})}),"."]})]})}function d(s={}){const{wrapper:l}={...(0,r.R)(),...s.components};return l?(0,c.jsx)(l,{...s,children:(0,c.jsx)(t,{...s})}):t(s)}},6119:(s,l,e)=>{e.d(l,{R:()=>a,x:()=>o});var n=e(3303);const c={},r=n.createContext(c);function a(s){const l=n.useContext(r);return n.useMemo(function(){return"function"==typeof s?s(l):{...l,...s}},[l,s])}function o(s){let l;return l=s.disableParentContext?"function"==typeof s.components?s.components(c):s.components||c:a(s.components),n.createElement(r.Provider,{value:l},s.children)}}}]);