"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1438],{6119:(e,s,l)=>{l.d(s,{R:()=>a,x:()=>i});var n=l(3303);const c={},r=n.createContext(c);function a(e){const s=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:a(e.components),n.createElement(r.Provider,{value:s},e.children)}},6230:(e,s,l)=>{l.r(s),l.d(s,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>t});const n=JSON.parse('{"id":"Server Module Languages/CSharp-Quickstart","title":"C# Quickstart","description":"Module Quickstart","source":"@site/docs/06-Server Module Languages/04-CSharp-Quickstart.md","sourceDirName":"06-Server Module Languages","slug":"/modules/c-sharp/quickstart","permalink":"/modules/c-sharp/quickstart","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"C# Quickstart","slug":"/modules/c-sharp/quickstart"},"sidebar":"sidebar","previous":{"title":"Rust Reference","permalink":"/modules/rust"},"next":{"title":"C# Reference","permalink":"/modules/c-sharp"}}');var c=l(7711),r=l(6119);const a={title:"C# Quickstart",slug:"/modules/c-sharp/quickstart"},i="C# Module Quickstart",o={},t=[{value:"Install SpacetimeDB",id:"install-spacetimedb",level:2},{value:"Install .NET 8",id:"install-net-8",level:2},{value:"Project structure",id:"project-structure",level:2},{value:"Declare imports",id:"declare-imports",level:2},{value:"Define tables",id:"define-tables",level:2},{value:"Set users&#39; names",id:"set-users-names",level:2},{value:"Send messages",id:"send-messages",level:2},{value:"Set users&#39; online status",id:"set-users-online-status",level:2},{value:"Start the Server",id:"start-the-server",level:2},{value:"Publish the module",id:"publish-the-module",level:2},{value:"Call Reducers",id:"call-reducers",level:2},{value:"SQL Queries",id:"sql-queries",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}];function d(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.header,{children:(0,c.jsx)(s.h1,{id:"c-module-quickstart",children:"C# Module Quickstart"})}),"\n",(0,c.jsx)(s.p,{children:"In this tutorial, we'll implement a simple chat server as a SpacetimeDB module."}),"\n",(0,c.jsx)(s.p,{children:"A SpacetimeDB module is code that gets compiled to WebAssembly and is uploaded to SpacetimeDB. This code becomes server-side logic that interfaces directly with the Spacetime relational database."}),"\n",(0,c.jsx)(s.p,{children:"Each SpacetimeDB module defines a set of tables and a set of reducers."}),"\n",(0,c.jsxs)(s.p,{children:["Each table is defined as a C# ",(0,c.jsx)(s.code,{children:"class"})," annotated with ",(0,c.jsx)(s.code,{children:"[SpacetimeDB.Table]"}),", where an instance represents a row, and each field represents a column.\nBy default, tables are ",(0,c.jsx)(s.strong,{children:"private"}),". This means that they are only readable by the table owner, and by server module code.\nThe ",(0,c.jsx)(s.code,{children:"[SpacetimeDB.Table(Public = true))]"})," annotation makes a table public. ",(0,c.jsx)(s.strong,{children:"Public"})," tables are readable by all users, but can still only be modified by your server module code."]}),"\n",(0,c.jsxs)(s.p,{children:["A reducer is a function which traverses and updates the database. Each reducer call runs in its own transaction, and its updates to the database are only committed if the reducer returns successfully. In C#, reducers are defined as functions annotated with ",(0,c.jsx)(s.code,{children:"[SpacetimeDB.Reducer]"}),". If an exception is thrown, the reducer call fails, the database is not updated, and a failed message is reported to the client."]}),"\n",(0,c.jsx)(s.h2,{id:"install-spacetimedb",children:"Install SpacetimeDB"}),"\n",(0,c.jsxs)(s.p,{children:["If you haven't already, start by ",(0,c.jsx)(s.a,{href:"https://spacetimedb.com/install",children:"installing SpacetimeDB"}),". This will install the ",(0,c.jsx)(s.code,{children:"spacetime"})," command line interface (CLI), which contains all the functionality for interacting with SpacetimeDB."]}),"\n",(0,c.jsx)(s.h2,{id:"install-net-8",children:"Install .NET 8"}),"\n",(0,c.jsxs)(s.p,{children:["Next we need to ",(0,c.jsx)(s.a,{href:"https://dotnet.microsoft.com/en-us/download/dotnet/8.0",children:"install .NET 8 SDK"})," so that we can build and publish our module."]}),"\n",(0,c.jsx)(s.p,{children:"You may already have .NET 8 and can be checked:"}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"dotnet"}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" --list-sdks"})]})})})}),"\n",(0,c.jsxs)(s.p,{children:[".NET 8.0 is the earliest to have the ",(0,c.jsx)(s.code,{children:"wasi-experimental"})," workload that we rely on, but requires manual activation:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"dotnet"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" workload"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" install"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" wasi-experimental"})]})})})}),"\n",(0,c.jsx)(s.h2,{id:"project-structure",children:"Project structure"}),"\n",(0,c.jsxs)(s.p,{children:["Create and enter a directory ",(0,c.jsx)(s.code,{children:"quickstart-chat"}),":"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"mkdir"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" quickstart-chat"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#8BE9FD"},children:"cd"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" quickstart-chat"})]})]})})}),"\n",(0,c.jsxs)(s.p,{children:["Now create ",(0,c.jsx)(s.code,{children:"server"}),", our module, which runs in the database:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"spacetime"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" init"}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" --lang"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" csharp"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" server"})]})})})}),"\n",(0,c.jsx)(s.h2,{id:"declare-imports",children:"Declare imports"}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.code,{children:"spacetime init"})," generated a few files:"]}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:["Open ",(0,c.jsx)(s.code,{children:"server/StdbModule.csproj"})," to generate a .sln file for intellisense/validation support."]}),"\n",(0,c.jsxs)(s.li,{children:["Open ",(0,c.jsx)(s.code,{children:"server/Lib.cs"}),", a trivial module."]}),"\n",(0,c.jsx)(s.li,{children:"Clear it out, so we can write a new module that's still pretty simple: a bare-bones chat server."}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["To start, we'll need to add ",(0,c.jsx)(s.code,{children:"SpacetimeDB"})," to our using statements. This will give us access to everything we need to author our SpacetimeDB server module."]}),"\n",(0,c.jsxs)(s.p,{children:["To the top of ",(0,c.jsx)(s.code,{children:"server/Lib.cs"}),", add some imports we'll be using:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"using"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" SpacetimeDB"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]})})})}),"\n",(0,c.jsxs)(s.p,{children:["We also need to create our static module class which all of the module code will live in. In ",(0,c.jsx)(s.code,{children:"server/Lib.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"public"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" static"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" partial"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" class"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD"},children:" Module"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h2,{id:"define-tables",children:"Define tables"}),"\n",(0,c.jsx)(s.p,{children:"To get our chat server running, we'll need to store two kinds of data: information about each user, and records of all the messages that have been sent."}),"\n",(0,c.jsxs)(s.p,{children:["For each ",(0,c.jsx)(s.code,{children:"User"}),", we'll store their ",(0,c.jsx)(s.code,{children:"Identity"}),", an optional name they can set to identify themselves to other users, and whether they're online or not. We'll designate the ",(0,c.jsx)(s.code,{children:"Identity"})," as our primary key, which enforces that it must be unique, indexes it for faster lookup, and allows clients to track updates."]}),"\n",(0,c.jsxs)(s.p,{children:["In ",(0,c.jsx)(s.code,{children:"server/Lib.cs"}),", add the definition of the table ",(0,c.jsx)(s.code,{children:"User"})," to the ",(0,c.jsx)(s.code,{children:"Module"})," class:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"["}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Table"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(Name "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:' "'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"user"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", Public "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" true"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")]"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"public"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" partial"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" class"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD"},children:" User"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    ["}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"PrimaryKey"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"]"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    public"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Identity"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" Identity;"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    public"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" string"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"? Name;"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    public"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" bool"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" Online;"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsxs)(s.p,{children:["For each ",(0,c.jsx)(s.code,{children:"Message"}),", we'll store the ",(0,c.jsx)(s.code,{children:"Identity"})," of the user who sent it, the ",(0,c.jsx)(s.code,{children:"Timestamp"})," when it was sent, and the text of the message."]}),"\n",(0,c.jsxs)(s.p,{children:["In ",(0,c.jsx)(s.code,{children:"server/Lib.cs"}),", add the definition of the table ",(0,c.jsx)(s.code,{children:"Message"})," to the ",(0,c.jsx)(s.code,{children:"Module"})," class:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"["}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Table"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(Name "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:' "'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"message"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", Public "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" true"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")]"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"public"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" partial"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" class"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD"},children:" Message"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    public"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Identity"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" Sender;"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    public"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Timestamp"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" Sent;"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    public"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" string"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" Text "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:' ""'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h2,{id:"set-users-names",children:"Set users' names"}),"\n",(0,c.jsxs)(s.p,{children:["We want to allow users to set their names, because ",(0,c.jsx)(s.code,{children:"Identity"})," is not a terribly user-friendly identifier. To that effect, we define a reducer ",(0,c.jsx)(s.code,{children:"SetName"})," which clients can invoke to set their ",(0,c.jsx)(s.code,{children:"User.Name"}),". It will validate the caller's chosen name, using a function ",(0,c.jsx)(s.code,{children:"ValidateName"})," which we'll define next, then look up the ",(0,c.jsx)(s.code,{children:"User"})," record for the caller and update it to store the validated name. If the name fails the validation, the reducer will fail."]}),"\n",(0,c.jsxs)(s.p,{children:["Each reducer must accept as its first argument a ",(0,c.jsx)(s.code,{children:"ReducerContext"}),", which includes contextual data such as the ",(0,c.jsx)(s.code,{children:"Sender"})," which contains the Identity of the client that called the reducer, and the ",(0,c.jsx)(s.code,{children:"Timestamp"})," when it was invoked. For now, we only need the ",(0,c.jsx)(s.code,{children:"Sender"}),"."]}),"\n",(0,c.jsxs)(s.p,{children:["It's also possible to call ",(0,c.jsx)(s.code,{children:"SetName"})," via the SpacetimeDB CLI's ",(0,c.jsx)(s.code,{children:"spacetime call"})," command without a connection, in which case no ",(0,c.jsx)(s.code,{children:"User"})," record will exist for the caller. We'll return an error in this case, but you could alter the reducer to insert a ",(0,c.jsx)(s.code,{children:"User"})," row for the module owner. You'll have to decide whether the module owner is always online or always offline, though."]}),"\n",(0,c.jsxs)(s.p,{children:["In ",(0,c.jsx)(s.code,{children:"server/Lib.cs"}),", add to the ",(0,c.jsx)(s.code,{children:"Module"})," class:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"["}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Reducer"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"]"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"public"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" static"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" SetName"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" ctx"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" name"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    name "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" ValidateName"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(name);"})]}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (ctx.Db.user.Identity."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Find"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(ctx.Sender) "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"is"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" User"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" user)"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        user.Name "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" name;"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ctx.Db.user.Identity."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Update"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(user);"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.p,{children:"For now, we'll just do a bare minimum of validation, rejecting the empty name. You could extend this in various ways, like:"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsx)(s.li,{children:"Comparing against a blacklist for moderation purposes."}),"\n",(0,c.jsx)(s.li,{children:"Unicode-normalizing names."}),"\n",(0,c.jsx)(s.li,{children:"Rejecting names that contain non-printable characters, or removing characters or replacing them with a placeholder."}),"\n",(0,c.jsx)(s.li,{children:"Rejecting or truncating long names."}),"\n",(0,c.jsx)(s.li,{children:"Rejecting duplicate names."}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["In ",(0,c.jsx)(s.code,{children:"server/Lib.cs"}),", add to the ",(0,c.jsx)(s.code,{children:"Module"})," class:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Takes a name and checks if it's acceptable as a user's name."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"private"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" static"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" string"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" ValidateName"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" name"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"IsNullOrEmpty"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(name))"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"        throw"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" new"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Exception"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"Names must not be empty"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    return"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" name;"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h2,{id:"send-messages",children:"Send messages"}),"\n",(0,c.jsxs)(s.p,{children:["We define a reducer ",(0,c.jsx)(s.code,{children:"SendMessage"}),", which clients will call to send messages. It will validate the message's text, then insert a new ",(0,c.jsx)(s.code,{children:"Message"})," record using ",(0,c.jsx)(s.code,{children:"Message.Insert"}),", with the ",(0,c.jsx)(s.code,{children:"Sender"})," identity and ",(0,c.jsx)(s.code,{children:"Time"})," timestamp taken from the ",(0,c.jsx)(s.code,{children:"ReducerContext"}),"."]}),"\n",(0,c.jsxs)(s.p,{children:["In ",(0,c.jsx)(s.code,{children:"server/Lib.cs"}),", add to the ",(0,c.jsx)(s.code,{children:"Module"})," class:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"["}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Reducer"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"]"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"public"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" static"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" SendMessage"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" ctx"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" text"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    text "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" ValidateMessage"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(text);"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    Log."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Info"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(text);"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    ctx.Db.message."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Insert"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"        new"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Message"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"            Sender "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" ctx.Sender,"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"            Text "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" text,"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"            Sent "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" ctx.Timestamp,"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    );"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.p,{children:"We'll want to validate messages' texts in much the same way we validate users' chosen names. As above, we'll do the bare minimum, rejecting only empty messages."}),"\n",(0,c.jsxs)(s.p,{children:["In ",(0,c.jsx)(s.code,{children:"server/Lib.cs"}),", add to the ",(0,c.jsx)(s.code,{children:"Module"})," class:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Takes a message's text and checks if it's acceptable to send."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"private"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" static"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" string"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" ValidateMessage"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" text"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"IsNullOrEmpty"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(text))"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"        throw"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" new"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" ArgumentException"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"Messages must not be empty"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    return"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" text;"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsxs)(s.p,{children:["You could extend the validation in ",(0,c.jsx)(s.code,{children:"ValidateMessage"})," in similar ways to ",(0,c.jsx)(s.code,{children:"ValidateName"}),", or add additional checks to ",(0,c.jsx)(s.code,{children:"SendMessage"}),", like:"]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsx)(s.li,{children:"Rejecting messages from senders who haven't set their names."}),"\n",(0,c.jsx)(s.li,{children:"Rate-limiting users so they can't send new messages too quickly."}),"\n"]}),"\n",(0,c.jsx)(s.h2,{id:"set-users-online-status",children:"Set users' online status"}),"\n",(0,c.jsxs)(s.p,{children:["In C# modules, you can register for ",(0,c.jsx)(s.code,{children:"Connect"})," and ",(0,c.jsx)(s.code,{children:"Disconnect"})," events by using a special ",(0,c.jsx)(s.code,{children:"ReducerKind"}),". We'll use the ",(0,c.jsx)(s.code,{children:"Connect"})," event to create a ",(0,c.jsx)(s.code,{children:"User"})," record for the client if it doesn't yet exist, and to set its online status."]}),"\n",(0,c.jsxs)(s.p,{children:["We'll use ",(0,c.jsx)(s.code,{children:"reducerContext.Db.User.Identity.Find"})," to look up a ",(0,c.jsx)(s.code,{children:"User"})," row for ",(0,c.jsx)(s.code,{children:"ctx.Sender"}),", if one exists. If we find one, we'll use ",(0,c.jsx)(s.code,{children:"reducerContext.Db.User.Identity.Update"})," to overwrite it with a row that has ",(0,c.jsx)(s.code,{children:"Online: true"}),". If not, we'll use ",(0,c.jsx)(s.code,{children:"User.Insert"})," to insert a new row for our new user. All three of these methods are generated by the ",(0,c.jsx)(s.code,{children:"[SpacetimeDB.Table]"})," attribute, with rows and behavior based on the row attributes. ",(0,c.jsx)(s.code,{children:"User.Identity.Find"})," returns a nullable ",(0,c.jsx)(s.code,{children:"User"}),", because the unique constraint from the ",(0,c.jsx)(s.code,{children:"[PrimaryKey]"})," attribute means there will be either zero or one matching rows. ",(0,c.jsx)(s.code,{children:"Insert"})," will throw an exception if the insert violates this constraint; if we want to overwrite a ",(0,c.jsx)(s.code,{children:"User"})," row, we need to do so explicitly using ",(0,c.jsx)(s.code,{children:"User.Identity.Update"}),"."]}),"\n",(0,c.jsxs)(s.p,{children:["In ",(0,c.jsx)(s.code,{children:"server/Lib.cs"}),", add the definition of the connect reducer to the ",(0,c.jsx)(s.code,{children:"Module"})," class:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"["}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Reducer"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(ReducerKind.ClientConnected)]"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"public"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" static"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" ClientConnected"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" ctx"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    Log."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Info"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'$"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"Connect "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"ctx"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"."}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"Sender"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (ctx.Db.user.Identity."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Find"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(ctx.Sender) "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"is"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" User"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" user)"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"        // If this is a returning user, i.e., we already have a `User` with this `Identity`,"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"        // set `Online: true`, but leave `Name` and `Identity` unchanged."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        user.Online "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" true"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ctx.Db.user.Identity."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Update"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(user);"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    else"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"        // If this is a new user, create a `User` object for the `Identity`,"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"        // which is online, but hasn't set a name."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ctx.Db.user."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Insert"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"            new"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" User"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"            {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"                Name "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" null"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"                Identity "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" ctx.Sender,"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"                Online "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" true"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:","})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"            }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        );"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsxs)(s.p,{children:["Similarly, whenever a client disconnects, the database will execute the ",(0,c.jsx)(s.code,{children:"OnDisconnect"})," event if it's registered with ",(0,c.jsx)(s.code,{children:"ReducerKind.ClientDisconnected"}),". We'll use it to un-set the ",(0,c.jsx)(s.code,{children:"Online"})," status of the ",(0,c.jsx)(s.code,{children:"User"})," for the disconnected client."]}),"\n",(0,c.jsxs)(s.p,{children:["Add the following code after the ",(0,c.jsx)(s.code,{children:"OnConnect"})," handler:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"["}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Reducer"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(ReducerKind.ClientDisconnected)]"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"public"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" static"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" ClientDisconnected"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerContext"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" ctx"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (ctx.Db.user.Identity."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Find"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(ctx.Sender) "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"is"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" User"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" user)"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"        // This user should exist, so set `Online: false`."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        user.Online "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" false"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ctx.Db.user.Identity."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Update"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(user);"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    else"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"        // User does not exist, log warning"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        Log."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Warn"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"Warning: No user found for disconnected client."}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h2,{id:"start-the-server",children:"Start the Server"}),"\n",(0,c.jsxs)(s.p,{children:["If you haven't already started the SpacetimeDB server, run the ",(0,c.jsx)(s.code,{children:"spacetime start"})," command in a ",(0,c.jsx)(s.em,{children:"separate"})," terminal and leave it running while you continue following along."]}),"\n",(0,c.jsx)(s.h2,{id:"publish-the-module",children:"Publish the module"}),"\n",(0,c.jsxs)(s.p,{children:["And that's all of our module code! We'll run ",(0,c.jsx)(s.code,{children:"spacetime publish"})," to compile our module and publish it on SpacetimeDB. ",(0,c.jsx)(s.code,{children:"spacetime publish"})," takes an optional name which will map to the database's unique address. Clients can connect either by name or by address, but names are much more pleasant. In this example, we'll be using ",(0,c.jsx)(s.code,{children:"quickstart-chat"}),". Feel free to come up with a unique name, and in the CLI commands, replace where we've written ",(0,c.jsx)(s.code,{children:"quickstart-chat"})," with the name you chose."]}),"\n",(0,c.jsxs)(s.p,{children:["From the ",(0,c.jsx)(s.code,{children:"quickstart-chat"})," directory, run:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"spacetime"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" publish"}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" --project-path"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" server"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" quickstart-chat"})]})})})}),"\n",(0,c.jsxs)(s.p,{children:["Note: If the WebAssembly optimizer ",(0,c.jsx)(s.code,{children:"wasm-opt"})," is installed, ",(0,c.jsx)(s.code,{children:"spacetime publish"})," will automatically optimize the Web Assembly output of the published module. Instruction for installing the ",(0,c.jsx)(s.code,{children:"wasm-opt"})," binary can be found in ",(0,c.jsx)(s.a,{href:"https://docs.rs/wasm-opt/latest/wasm_opt/",children:"Rust's wasm-opt documentation"}),"."]}),"\n",(0,c.jsx)(s.h2,{id:"call-reducers",children:"Call Reducers"}),"\n",(0,c.jsx)(s.p,{children:"You can use the CLI (command line interface) to run reducers. The arguments to the reducer are passed in JSON format."}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"spacetime"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" call"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" quickstart-chat"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" SendMessage"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:' "'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"Hello, World!"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'})]})})})}),"\n",(0,c.jsxs)(s.p,{children:["Once we've called our ",(0,c.jsx)(s.code,{children:"SendMessage"})," reducer, we can check to make sure it ran by running the ",(0,c.jsx)(s.code,{children:"logs"})," command."]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"spacetime"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" logs"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" quickstart-chat"})]})})})}),"\n",(0,c.jsx)(s.p,{children:"You should now see the output that your module printed in the database."}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"info:"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" Hello,"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" World!"})]})})})}),"\n",(0,c.jsx)(s.h2,{id:"sql-queries",children:"SQL Queries"}),"\n",(0,c.jsxs)(s.p,{children:["SpacetimeDB supports a subset of the SQL syntax so that you can easily query the data of your database. We can run a query using the ",(0,c.jsx)(s.code,{children:"sql"})," command."]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"spacetime"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" sql"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" quickstart-chat"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:' "'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"SELECT * FROM message"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'})]})})})}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" sender"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"                                                             |"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" sent"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"                             |"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" text"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"--------------------------------------------------------------------+----------------------------------+-----------------"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" 0x93dda09db9a56d8fa6c024d843e805d8262191db3b4ba84c5efcd1ad451fed4e"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" 2025-04-08T15:47:46.935402+00:00"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" |"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:' "Hello, world!"'})]})]})})}),"\n",(0,c.jsx)(s.h2,{id:"whats-next",children:"What's next?"}),"\n",(0,c.jsxs)(s.p,{children:["You've just set up your first database in SpacetimeDB! You can find the full code for this client ",(0,c.jsx)(s.a,{href:"https://github.com/clockworklabs/SpacetimeDB/tree/master/sdks/csharp/examples~/quickstart-chat/server",children:"in the C# server module example"}),"."]}),"\n",(0,c.jsxs)(s.p,{children:["The next step would be to create a client that interacts with this module. You can use any of SpacetimeDB's supported client languages to do this. Take a look at the quick start guide for your client language of choice: ",(0,c.jsx)(s.a,{href:"/sdks/rust/quickstart",children:"Rust"}),", ",(0,c.jsx)(s.a,{href:"/sdks/c-sharp/quickstart",children:"C#"}),", or ",(0,c.jsx)(s.a,{href:"/sdks/typescript/quickstart",children:"TypeScript"}),"."]}),"\n",(0,c.jsxs)(s.p,{children:["If you are planning to use SpacetimeDB with the Unity game engine, you can skip right to the ",(0,c.jsx)(s.a,{href:"/unity/part-1",children:"Unity Comprehensive Tutorial"}),"."]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}}}]);