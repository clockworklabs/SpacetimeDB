"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2453],{6119:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>o});var l=n(3303);const c={},r=l.createContext(c);function a(e){const s=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:a(e.components),l.createElement(r.Provider,{value:s},e.children)}},7237:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>i,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"Client SDK Languages/CSharp-Quickstart","title":"C# Quickstart","description":"Client SDK Quick Start","source":"@site/docs/07-Client SDK Languages/02-CSharp-Quickstart.md","sourceDirName":"07-Client SDK Languages","slug":"/sdks/c-sharp/quickstart","permalink":"/sdks/c-sharp/quickstart","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"C# Quickstart","slug":"/sdks/c-sharp/quickstart"},"sidebar":"sidebar","previous":{"title":"Overview","permalink":"/sdks"},"next":{"title":"C# Reference","permalink":"/sdks/c-sharp"}}');var c=n(7711),r=n(6119);const a={title:"C# Quickstart",slug:"/sdks/c-sharp/quickstart"},o="C# Client SDK Quick Start",i={},t=[{value:"Project structure",id:"project-structure",level:2},{value:"Add the NuGet package for the C# SpacetimeDB SDK",id:"add-the-nuget-package-for-the-c-spacetimedb-sdk",level:2},{value:"Clear <code>client/Program.cs</code>",id:"clear-clientprogramcs",level:2},{value:"Generate your module types",id:"generate-your-module-types",level:2},{value:"Add imports to Program.cs",id:"add-imports-to-programcs",level:2},{value:"Define Main function",id:"define-main-function",level:2},{value:"Connect to database",id:"connect-to-database",level:2},{value:"Save credentials",id:"save-credentials",level:3},{value:"Connect Error callback",id:"connect-error-callback",level:3},{value:"Disconnect callback",id:"disconnect-callback",level:3},{value:"Register callbacks",id:"register-callbacks",level:2},{value:"Notify about new users",id:"notify-about-new-users",level:3},{value:"Notify about updated users",id:"notify-about-updated-users",level:3},{value:"Print messages",id:"print-messages",level:3},{value:"Warn if our name was rejected",id:"warn-if-our-name-was-rejected",level:3},{value:"Warn if our message was rejected",id:"warn-if-our-message-was-rejected",level:3},{value:"Subscribe to queries",id:"subscribe-to-queries",level:2},{value:"OnSubscriptionApplied callback",id:"onsubscriptionapplied-callback",level:2},{value:"Process thread",id:"process-thread",level:2},{value:"Handle user input",id:"handle-user-input",level:2},{value:"Run the client",id:"run-the-client",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}];function d(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.header,{children:(0,c.jsx)(s.h1,{id:"c-client-sdk-quick-start",children:"C# Client SDK Quick Start"})}),"\n",(0,c.jsx)(s.p,{children:"In this guide we'll show you how to get up and running with a simple SpacetimeDB app with a client written in C#."}),"\n",(0,c.jsxs)(s.p,{children:["We'll implement a command-line client for the module created in our ",(0,c.jsx)(s.a,{href:"../../modules/rust/quickstart",children:"Rust"})," or ",(0,c.jsx)(s.a,{href:"../../modules/c-sharp/quickstart",children:"C# Module"})," Quickstart guides. Ensure you followed one of these guides before continuing."]}),"\n",(0,c.jsx)(s.h2,{id:"project-structure",children:"Project structure"}),"\n",(0,c.jsxs)(s.p,{children:["Enter the directory ",(0,c.jsx)(s.code,{children:"quickstart-chat"})," you created in the ",(0,c.jsx)(s.a,{href:"/modules/rust/quickstart",children:"Rust Module Quickstart"})," or ",(0,c.jsx)(s.a,{href:"/modules/c-sharp/quickstart",children:"C# Module Quickstart"})," guides:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#8BE9FD"},children:"cd"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" quickstart-chat"})]})})})}),"\n",(0,c.jsxs)(s.p,{children:["Within it, create a new C# console application project called ",(0,c.jsx)(s.code,{children:"client"})," using either Visual Studio, Rider or the .NET CLI:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"dotnet"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" new"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" console"}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" -o"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" client"})]})})})}),"\n",(0,c.jsx)(s.p,{children:"Open the project in your IDE of choice."}),"\n",(0,c.jsx)(s.h2,{id:"add-the-nuget-package-for-the-c-spacetimedb-sdk",children:"Add the NuGet package for the C# SpacetimeDB SDK"}),"\n",(0,c.jsxs)(s.p,{children:["Add the ",(0,c.jsx)(s.code,{children:"SpacetimeDB.ClientSDK"})," ",(0,c.jsx)(s.a,{href:"https://www.nuget.org/packages/SpacetimeDB.ClientSDK/",children:"NuGet package"})," using Visual Studio or Rider ",(0,c.jsx)(s.em,{children:"NuGet Package Manager"})," or via the .NET CLI:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"dotnet"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" add"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" package"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" SpacetimeDB.ClientSDK"})]})})})}),"\n",(0,c.jsxs)(s.h2,{id:"clear-clientprogramcs",children:["Clear ",(0,c.jsx)(s.code,{children:"client/Program.cs"})]}),"\n",(0,c.jsxs)(s.p,{children:["Clear out any data from ",(0,c.jsx)(s.code,{children:"client/Program.cs"})," so we can write our chat client."]}),"\n",(0,c.jsx)(s.h2,{id:"generate-your-module-types",children:"Generate your module types"}),"\n",(0,c.jsxs)(s.p,{children:["The ",(0,c.jsx)(s.code,{children:"spacetime"})," CLI's ",(0,c.jsx)(s.code,{children:"generate"})," command will generate client-side interfaces for the tables, reducers and types defined in your server module."]}),"\n",(0,c.jsxs)(s.p,{children:["In your ",(0,c.jsx)(s.code,{children:"quickstart-chat"})," directory, run:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"mkdir"}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" -p"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" client/module_bindings"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"spacetime"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" generate"}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" --lang"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" csharp"}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" --out-dir"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" client/module_bindings"}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" --project-path"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" server"})]})]})})}),"\n",(0,c.jsxs)(s.p,{children:["Take a look inside ",(0,c.jsx)(s.code,{children:"client/module_bindings"}),". The CLI should have generated three folders and nine files:"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{children:"module_bindings\n\u251c\u2500\u2500 Reducers\n\u2502   \u251c\u2500\u2500 ClientConnected.g.cs\n\u2502   \u251c\u2500\u2500 ClientDisconnected.g.cs\n\u2502   \u251c\u2500\u2500 SendMessage.g.cs\n\u2502   \u2514\u2500\u2500 SetName.g.cs\n\u251c\u2500\u2500 Tables\n\u2502   \u251c\u2500\u2500 Message.g.cs\n\u2502   \u2514\u2500\u2500 User.g.cs\n\u251c\u2500\u2500 Types\n\u2502   \u251c\u2500\u2500 Message.g.cs\n\u2502   \u2514\u2500\u2500 User.g.cs\n\u2514\u2500\u2500 SpacetimeDBClient.g.cs\n"})}),"\n",(0,c.jsx)(s.h2,{id:"add-imports-to-programcs",children:"Add imports to Program.cs"}),"\n",(0,c.jsxs)(s.p,{children:["Open ",(0,c.jsx)(s.code,{children:"client/Program.cs"})," and add the following imports:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"using"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" SpacetimeDB"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"using"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" SpacetimeDB"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"."}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Types"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"using"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" System"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"."}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Collections"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"."}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Concurrent"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]})]})})}),"\n",(0,c.jsxs)(s.p,{children:["We will also need to create some global variables. We'll cover the ",(0,c.jsx)(s.code,{children:"Identity"})," later in the ",(0,c.jsx)(s.code,{children:"Save credentials"})," section. Later we'll also be setting up a second thread for handling user input. In the ",(0,c.jsx)(s.code,{children:"Process thread"})," section we'll use this in the ",(0,c.jsx)(s.code,{children:"ConcurrentQueue"})," to store the commands for that thread."]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"// our local client SpacetimeDB identity"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Identity"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"? local_identity "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" null"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"// declare a thread safe queue to store commands"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"var"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" input_queue "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" new"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" ConcurrentQueue"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"<("}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" Command, "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" Args)>();"})]})]})})}),"\n",(0,c.jsx)(s.h2,{id:"define-main-function",children:"Define Main function"}),"\n",(0,c.jsxs)(s.p,{children:["We'll work outside-in, first defining our ",(0,c.jsx)(s.code,{children:"Main"})," function at a high level, then implementing each behavior it needs. We need ",(0,c.jsx)(s.code,{children:"Main"})," to do several things:"]}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:["Initialize the ",(0,c.jsx)(s.code,{children:"AuthToken"})," module, which loads and stores our authentication token to/from local storage."]}),"\n",(0,c.jsx)(s.li,{children:"Connect to the database."}),"\n",(0,c.jsx)(s.li,{children:"Register a number of callbacks to run in response to various database events."}),"\n",(0,c.jsx)(s.li,{children:"Start our processing thread which connects to the SpacetimeDB database, updates the SpacetimeDB client and processes commands that come in from the input loop running in the main thread."}),"\n",(0,c.jsx)(s.li,{children:"Start the input loop, which reads commands from standard input and sends them to the processing thread."}),"\n",(0,c.jsx)(s.li,{children:"When the input loop exits, stop the processing thread and wait for it to exit."}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" Main"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"()"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"    // Initialize the `AuthToken` module"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    AuthToken."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Init"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:".spacetime_csharp_quickstart"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"    // Builds and connects to the database"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"    DbConnection"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"? conn "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" null"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    conn "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" ConnectToDB"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"    // Registers to run in response to database events."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"    RegisterCallbacks"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(conn);"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"    // Declare a threadsafe cancel token to cancel the process loop"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    var"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" cancellationTokenSource "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" new"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" CancellationTokenSource"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"    // Spawn a thread to call process updates and process commands"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    var"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" thread "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" new"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Thread"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(() "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"=>"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" ProcessThread"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(conn, cancellationTokenSource.Token));"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    thread."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Start"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"    // Handles CLI input"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"    InputLoop"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"    // This signals the ProcessThread to stop"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    cancellationTokenSource."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Cancel"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    thread."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Join"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h2,{id:"connect-to-database",children:"Connect to database"}),"\n",(0,c.jsxs)(s.p,{children:["Before we connect, we'll store the SpacetimeDB hostname and our database name in constants ",(0,c.jsx)(s.code,{children:"HOST"})," and ",(0,c.jsx)(s.code,{children:"DB_NAME"}),"."]}),"\n",(0,c.jsxs)(s.p,{children:["A connection to a SpacetimeDB database is represented by a ",(0,c.jsx)(s.code,{children:"DbConnection"}),". We configure ",(0,c.jsx)(s.code,{children:"DbConnection"}),"s using the builder pattern, by calling ",(0,c.jsx)(s.code,{children:"DbConnection.Builder()"}),", chaining method calls to set various connection parameters and register callbacks, then we cap it off with a call to ",(0,c.jsx)(s.code,{children:".Build()"})," to begin the connection."]}),"\n",(0,c.jsx)(s.p,{children:"In our case, we'll supply the following options:"}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:["A ",(0,c.jsx)(s.code,{children:"WithUri"})," call, to specify the URI of the SpacetimeDB host where our database is running."]}),"\n",(0,c.jsxs)(s.li,{children:["A ",(0,c.jsx)(s.code,{children:"WithModuleName"})," call, to specify the name or ",(0,c.jsx)(s.code,{children:"Identity"})," of our database. Make sure to pass the same name here as you supplied to ",(0,c.jsx)(s.code,{children:"spacetime publish"}),"."]}),"\n",(0,c.jsxs)(s.li,{children:["A ",(0,c.jsx)(s.code,{children:"WithToken"})," call, to supply a token to authenticate with."]}),"\n",(0,c.jsxs)(s.li,{children:["An ",(0,c.jsx)(s.code,{children:"OnConnect"})," callback, to run when the remote database acknowledges and accepts our connection."]}),"\n",(0,c.jsxs)(s.li,{children:["An ",(0,c.jsx)(s.code,{children:"OnConnectError"})," callback, to run if the remote database is unreachable or it rejects our connection."]}),"\n",(0,c.jsxs)(s.li,{children:["An ",(0,c.jsx)(s.code,{children:"OnDisconnect"})," callback, to run when our connection ends."]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// The URI of the SpacetimeDB instance hosting our chat database and module."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"const"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" string"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" HOST "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:' "'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"http://localhost:3000"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// The database name we chose when we published our module."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"const"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" string"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" DB_NAME "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:' "'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"quickstart-chat"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Load credentials from a file and connect to the database."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"DbConnection"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" ConnectToDB"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"()"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"    DbConnection"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"? conn "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" null"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    conn "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" DbConnection."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Builder"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"()"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"WithUri"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(HOST)"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"WithModuleName"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(DB_NAME)"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"WithToken"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(AuthToken.Token)"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"OnConnect"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(OnConnected)"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"OnConnectError"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(OnConnectError)"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"OnDisconnect"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(OnDisconnected)"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Build"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    return"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" conn;"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h3,{id:"save-credentials",children:"Save credentials"}),"\n",(0,c.jsxs)(s.p,{children:["SpacetimeDB will accept any ",(0,c.jsx)(s.a,{href:"https://openid.net/developers/how-connect-works/",children:"OpenID Connect"})," compliant ",(0,c.jsx)(s.a,{href:"https://jwt.io/",children:"JSON Web Token"})," and use it to compute an ",(0,c.jsx)(s.code,{children:"Identity"})," for the user. More complex applications will generally authenticate their user somehow, generate or retrieve a token, and attach it to their connection via ",(0,c.jsx)(s.code,{children:"WithToken"}),". In our case, though, we'll connect anonymously the first time, let SpacetimeDB generate a fresh ",(0,c.jsx)(s.code,{children:"Identity"})," and corresponding JWT for us, and save that token locally to re-use the next time we connect."]}),"\n",(0,c.jsxs)(s.p,{children:["Once we are connected, we'll use the ",(0,c.jsx)(s.code,{children:"AuthToken"})," module to save our token to local storage, so that we can re-authenticate as the same user the next time we connect. We'll also store the identity in a global variable ",(0,c.jsx)(s.code,{children:"local_identity"})," so that we can use it to check if we are the sender of a message or name change. This callback also notifies us of our client's ",(0,c.jsx)(s.code,{children:"Address"}),", an opaque identifier SpacetimeDB modules can use to distinguish connections by the same ",(0,c.jsx)(s.code,{children:"Identity"}),", but we won't use it in our app."]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Our `OnConnected` callback: save our credentials to a file."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" OnConnected"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"DbConnection"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" conn"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Identity"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" identity"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" authToken"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    local_identity "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" identity;"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    AuthToken."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"SaveToken"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(authToken);"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h3,{id:"connect-error-callback",children:"Connect Error callback"}),"\n",(0,c.jsxs)(s.p,{children:["Should we get an error during connection, we'll be given an ",(0,c.jsx)(s.code,{children:"Exception"})," which contains the details about the exception. To keep things simple, we'll just write the exception to the console."]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Our `OnConnectError` callback: print the error, then exit the process."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" OnConnectError"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Exception"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" e"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Write"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'$"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"Error while connecting: "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"e"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h3,{id:"disconnect-callback",children:"Disconnect callback"}),"\n",(0,c.jsxs)(s.p,{children:["When disconnecting, the callback contains the connection details and if an error occurs, it will also contain an ",(0,c.jsx)(s.code,{children:"Exception"}),". If we get an error, we'll write the error to the console, if not, we'll just write that we disconnected."]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Our `OnDisconnect` callback: print a note, then exit the process."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" OnDisconnected"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"DbConnection"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" conn"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Exception"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"? "}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:"e"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (e "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"!="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" null"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Write"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'$"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"Disconnected abnormally: "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"e"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    else"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Write"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'$"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"Disconnected normally."}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h2,{id:"register-callbacks",children:"Register callbacks"}),"\n",(0,c.jsx)(s.p,{children:"Now we need to handle several sorts of events with Tables and Reducers:"}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"User.OnInsert"}),": When a new user joins, we'll print a message introducing them."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"User.OnUpdate"}),": When a user is updated, we'll print their new name, or declare their new online status."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"Message.OnInsert"}),": When we receive a new message, we'll print it."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"Reducer.OnSetName"}),": If the server rejects our attempt to set our name, we'll print an error."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"Reducer.OnSendMessage"}),": If the server rejects a message we send, we'll print an error."]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Register all the callbacks our app will use to respond to database events."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" RegisterCallbacks"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"DbConnection"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" conn"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    conn.Db.User.OnInsert "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"+="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" User_OnInsert;"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    conn.Db.User.OnUpdate "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"+="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" User_OnUpdate;"})]}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    conn.Db.Message.OnInsert "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"+="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" Message_OnInsert;"})]}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    conn.Reducers.OnSetName "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"+="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" Reducer_OnSetNameEvent;"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    conn.Reducers.OnSendMessage "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"+="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" Reducer_OnSendMessageEvent;"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h3,{id:"notify-about-new-users",children:"Notify about new users"}),"\n",(0,c.jsxs)(s.p,{children:["For each table, we can register on-insert and on-delete callbacks to be run whenever a subscribed row is inserted or deleted. We register these callbacks using the ",(0,c.jsx)(s.code,{children:"OnInsert"})," and ",(0,c.jsx)(s.code,{children:"OnDelete"})," methods, which are automatically generated for each table by ",(0,c.jsx)(s.code,{children:"spacetime generate"}),"."]}),"\n",(0,c.jsx)(s.p,{children:"These callbacks can fire in two contexts:"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsx)(s.li,{children:"After a reducer runs, when the client's cache is updated about changes to subscribed rows."}),"\n",(0,c.jsxs)(s.li,{children:["After calling ",(0,c.jsx)(s.code,{children:"subscribe"}),", when the client's cache is initialized with all existing matching rows."]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["This second case means that, even though the module only ever inserts online users, the client's ",(0,c.jsx)(s.code,{children:"User.OnInsert"})," callbacks may be invoked with users who are offline. We'll only notify about online users."]}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.code,{children:"OnInsert"})," and ",(0,c.jsx)(s.code,{children:"OnDelete"})," callbacks take two arguments: an ",(0,c.jsx)(s.code,{children:"EventContext"})," and the altered row. The ",(0,c.jsx)(s.code,{children:"EventContext.Event"})," is an enum which describes the event that caused the row to be inserted or deleted. All SpacetimeDB callbacks accept a context argument, which you can use in place of your top-level ",(0,c.jsx)(s.code,{children:"DbConnection"}),"."]}),"\n",(0,c.jsxs)(s.p,{children:["Whenever we want to print a user, if they have set a name, we'll use that. If they haven't set a name, we'll instead print the first 8 bytes of their identity, encoded as hexadecimal. We'll define a function ",(0,c.jsx)(s.code,{children:"UserNameOrIdentity"})," to handle this."]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// If the user has no set name, use the first 8 characters from their identity."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" UserNameOrIdentity"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"User"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" user"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:") "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"=>"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" user.Name "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"??"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" user.Identity."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"ToString"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"()["}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:".."}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:"8"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"];"})]}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Our `User.OnInsert` callback: if the user is online, print a notification."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" User_OnInsert"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"EventContext"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" ctx"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"User"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" insertedValue"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (insertedValue.Online)"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"WriteLine"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'$"'}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"UserNameOrIdentity"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"insertedValue"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:")"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" is online"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h3,{id:"notify-about-updated-users",children:"Notify about updated users"}),"\n",(0,c.jsxs)(s.p,{children:["Because we declared a primary key column in our ",(0,c.jsx)(s.code,{children:"User"})," table, we can also register on-update callbacks. These run whenever a row is replaced by a row with the same primary key, like our module's ",(0,c.jsx)(s.code,{children:"User.Identity.Update"})," calls. We register these callbacks using the ",(0,c.jsx)(s.code,{children:"OnUpdate"})," method, which is automatically implemented by ",(0,c.jsx)(s.code,{children:"spacetime generate"})," for any table with a primary key column."]}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.code,{children:"OnUpdate"})," callbacks take three arguments: the old row, the new row, and a ",(0,c.jsx)(s.code,{children:"EventContext"}),"."]}),"\n",(0,c.jsx)(s.p,{children:"In our module, users can be updated for three reasons:"}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:["They've set their name using the ",(0,c.jsx)(s.code,{children:"SetName"})," reducer."]}),"\n",(0,c.jsxs)(s.li,{children:["They're an existing user re-connecting, so their ",(0,c.jsx)(s.code,{children:"Online"})," has been set to ",(0,c.jsx)(s.code,{children:"true"}),"."]}),"\n",(0,c.jsxs)(s.li,{children:["They've disconnected, so their ",(0,c.jsx)(s.code,{children:"Online"})," has been set to ",(0,c.jsx)(s.code,{children:"false"}),"."]}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"We'll print an appropriate message in each of these cases."}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Our `User.OnUpdate` callback:"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// print a notification about name and status changes."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" User_OnUpdate"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"EventContext"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" ctx"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"User"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" oldValue"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"User"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" newValue"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (oldValue.Name "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"!="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" newValue.Name)"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"WriteLine"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'$"'}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"UserNameOrIdentity"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"oldValue"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:")"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" renamed to "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"newValue"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"."}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"Name"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (oldValue.Online "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"!="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" newValue.Online)"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"        if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (newValue.Online)"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"            Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"WriteLine"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'$"'}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"UserNameOrIdentity"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"newValue"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:")"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" connected."}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"        else"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"            Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"WriteLine"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'$"'}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"UserNameOrIdentity"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"newValue"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:")"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" disconnected."}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h3,{id:"print-messages",children:"Print messages"}),"\n",(0,c.jsxs)(s.p,{children:["When we receive a new message, we'll print it to standard output, along with the name of the user who sent it. Keep in mind that we only want to do this for new messages, i.e. those inserted by a ",(0,c.jsx)(s.code,{children:"SendMessage"})," reducer invocation. We have to handle the backlog we receive when our subscription is initialized separately, to ensure they're printed in the correct order. To that effect, our ",(0,c.jsx)(s.code,{children:"OnInsert"})," callback will check if its ",(0,c.jsx)(s.code,{children:"ReducerEvent"})," argument is not ",(0,c.jsx)(s.code,{children:"null"}),", and only print in that case."]}),"\n",(0,c.jsxs)(s.p,{children:["To find the ",(0,c.jsx)(s.code,{children:"User"})," based on the message's ",(0,c.jsx)(s.code,{children:"Sender"})," identity, we'll use ",(0,c.jsx)(s.code,{children:"User.Identity.Find"}),", which behaves like the same function on the server."]}),"\n",(0,c.jsxs)(s.p,{children:["We'll print the user's name or identity in the same way as we did when notifying about ",(0,c.jsx)(s.code,{children:"User"})," table events, but here we have to handle the case where we don't find a matching ",(0,c.jsx)(s.code,{children:"User"})," row. This can happen when the module owner sends a message using the CLI's ",(0,c.jsx)(s.code,{children:"spacetime call"}),". In this case, we'll print ",(0,c.jsx)(s.code,{children:"unknown"}),"."]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Our `Message.OnInsert` callback: print new messages."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" Message_OnInsert"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"EventContext"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" ctx"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Message"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" insertedValue"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"    // We are filtering out messages inserted during the subscription being applied,"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"    // since we will be printing those in the OnSubscriptionApplied callback,"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"    // where we will be able to first sort the messages before printing."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (ctx.Event "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"is"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" not"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Event"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"<"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Reducer"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:">."}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"SubscribeApplied"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"        PrintMessage"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(ctx.Db, insertedValue);"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" PrintMessage"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"RemoteTables"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" tables"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Message"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" message"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    var"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" sender "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" tables.User.Identity."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Find"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(message.Sender);"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    var"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" senderName "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:' "'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"unknown"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (sender "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"!="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" null"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        senderName "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" UserNameOrIdentity"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(sender);"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"WriteLine"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'$"'}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"senderName"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:": "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"message"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"."}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"Text"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h3,{id:"warn-if-our-name-was-rejected",children:"Warn if our name was rejected"}),"\n",(0,c.jsxs)(s.p,{children:["We can also register callbacks to run each time a reducer is invoked. We register these callbacks using the ",(0,c.jsx)(s.code,{children:"OnReducerEvent"})," method of the ",(0,c.jsx)(s.code,{children:"Reducer"})," namespace, which is automatically implemented for each reducer by ",(0,c.jsx)(s.code,{children:"spacetime generate"}),"."]}),"\n",(0,c.jsx)(s.p,{children:"Each reducer callback takes one fixed argument:"}),"\n",(0,c.jsxs)(s.p,{children:["The ",(0,c.jsx)(s.code,{children:"ReducerEventContext"})," of the callback, which contains an ",(0,c.jsx)(s.code,{children:"Event"})," that contains several fields. The ones we care about are:"]}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:["The ",(0,c.jsx)(s.code,{children:"CallerIdentity"}),", the ",(0,c.jsx)(s.code,{children:"Identity"})," of the client that called the reducer."]}),"\n",(0,c.jsxs)(s.li,{children:["The ",(0,c.jsx)(s.code,{children:"Status"})," of the reducer run, one of ",(0,c.jsx)(s.code,{children:"Committed"}),", ",(0,c.jsx)(s.code,{children:"Failed"})," or ",(0,c.jsx)(s.code,{children:"OutOfEnergy"}),"."]}),"\n",(0,c.jsxs)(s.li,{children:["If we get a ",(0,c.jsx)(s.code,{children:"Status.Failed"}),", an error message is nested inside that we'll want to write to the console."]}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"It also takes a variable amount of additional arguments that match the reducer's arguments."}),"\n",(0,c.jsx)(s.p,{children:"These callbacks will be invoked in one of two cases:"}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsx)(s.li,{children:"If the reducer was successful and altered any of our subscribed rows."}),"\n",(0,c.jsx)(s.li,{children:"If we requested an invocation which failed."}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["Note that a status of ",(0,c.jsx)(s.code,{children:"Failed"})," or ",(0,c.jsx)(s.code,{children:"OutOfEnergy"})," implies that the caller identity is our own identity."]}),"\n",(0,c.jsxs)(s.p,{children:["We already handle successful ",(0,c.jsx)(s.code,{children:"SetName"})," invocations using our ",(0,c.jsx)(s.code,{children:"User.OnUpdate"})," callback, but if the module rejects a user's chosen name, we'd like that user's client to let them know. We define a function ",(0,c.jsx)(s.code,{children:"Reducer_OnSetNameEvent"})," as a ",(0,c.jsx)(s.code,{children:"Reducer.OnSetNameEvent"})," callback which checks if the reducer failed, and if it did, prints an error message including the rejected name."]}),"\n",(0,c.jsxs)(s.p,{children:["We'll test both that our identity matches the sender and that the status is ",(0,c.jsx)(s.code,{children:"Failed"}),", even though the latter implies the former, for demonstration purposes."]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Our `OnSetNameEvent` callback: print a warning if the reducer failed."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" Reducer_OnSetNameEvent"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerEventContext"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" ctx"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" name"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    var"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" e "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" ctx.Event;"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (e.CallerIdentity "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"=="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" local_identity "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"&&"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" e.Status "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"is"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Status"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"."}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Failed"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"var"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" error))"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Write"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'$"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"Failed to change name to "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"name"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:": "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"error"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h3,{id:"warn-if-our-message-was-rejected",children:"Warn if our message was rejected"}),"\n",(0,c.jsx)(s.p,{children:"We handle warnings on rejected messages the same way as rejected names, though the types and the error message are different."}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Our `OnSendMessageEvent` callback: print a warning if the reducer failed."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" Reducer_OnSendMessageEvent"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"ReducerEventContext"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" ctx"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" text"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    var"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" e "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" ctx.Event;"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (e.CallerIdentity "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"=="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" local_identity "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"&&"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" e.Status "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"is"}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:" Status"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"."}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Failed"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"var"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" error))"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Write"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'$"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"Failed to send message "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"text"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:": "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"{"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"error"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"}"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h2,{id:"subscribe-to-queries",children:"Subscribe to queries"}),"\n",(0,c.jsxs)(s.p,{children:["SpacetimeDB is set up so that each client subscribes via SQL queries to some subset of the database, and is notified about changes only to that subset. For complex apps with large databases, judicious subscriptions can save each client significant network bandwidth, memory and computation. For example, in ",(0,c.jsx)(s.a,{href:"https://bitcraftonline.com",children:"BitCraft"}),", each player's client subscribes only to the entities in the \"chunk\" of the world where that player currently resides, rather than the entire game world. Our app is much simpler than BitCraft, so we'll just subscribe to the whole database using ",(0,c.jsx)(s.code,{children:"SubscribeToAllTables"}),"."]}),"\n",(0,c.jsxs)(s.p,{children:["You can also subscribe to specific tables using SQL syntax, e.g. ",(0,c.jsx)(s.code,{children:"SELECT * FROM my_table"}),". Our ",(0,c.jsx)(s.a,{href:"/sql",children:"SQL documentation"})," enumerates the operations that are accepted in our SQL syntax."]}),"\n",(0,c.jsxs)(s.p,{children:["When we specify our subscriptions, we can supply an ",(0,c.jsx)(s.code,{children:"OnApplied"})," callback. This will run when the subscription is applied and the matching rows become available in our client cache. We'll use this opportunity to print the message backlog in proper order."]}),"\n",(0,c.jsxs)(s.p,{children:["We can also provide an ",(0,c.jsx)(s.code,{children:"OnError"})," callback. This will run if the subscription fails, usually due to an invalid or malformed SQL queries. We can't handle this case, so we'll just print out the error and exit the process."]}),"\n",(0,c.jsxs)(s.p,{children:["In ",(0,c.jsx)(s.code,{children:"Program.cs"}),", update our ",(0,c.jsx)(s.code,{children:"OnConnected"})," function to include ",(0,c.jsx)(s.code,{children:"conn.SubscriptionBuilder().OnApplied(OnSubscriptionApplied).SubscribeToAllTables();"})," so that it reads:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Our `OnConnect` callback: save our credentials to a file."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" OnConnected"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"DbConnection"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" conn"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Identity"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" identity"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"string"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" authToken"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    local_identity "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" identity;"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    AuthToken."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"SaveToken"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(authToken);"})]}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    conn."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"SubscriptionBuilder"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"()"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"OnApplied"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(OnSubscriptionApplied)"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        ."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"SubscribeToAllTables"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h2,{id:"onsubscriptionapplied-callback",children:"OnSubscriptionApplied callback"}),"\n",(0,c.jsxs)(s.p,{children:["Once our subscription is applied, we'll print all the previously sent messages. We'll define a function ",(0,c.jsx)(s.code,{children:"PrintMessagesInOrder"})," to do this. ",(0,c.jsx)(s.code,{children:"PrintMessagesInOrder"})," calls the automatically generated ",(0,c.jsx)(s.code,{children:"Iter"})," function on our ",(0,c.jsx)(s.code,{children:"Message"})," table, which returns an iterator over all rows in the table. We'll use the ",(0,c.jsx)(s.code,{children:"OrderBy"})," method on the iterator to sort the messages by their ",(0,c.jsx)(s.code,{children:"Sent"})," timestamp."]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Our `OnSubscriptionApplied` callback:"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// sort all past messages and print them in timestamp order."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" OnSubscriptionApplied"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"SubscriptionEventContext"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" ctx"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"WriteLine"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"Connected"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"    PrintMessagesInOrder"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(ctx.Db);"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" PrintMessagesInOrder"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"RemoteTables"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" tables"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    foreach"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"Message"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" message "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"in"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" tables.Message."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Iter"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"()."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"OrderBy"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:"item"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" =>"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" item.Sent))"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"        PrintMessage"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(tables, message);"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h2,{id:"process-thread",children:"Process thread"}),"\n",(0,c.jsx)(s.p,{children:"Since the input loop will be blocking, we'll run our processing code in a separate thread."}),"\n",(0,c.jsxs)(s.p,{children:["This thread will loop until the thread is signaled to exit, calling the update function ",(0,c.jsx)(s.code,{children:"FrameTick"})," on the ",(0,c.jsx)(s.code,{children:"DbConnection"})," to process any updates received from the database, and ",(0,c.jsx)(s.code,{children:"ProcessCommand"})," to process any commands received from the input loop."]}),"\n",(0,c.jsx)(s.p,{children:"Afterward, close the connection to the database."}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Our separate thread from main, where we can call process updates and process commands without blocking the main thread."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" ProcessThread"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"DbConnection"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" conn"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", "}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"CancellationToken"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" ct"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    try"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"        // loop until cancellation token"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"        while"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"!"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"ct.IsCancellationRequested)"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"            conn."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"FrameTick"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"            ProcessCommands"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(conn.Reducers);"})]}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"            Thread."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Sleep"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:"100"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:");"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    finally"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        conn."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Disconnect"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h2,{id:"handle-user-input",children:"Handle user input"}),"\n",(0,c.jsxs)(s.p,{children:["The input loop will read commands from standard input and send them to the processing thread using the input queue. The ",(0,c.jsx)(s.code,{children:"ProcessCommands"})," function is called every 100ms by the processing thread to process any pending commands."]}),"\n",(0,c.jsx)(s.p,{children:"Supported Commands:"}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Send a message: ",(0,c.jsx)(s.code,{children:"message"}),", send the message to the database by calling ",(0,c.jsx)(s.code,{children:"Reducer.SendMessage"})," which is automatically generated by ",(0,c.jsx)(s.code,{children:"spacetime generate"}),"."]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Set name: ",(0,c.jsx)(s.code,{children:"name"}),", will send the new name to the database by calling ",(0,c.jsx)(s.code,{children:"Reducer.SetName"})," which is automatically generated by ",(0,c.jsx)(s.code,{children:"spacetime generate"}),"."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsxs)(s.code,{children:[(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"/// Read each line of standard input, and either set our name or send a message as appropriate."})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" InputLoop"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"()"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    while"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" ("}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:"true"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"        var"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" input "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"="}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" Console."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"ReadLine"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"        if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (input "}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"=="}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" null"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"            break"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        }"})}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"        if"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (input."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"StartsWith"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"/name "}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"))"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"            input_queue."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Enqueue"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"name"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", input["}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:"6"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:".."}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"]));"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"            continue"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"        else"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"            input_queue."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Enqueue"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(("}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"message"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:", input));"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})}),"\n",(0,c.jsx)(s.span,{className:"line"}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"void"}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:" ProcessCommands"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#8BE9FD",fontStyle:"italic"},children:"RemoteReducers"}),(0,c.jsx)(s.span,{style:{color:"#FFB86C",fontStyle:"italic"},children:" reducers"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:")"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"{"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#6272A4"},children:"    // process input queue commands"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"    while"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (input_queue."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"TryDequeue"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"("}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"out"}),(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:" var"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" command))"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"        switch"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:" (command.Command)"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        {"})}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"            case"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:' "'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"message"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:":"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"                reducers."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"SendMessage"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(command.Args);"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"                break"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"            case"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:' "'}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:"name"}),(0,c.jsx)(s.span,{style:{color:"#E9F284"},children:'"'}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:":"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"                reducers."}),(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"SetName"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"(command.Args);"})]}),"\n",(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#FF79C6"},children:"                break"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:";"})]}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"        }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"    }"})}),"\n",(0,c.jsx)(s.span,{className:"line",children:(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"}"})})]})})}),"\n",(0,c.jsx)(s.h2,{id:"run-the-client",children:"Run the client"}),"\n",(0,c.jsxs)(s.p,{children:["Finally, we just need to add a call to ",(0,c.jsx)(s.code,{children:"Main"}),"."]}),"\n",(0,c.jsxs)(s.p,{children:["To ",(0,c.jsx)(s.code,{children:"Program.cs"}),", add:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"Main"}),(0,c.jsx)(s.span,{style:{color:"#F8F8F2"},children:"();"})]})})})}),"\n",(0,c.jsxs)(s.p,{children:["Now, we can run the client by hitting start in Visual Studio or Rider; or by running the following command in the ",(0,c.jsx)(s.code,{children:"client"})," directory:"]}),"\n",(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(s.pre,{className:"shiki spacetime-dark",style:{backgroundColor:"var(--clockworklabs-code-background-color)",color:"#F8F8F2"},tabIndex:"0",children:(0,c.jsx)(s.code,{children:(0,c.jsxs)(s.span,{className:"line",children:[(0,c.jsx)(s.span,{style:{color:"#50FA7B"},children:"dotnet"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" run"}),(0,c.jsx)(s.span,{style:{color:"#BD93F9"},children:" --project"}),(0,c.jsx)(s.span,{style:{color:"#F1FA8C"},children:" client"})]})})})}),"\n",(0,c.jsx)(s.h2,{id:"whats-next",children:"What's next?"}),"\n",(0,c.jsx)(s.p,{children:"Congratulations! You've built a simple chat app using SpacetimeDB."}),"\n",(0,c.jsxs)(s.p,{children:["You can find the full code for this client ",(0,c.jsx)(s.a,{href:"https://github.com/clockworklabs/SpacetimeDB/tree/master/sdks/csharp/examples~/quickstart-chat/client",children:"in the C# client SDK's examples"}),"."]}),"\n",(0,c.jsxs)(s.p,{children:["Check out the ",(0,c.jsx)(s.a,{href:"/sdks/c-sharp",children:"C# client SDK Reference"})," for a more comprehensive view of the SpacetimeDB C# client SDK."]}),"\n",(0,c.jsxs)(s.p,{children:["If you are interested in developing in the Unity game engine, check out our ",(0,c.jsx)(s.a,{href:"/unity",children:"Unity Comprehensive Tutorial"})," and ",(0,c.jsx)(s.a,{href:"https://github.com/clockworklabs/SpacetimeDB/tree/master/demo/Blackholio",children:"Blackholio"})," game example."]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}}}]);