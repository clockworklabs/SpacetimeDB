<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Server Module Languages/Rust-Quickstart" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Rust Quickstart | SpacetimeDB docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.spacetimedb.com/modules/rust/quickstart"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Rust Quickstart | SpacetimeDB docs"><meta data-rh="true" name="description" content="In this tutorial, we&#x27;ll implement a simple chat server as a SpacetimeDB module."><meta data-rh="true" property="og:description" content="In this tutorial, we&#x27;ll implement a simple chat server as a SpacetimeDB module."><link data-rh="true" rel="icon" href="/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.spacetimedb.com/modules/rust/quickstart"><link data-rh="true" rel="alternate" href="https://docs.spacetimedb.com/modules/rust/quickstart" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.spacetimedb.com/modules/rust/quickstart" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QBC7Z9KXS2-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Rust Quickstart","item":"https://docs.spacetimedb.com/modules/rust/quickstart"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="SpacetimeDB docs" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.0cb9f7a7.css">
<script src="/assets/js/runtime~main.d71df0f5.js" defer="defer"></script>
<script src="/assets/js/main.31d95d83.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="https://spacetimedb.com/images/brand.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_6jFv" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="https://spacetimedb.com/images/brand.png" alt="SpacetimeDB Logo" class="themedComponent_rvet themedComponent--light_mbAJ"><img src="https://spacetimedb.com/images/brand.png" alt="SpacetimeDB Logo" class="themedComponent_rvet themedComponent--dark_Ncy6"></div></a><div class="navbarSearchContainer_AesG"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://spacetimedb.com/install" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Install</a><a href="https://spacetimedb.com/pricing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Pricing</a><a href="https://spacetimedb.com/maincloud" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Maincloud</a><a href="https://spacetimedb.com/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://spacetimedb.com/community" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_hV_y"><div class="docsWrapper_f07g"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_MJiz" type="button"></button><div class="docRoot_Gd2s"><aside class="theme-doc-sidebar-container docSidebarContainer_fSpF"><div class="sidebarViewport_YElg"><div class="sidebar_kjg4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_AG0n"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/"><span title="Intro" class="categoryLinkLabel_EDYQ">Intro</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/deploying/maincloud"><span title="Deploying" class="categoryLinkLabel_EDYQ">Deploying</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/unity"><span title="Unity tutorial" class="categoryLinkLabel_EDYQ">Unity tutorial</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/unreal"><span title="Unreal Tutorial" class="categoryLinkLabel_EDYQ">Unreal Tutorial</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cli-reference"><span title="CLI Reference" class="categoryLinkLabel_EDYQ">CLI Reference</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/modules"><span title="Server Module Languages" class="categoryLinkLabel_EDYQ">Server Module Languages</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/modules"><span title="Overview" class="linkLabel_dpMB">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/modules/rust/quickstart"><span title="Rust Quickstart" class="linkLabel_dpMB">Rust Quickstart</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/modules/rust"><span title="Rust Reference" class="linkLabel_dpMB">Rust Reference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/modules/c-sharp/quickstart"><span title="C# Quickstart" class="linkLabel_dpMB">C# Quickstart</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/modules/c-sharp"><span title="C# Reference" class="linkLabel_dpMB">C# Reference</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sdks"><span title="Client SDK Languages" class="categoryLinkLabel_EDYQ">Client SDK Languages</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sql"><span title="SQL" class="categoryLinkLabel_EDYQ">SQL</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/subscriptions"><span title="Subscriptions" class="categoryLinkLabel_EDYQ">Subscriptions</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rls"><span title="Row Level Security" class="linkLabel_dpMB">Row Level Security</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/how-to/incremental-migrations"><span title="How-To" class="categoryLinkLabel_EDYQ">How-To</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/spacetimeauth"><span title="SpacetimeAuth" class="categoryLinkLabel_EDYQ">SpacetimeAuth</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/http/authorization"><span title="HTTP API" class="categoryLinkLabel_EDYQ">HTTP API</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ggI5 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/webassembly-abi"><span title="Internals" class="categoryLinkLabel_EDYQ">Internals</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/appendix"><span title="Appendix" class="linkLabel_dpMB">Appendix</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_dkUT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_w2oE"><div class="docItemContainer_f71m"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_xsLZ" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_oyay"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Server Module Languages</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Rust Quickstart</span></li></ul></nav><div class="tocCollapsible_dqme theme-doc-toc-mobile tocMobile_Z34P"><button type="button" class="clean-btn tocCollapsibleButton_QMSE">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Rust Module Quickstart</h1></header>
<p>In this tutorial, we&#x27;ll implement a simple chat server as a SpacetimeDB module.</p>
<p>A SpacetimeDB module is code that gets compiled to a WebAssembly binary and is uploaded to SpacetimeDB. This code becomes server-side logic that interfaces directly with the SpacetimeDB relational database.</p>
<p>Each SpacetimeDB module defines a set of tables and a set of reducers.</p>
<p>Each table is defined as a Rust struct annotated with <code>#[table(name = table_name)]</code>. An instance of the struct represents a row, and each field represents a column.</p>
<p>By default, tables are <strong>private</strong>. This means that they are only readable by the table owner, and by server module code.
The <code>#[table(name = table_name, public)]</code> macro makes a table public. <strong>Public</strong> tables are readable by all users but can still only be modified by your server module code.</p>
<p>A reducer is a function that traverses and updates the database. Each reducer call runs in its own transaction, and its updates to the database are only committed if the reducer returns successfully. In Rust, reducers are defined as functions annotated with <code>#[reducer]</code>, and may return a <code>Result&lt;()&gt;</code>, with an <code>Err</code> return aborting the transaction.</p>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="install-spacetimedb">Install SpacetimeDB<a href="#install-spacetimedb" class="hash-link" aria-label="Direct link to Install SpacetimeDB" title="Direct link to Install SpacetimeDB" translate="no">​</a></h2>
<p>If you haven&#x27;t already, start by <a href="https://spacetimedb.com/install" target="_blank" rel="noopener noreferrer">installing SpacetimeDB</a>. This will install the <code>spacetime</code> command line interface (CLI), which provides all the functionality needed to interact with SpacetimeDB.</p>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="install-rust">Install Rust<a href="#install-rust" class="hash-link" aria-label="Direct link to Install Rust" title="Direct link to Install Rust" translate="no">​</a></h2>
<p>Next we need to <a href="https://www.rust-lang.org/tools/install" target="_blank" rel="noopener noreferrer">install Rust</a> so that we can create our database module.</p>
<p>On macOS and Linux run this command to install the Rust compiler:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">curl</span><span style="color:#BD93F9"> --proto</span><span style="color:#E9F284"> &#x27;</span><span style="color:#F1FA8C">=https</span><span style="color:#E9F284">&#x27;</span><span style="color:#BD93F9"> --tlsv1.2</span><span style="color:#BD93F9"> -sSf</span><span style="color:#F1FA8C"> https://sh.rustup.rs</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> sh</span></span></code></pre>
<p>If you&#x27;re on Windows, go <a href="https://learn.microsoft.com/en-us/windows/dev-environment/rust/setup" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="project-structure">Project structure<a href="#project-structure" class="hash-link" aria-label="Direct link to Project structure" title="Direct link to Project structure" translate="no">​</a></h2>
<p>Create and enter a directory <code>quickstart-chat</code>:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">mkdir</span><span style="color:#F1FA8C"> quickstart-chat</span></span>
<span class="line"><span style="color:#8BE9FD">cd</span><span style="color:#F1FA8C"> quickstart-chat</span></span></code></pre>
<p>Now create <code>server</code>, our module, which runs in the database:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> init</span><span style="color:#BD93F9"> --lang</span><span style="color:#F1FA8C"> rust</span><span style="color:#F1FA8C"> server</span></span></code></pre>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="how-to-compile">How to Compile<a href="#how-to-compile" class="hash-link" aria-label="Direct link to How to Compile" title="Direct link to How to Compile" translate="no">​</a></h2>
<blockquote>
<p>[!IMPORTANT]
You cannot use the traditional <code>cargo build</code> to build SpacetimeDB server modules. Keep this in mind when using an IDE that assumes using <em>cargo</em> for building.
Above, we just initialized a SpacetimeDB server module at <code>./server</code>:</p>
</blockquote>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#8BE9FD">cd</span><span style="color:#F1FA8C"> server</span></span>
<span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> build</span></span></code></pre>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="declare-imports">Declare imports<a href="#declare-imports" class="hash-link" aria-label="Direct link to Declare imports" title="Direct link to Declare imports" translate="no">​</a></h2>
<p><code>spacetime init</code> should have pre-populated <code>server/src/lib.rs</code> with a trivial module. Clear it out so we can write a new, simple module: a bare-bones chat server.</p>
<p>To the top of <code>server/src/lib.rs</code>, add some imports we&#x27;ll be using:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> spacetimedb</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">{table, reducer, </span><span style="color:#8BE9FD;font-style:italic">Table</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Identity</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Timestamp</span><span style="color:#F8F8F2">};</span></span></code></pre>
<p>From <code>spacetimedb</code>, we import:</p>
<ul>
<li><code>table</code>, a macro used to define SpacetimeDB tables.</li>
<li><code>reducer</code>, a macro used to define SpacetimeDB reducers.</li>
<li><code>Table</code>, a rust trait which allows us to interact with tables.</li>
<li><code>ReducerContext</code>, a special argument passed to each reducer.</li>
<li><code>Identity</code>, a unique identifier for each user.</li>
<li><code>Timestamp</code>, a point in time. Specifically, an unsigned 64-bit count of milliseconds since the UNIX epoch.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="define-tables">Define tables<a href="#define-tables" class="hash-link" aria-label="Direct link to Define tables" title="Direct link to Define tables" translate="no">​</a></h2>
<p>To get our chat server running, we&#x27;ll need to store two kinds of data: information about each user, and records of all the messages that have been sent.</p>
<p>For each <code>User</code>, we&#x27;ll store their <code>Identity</code>, an optional name they can set to identify themselves to other users, and whether they&#x27;re online or not. We&#x27;ll designate the <code>Identity</code> as our primary key, which enforces that it must be unique, indexes it for faster lookup, and allows clients to track updates.</p>
<p>To <code>server/src/lib.rs</code>, add the definition of the table <code>User</code>:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[table(name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> user, public)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> User</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    #[primary_key]</span></span>
<span class="line"><span style="color:#F8F8F2">    identity</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Identity</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    name</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Option</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt;,</span></span>
<span class="line"><span style="color:#F8F8F2">    online</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> bool</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>For each <code>Message</code>, we&#x27;ll store the <code>Identity</code> of the user who sent it, the <code>Timestamp</code> when it was sent, and the text of the message.</p>
<p>To <code>server/src/lib.rs</code>, add the definition of the table <code>Message</code>:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[table(name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> message, public)]</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> Message</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    sender</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Identity</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    sent</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Timestamp</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    text</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="set-users-names">Set users&#x27; names<a href="#set-users-names" class="hash-link" aria-label="Direct link to Set users&#x27; names" title="Direct link to Set users&#x27; names" translate="no">​</a></h2>
<p>We want to allow users to set their names, because <code>Identity</code> is not a terribly user-friendly identifier. To that effect, we define a reducer <code>set_name</code> which clients can invoke to set their <code>User.name</code>. It will validate the caller&#x27;s chosen name, using a function <code>validate_name</code> which we&#x27;ll define next, then look up the <code>User</code> record for the caller and update it to store the validated name. If the name fails the validation, the reducer will fail.</p>
<p>Each reducer must accept as its first argument a <code>ReducerContext</code>, which includes the <code>Identity</code> and <code>ConnectionId</code> of the client that called the reducer, and the <code>Timestamp</code> when it was invoked. It also allows us access to the <code>db</code>, which is used to read and manipulate rows in our tables. For now, we only need the <code>db</code>, <code>Identity</code>, and <code>ctx.sender</code>.</p>
<p>It&#x27;s also possible to call <code>set_name</code> via the SpacetimeDB CLI&#x27;s <code>spacetime call</code> command without a connection, in which case no <code>User</code> record will exist for the caller. We&#x27;ll return an error in this case, but you could alter the reducer to insert a <code>User</code> row for the module owner. You&#x27;ll have to decide whether the module owner is always online or always offline, though.</p>
<p>To <code>server/src/lib.rs</code>, add:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[reducer]</span></span>
<span class="line"><span style="color:#6272A4">/// Clients invoke this reducer to set their user names.</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> set_name</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, name</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> name </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> validate_name</span><span style="color:#F8F8F2">(name)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Some</span><span style="color:#F8F8F2">(user) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender) {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">update</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">User</span><span style="color:#F8F8F2"> { name</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Some</span><span style="color:#F8F8F2">(name), </span><span style="color:#FF79C6">..</span><span style="color:#F8F8F2">user });</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        Err</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Cannot set name for unknown user&quot;</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>For now, we&#x27;ll just do a bare minimum of validation, rejecting the empty name. You could extend this in various ways, like:</p>
<ul>
<li>Comparing against a blacklist for moderation purposes.</li>
<li>Unicode-normalizing names.</li>
<li>Rejecting names that contain non-printable characters, or removing characters or replacing them with a placeholder.</li>
<li>Rejecting or truncating long names.</li>
<li>Rejecting duplicate names.</li>
</ul>
<p>To <code>server/src/lib.rs</code>, add:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#6272A4">/// Takes a name and checks if it&#x27;s acceptable as a user&#x27;s name.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> validate_name</span><span style="color:#F8F8F2">(name</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> name</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">is_empty</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        Err</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Names must not be empty&quot;</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        Ok</span><span style="color:#F8F8F2">(name)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="send-messages">Send messages<a href="#send-messages" class="hash-link" aria-label="Direct link to Send messages" title="Direct link to Send messages" translate="no">​</a></h2>
<p>We define a reducer <code>send_message</code>, which clients will call to send messages. It will validate the message&#x27;s text, then insert a new <code>Message</code> record using <code>ctx.db.message().insert(..)</code>, with the <code>sender</code> identity and <code>sent</code> timestamp taken from the <code>ReducerContext</code>. Because the <code>Message</code> table does not have any columns with a unique constraint, <code>ctx.db.message().insert()</code> is infallible and does not return a <code>Result</code>.</p>
<p>To <code>server/src/lib.rs</code>, add:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[reducer]</span></span>
<span class="line"><span style="color:#6272A4">/// Clients invoke this reducer to send messages.</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> send_message</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">, text</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;(), </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> text </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> validate_message</span><span style="color:#F8F8F2">(text)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    log</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">info!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;{}&quot;</span><span style="color:#F8F8F2">, text);</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">message</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Message</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        sender</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender,</span></span>
<span class="line"><span style="color:#F8F8F2">        text,</span></span>
<span class="line"><span style="color:#F8F8F2">        sent</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">timestamp,</span></span>
<span class="line"><span style="color:#F8F8F2">    });</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    Ok</span><span style="color:#F8F8F2">(())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>We&#x27;ll want to validate messages&#x27; texts in much the same way we validate users&#x27; chosen names. As above, we&#x27;ll do the bare minimum, rejecting only empty messages.</p>
<p>To <code>server/src/lib.rs</code>, add:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#6272A4">/// Takes a message&#x27;s text and checks if it&#x27;s acceptable to send.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> validate_message</span><span style="color:#F8F8F2">(text</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> text</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">is_empty</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        Err</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Messages must not be empty&quot;</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        Ok</span><span style="color:#F8F8F2">(text)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>You could extend the validation in <code>validate_message</code> in similar ways to <code>validate_name</code>, or add additional checks to <code>send_message</code>, like:</p>
<ul>
<li>Rejecting messages from senders who haven&#x27;t set their names.</li>
<li>Rate-limiting users so they can&#x27;t send new messages too quickly.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="set-users-online-status">Set users&#x27; online status<a href="#set-users-online-status" class="hash-link" aria-label="Direct link to Set users&#x27; online status" title="Direct link to Set users&#x27; online status" translate="no">​</a></h2>
<p>Whenever a client connects, the database will run a special reducer, annotated with <code>#[reducer(client_connected)]</code>, if it&#x27;s defined. By convention, it&#x27;s named <code>client_connected</code>. We&#x27;ll use it to create a <code>User</code> record for the client if it doesn&#x27;t yet exist, and to set its online status.</p>
<p>We&#x27;ll use <code>ctx.db.user().identity().find(ctx.sender)</code> to look up a <code>User</code> row for <code>ctx.sender</code>, if one exists. If we find one, we&#x27;ll use <code>ctx.db.user().identity().update(..)</code> to overwrite it with a row that has <code>online: true</code>. If not, we&#x27;ll use <code>ctx.db.user().insert(..)</code> to insert a new row for our new user. All three of these methods are generated by the <code>#[table(..)]</code> macro, with rows and behavior based on the row attributes. <code>ctx.db.user().find(..)</code> returns an <code>Option&lt;User&gt;</code>, because of the unique constraint from the <code>#[primary_key]</code> attribute. This means there will be either zero or one matching rows. If we used <code>try_insert</code> here it would return a <code>Result&lt;(), UniqueConstraintViolation&gt;</code> because of the same unique constraint. However, because we&#x27;re already checking if there is a user with the given sender identity we know that inserting into this table will not fail. Therefore, we use <code>insert</code>, which automatically unwraps the result, simplifying the code. If we want to overwrite a <code>User</code> row, we need to do so explicitly using <code>ctx.db.user().identity().update(..)</code>.</p>
<p>To <code>server/src/lib.rs</code>, add the definition of the connect reducer:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[reducer(client_connected)]</span></span>
<span class="line"><span style="color:#6272A4">// Called when a client connects to a SpacetimeDB database server</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> client_connected</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Some</span><span style="color:#F8F8F2">(user) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender) {</span></span>
<span class="line"><span style="color:#6272A4">        // If this is a returning user, i.e. we already have a `User` with this `Identity`,</span></span>
<span class="line"><span style="color:#6272A4">        // set `online: true`, but leave `name` and `identity` unchanged.</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">update</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">User</span><span style="color:#F8F8F2"> { online</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">..</span><span style="color:#F8F8F2">user });</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">        // If this is a new user, create a `User` row for the `Identity`,</span></span>
<span class="line"><span style="color:#6272A4">        // which is online, but hasn&#x27;t set a name.</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">User</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            name</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> None</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">            identity</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender,</span></span>
<span class="line"><span style="color:#F8F8F2">            online</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">        });</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>Similarly, whenever a client disconnects, the database will run the <code>#[reducer(client_disconnected)]</code> reducer if it&#x27;s defined. By convention, it&#x27;s named <code>client_disconnected</code>. We&#x27;ll use it to un-set the <code>online</code> status of the <code>User</code> for the disconnected client.</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#F8F8F2">#[reducer(client_disconnected)]</span></span>
<span class="line"><span style="color:#6272A4">// Called when a client disconnects from SpacetimeDB database server</span></span>
<span class="line"><span style="color:#FF79C6">pub</span><span style="color:#FF79C6"> fn</span><span style="color:#50FA7B"> identity_disconnected</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &amp;</span><span style="color:#8BE9FD;font-style:italic">ReducerContext</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Some</span><span style="color:#F8F8F2">(user) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender) {</span></span>
<span class="line"><span style="color:#F8F8F2">        ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">update</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">User</span><span style="color:#F8F8F2"> { online</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> false</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">..</span><span style="color:#F8F8F2">user });</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">        // This branch should be unreachable,</span></span>
<span class="line"><span style="color:#6272A4">        // as it doesn&#x27;t make sense for a client to disconnect without connecting first.</span></span>
<span class="line"><span style="color:#F8F8F2">        log</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">warn!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Disconnect event for unknown user with identity {:?}&quot;</span><span style="color:#F8F8F2">, ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="start-the-server">Start the Server<a href="#start-the-server" class="hash-link" aria-label="Direct link to Start the Server" title="Direct link to Start the Server" translate="no">​</a></h2>
<p>If you haven&#x27;t already started the SpacetimeDB server, run the <code>spacetime start</code> command in a <em>separate</em> terminal and leave it running while you continue following along.</p>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="publish-the-module">Publish the module<a href="#publish-the-module" class="hash-link" aria-label="Direct link to Publish the module" title="Direct link to Publish the module" translate="no">​</a></h2>
<p>And that&#x27;s all of our module code! We&#x27;ll run <code>spacetime publish</code> to compile our module and publish it on SpacetimeDB. <code>spacetime publish</code> takes an optional name which will map to the database&#x27;s unique <code>Identity</code>. Clients can connect either by name or by <code>Identity</code>, but names are much more user-friendly. If you&#x27;d like, come up with a unique name that contains only URL-safe characters (letters, numbers, hyphens and underscores), and fill it in where we&#x27;ve written <code>quickstart-chat</code>.</p>
<p>From the <code>quickstart-chat</code> directory, run in another tab:</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> publish</span><span style="color:#BD93F9"> --project-path</span><span style="color:#F1FA8C"> server</span><span style="color:#F1FA8C"> quickstart-chat</span></span></code></pre>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="call-reducers">Call Reducers<a href="#call-reducers" class="hash-link" aria-label="Direct link to Call Reducers" title="Direct link to Call Reducers" translate="no">​</a></h2>
<p>You can use the CLI (command line interface) to run reducers. The arguments to the reducer are passed in JSON format.</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> call</span><span style="color:#F1FA8C"> quickstart-chat</span><span style="color:#F1FA8C"> send_message</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Hello, World!</span><span style="color:#E9F284">&quot;</span></span></code></pre>
<p>Once we&#x27;ve called our <code>send_message</code> reducer, we can check to make sure it ran by running the <code>logs</code> command.</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> logs</span><span style="color:#F1FA8C"> quickstart-chat</span></span></code></pre>
<p>You should now see the output that your module printed in the database.</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">timestamp</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">  INFO: spacetimedb: Creating table </span><span style="color:#F1FA8C">`</span><span style="color:#50FA7B">message</span><span style="color:#F1FA8C">`</span></span>
<span class="line"><span style="color:#FF79C6">&lt;</span><span style="color:#50FA7B">timestamp</span><span style="color:#F8F8F2">&gt;  </span><span style="color:#F1FA8C">INFO:</span><span style="color:#F1FA8C"> spacetimedb:</span><span style="color:#F1FA8C"> Creating</span><span style="color:#F1FA8C"> table</span><span style="color:#F1FA8C"> `</span><span style="color:#50FA7B">user</span><span style="color:#F1FA8C">`</span></span>
<span class="line"><span style="color:#FF79C6">&lt;</span><span style="color:#50FA7B">timestamp</span><span style="color:#F8F8F2">&gt;  </span><span style="color:#F1FA8C">INFO:</span><span style="color:#F1FA8C"> spacetimedb:</span><span style="color:#F1FA8C"> Database</span><span style="color:#F1FA8C"> initialized</span></span>
<span class="line"><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">timestamp</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">  INFO: src/lib.rs:43: Hello, world</span><span style="color:#FF79C6">!</span></span></code></pre>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="sql-queries">SQL Queries<a href="#sql-queries" class="hash-link" aria-label="Direct link to SQL Queries" title="Direct link to SQL Queries" translate="no">​</a></h2>
<p>SpacetimeDB supports a subset of the SQL syntax so that you can easily query the data of your database. We can run a query using the <code>sql</code> command.</p>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> sql</span><span style="color:#F1FA8C"> quickstart-chat</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">SELECT * FROM message</span><span style="color:#E9F284">&quot;</span></span></code></pre>
<pre tabindex="0" class="codeBlockStandalone_pMzE thin-scrollbar codeBlockContainer_HZVP theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><code class="codeBlockLines_ckKi"><span class="line"><span style="color:#50FA7B"> sender</span><span style="color:#FF79C6">                                                             |</span><span style="color:#50FA7B"> sent</span><span style="color:#FF79C6">                             |</span><span style="color:#50FA7B"> text</span></span>
<span class="line"><span style="color:#50FA7B">--------------------------------------------------------------------+----------------------------------+-----------------</span></span>
<span class="line"><span style="color:#50FA7B"> 0x93dda09db9a56d8fa6c024d843e805d8262191db3b4ba84c5efcd1ad451fed4e</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> 2025-04-08T15:47:46.935402+00:00</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> &quot;Hello, world!&quot;</span></span></code></pre>
<h2 class="anchor anchorWithStickyNavbar_wKCU" id="whats-next">What&#x27;s next?<a href="#whats-next" class="hash-link" aria-label="Direct link to What&#x27;s next?" title="Direct link to What&#x27;s next?" translate="no">​</a></h2>
<p>You can find the full code for this module <a href="https://github.com/clockworklabs/SpacetimeDB/tree/master/modules/quickstart-chat" target="_blank" rel="noopener noreferrer">in the SpacetimeDB module examples</a>.</p>
<p>You&#x27;ve just set up your first database in SpacetimeDB! The next step would be to create a client that interacts with this module. You can use any of SpacetimeDB&#x27;s supported client languages to do this. Take a look at the quickstart guide for your client language of choice: <a href="/sdks/rust/quickstart">Rust</a>, <a href="/sdks/c-sharp/quickstart">C#</a>, or <a href="/sdks/typescript/quickstart">TypeScript</a>.</p>
<p>If you are planning to use SpacetimeDB with the Unity game engine, you can skip right to the <a href="/unity/part-1">Unity Comprehensive Tutorial</a>.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/modules"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/modules/rust"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Rust Reference</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Ea_L thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#install-spacetimedb" class="table-of-contents__link toc-highlight">Install SpacetimeDB</a></li><li><a href="#install-rust" class="table-of-contents__link toc-highlight">Install Rust</a></li><li><a href="#project-structure" class="table-of-contents__link toc-highlight">Project structure</a></li><li><a href="#how-to-compile" class="table-of-contents__link toc-highlight">How to Compile</a></li><li><a href="#declare-imports" class="table-of-contents__link toc-highlight">Declare imports</a></li><li><a href="#define-tables" class="table-of-contents__link toc-highlight">Define tables</a></li><li><a href="#set-users-names" class="table-of-contents__link toc-highlight">Set users&#39; names</a></li><li><a href="#send-messages" class="table-of-contents__link toc-highlight">Send messages</a></li><li><a href="#set-users-online-status" class="table-of-contents__link toc-highlight">Set users&#39; online status</a></li><li><a href="#start-the-server" class="table-of-contents__link toc-highlight">Start the Server</a></li><li><a href="#publish-the-module" class="table-of-contents__link toc-highlight">Publish the module</a></li><li><a href="#call-reducers" class="table-of-contents__link toc-highlight">Call Reducers</a></li><li><a href="#sql-queries" class="table-of-contents__link toc-highlight">SQL Queries</a></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What&#39;s next?</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"></div></footer></div>
</body>
</html>