use spacetimedb_sats::{de::Error, impl_deserialize, impl_serialize, impl_st, AlgebraicType, SpacetimeType};

/// An opaque id generated by the client to refer to a subscription.
/// This is used in Unsubscribe messages and errors.
#[derive(SpacetimeType, Copy, Clone, Debug, PartialEq, Eq, Hash)]
#[sats(crate = spacetimedb_lib)]
pub struct QuerySetId {
    pub id: u32,
}

impl QuerySetId {
    pub fn new(id: u32) -> Self {
        Self { id }
    }
}

#[derive(Clone, Copy, Default, PartialEq, Eq)]
pub enum CallProcedureFlags {
    #[default]
    Default,
}

impl_st!([] CallProcedureFlags, AlgebraicType::U8);
impl_serialize!([] CallProcedureFlags, (self, ser) => ser.serialize_u8(*self as u8));
impl_deserialize!([] CallProcedureFlags, de => match de.deserialize_u8()? {
    0 => Ok(Self::Default),
    x => Err(D::Error::custom(format_args!("invalid call procedure flag {x}"))),
});

/// A specification of either a desired or decided compression algorithm.
#[derive(serde::Deserialize, Default, PartialEq, Eq, Clone, Copy, Hash, Debug)]
pub enum Compression {
    /// No compression ever.
    None,
    /// Compress using brotli if a certain size threshold was met.
    #[default]
    Brotli,
    /// Compress using gzip if a certain size threshold was met.
    Gzip,
}
